<div #plainDev></div>
<nav class="edit-bar" data-toggle="affix" #navigationBar>
    <app-breadcrumb-menu></app-breadcrumb-menu>  
      <app-sub-menu></app-sub-menu>
 </nav>

 <main class="mt-3 organization-page tab-btns-five">
  <div class="container-fluid">
    <div class="organization-form-page" *mobxAutorun>

      <form id="regForm" [formGroup]="form"
        class="organization-multi-stup-form issue-multi-stup-form two-line-head-form">
        <!-- Circles which indicates the steps of the form: -->
        <div id="header-sroll-form" class="form-indicates-sec clearfix" #formSteps>
          <span (click)="changeStep(0)"
            class="step pointer"><span class="multi-form-nbr">1</span>{{'incident_details' | translate}}</span>
          <span (click)="changeStep(1)"
            class="step pointer"><span class="multi-form-nbr">2</span>{{'investigation' | translate}}</span>
          <span (click)="changeStep(2)"
            class="step pointer"><span class="multi-form-nbr">3</span>{{'person_involved' | translate}}</span>
          <span (click)="changeStep(3)"
            class="step pointer"><span class="multi-form-nbr">4</span>{{'witness' | translate}}</span>
          <span (click)="changeStep(4)"
            class="step pointer"><span class="multi-form-nbr">5</span>{{'preview_save' | translate}}</span>
        </div>
        <!-- One "tab" for each step in the form: -->
        <div class="tab">
          <!-- tab start -->

                    <div class="row">
                      
                        <div class="col-lg-6 col-sm-12">
                            <div class="form-group">
                                <label>{{'incident' | translate}}</label>
                                <input type="text" class="form-control" formControlName="title"
                                    [placeholder]="'incident_placeholder' | translate">
                            </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                            <div class="form-group">
                              <label>{{'type_of_damage' | translate}}</label>
                              <div class="clearfix">
                                  <div class="multiple-plain-ngselect ">
                                      <div class="multiple-plain-ngselect">
                                          <ng-select 
                                          [placeholder]="'incident_form_incident_damage_type_placeholder'| translate" [multiple]="false"
                                          formControlName="incident_damage_type_id" bindLabel="title"
                                          (search)="searchIncidentType($event)"
                                          (open)="getIncidentType()">
                                      
                                          <ng-option [value]="item.id" *ngFor="let item of IncidentDamageTypeMasterStore.allItems">
                                              {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                          </ng-option>
                  
                                      </ng-select>
                                    </div>
                                    <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.incident_damage_type_id}}</p>
      
                                    </div>
                              </div>
                          </div>
                        </div>

                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label for="title">{{'date&time' | translate}}<span class="form-error">*</span></label>
                              <div class="input-group date-picker cal-time">
                                  <div class="input-group date-picker">
                                    <input  class="form-control" formControlName="incident_at" id="startId"  [owlDateTime]="dt1" [owlDateTimeTrigger]="dt1" [max]="incidentMaxDate()"  [placeholder]="'date&time'| translate">
                                    <owl-date-time  [hour12Timer] = "true" #dt1></owl-date-time>
                                    <div class="input-group-append">
                                        <button [owlDateTimeTrigger]="dt1" id="startIdButton" class="btn btn-outline-secondary calendar" 
                                          type="button"><i class="fas fa-calendar-alt"></i></button>
                                    </div>
                                </div>
                                <p class="form-error pt-1" *ngIf="formErrors && formErrors.incident_at">{{formErrors.incident_at}}</p>
                                </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label for="title">{{'incident_form_description' | translate}}<span class="form-error">*</span></label>
                            <textarea class="form-control" rows="2" formControlName="description" id="comment" [placeholder]="'incident_form_description_placeholder'| translate"></textarea>

                            <p style="color: red;" *ngIf="formErrors"> {{formErrors.description}}</p>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                              <label for="title">{{'reported_date_time' | translate}}<span class="form-error">*</span></label>
                              <div class="input-group date-picker cal-time">
                                  <div class="input-group date-picker">
                                    <input  class="form-control" formControlName="reported_at" id="startId"  [owlDateTime]="dt1" [owlDateTimeTrigger]="dt1"
                                       [min]="form.value?.incident_at? form.value?.incident_at : ''" 
                                       [placeholder]="'reported_date_time'| translate">
                                    <owl-date-time  [hour12Timer] = "true" #dt1></owl-date-time>
                                    <div class="input-group-append">
                                        <button [owlDateTimeTrigger]="dt1" id="startIdButton" class="btn btn-outline-secondary calendar" 
                                          type="button"><i class="fas fa-calendar-alt"></i></button>
                                    </div>
                                </div>
                                <p class="form-error pt-1" *ngIf="formErrors && formErrors.incident_at">{{formErrors.reported_at}}</p>
                                </div>
                          </div>
                        </div>
 
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label>{{'incident_form_category' | translate}}</label>
                            <div class="clearfix">
                                <div class="multiple-plain-ngselect select-width-plus">
                                    <div class="multiple-plain-ngselect">
                                        <ng-select 
                                        [placeholder]="'incident_form_category_placeholder'| translate" [multiple]="false"
                                        formControlName="incident_category_ids" bindLabel="title"
                                        (search)="searchIncidentCategory($event)"
                                        (open)="getIncidentCategory()">
                                     
                                        <ng-option [value]="item.id" *ngFor="let item of IncidentCategoriesMasterStore.allItems">
                                            {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                         </ng-option> 
                
                                    </ng-select>
                                  </div>
                                  <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.incident_category_ids}}</p>
    
                                </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label>{{'incident_form_sub_category' | translate}}</label>
                            <div class="clearfix">
                                <div class="multiple-plain-ngselect select-width-plus">
                                    <div class="multiple-plain-ngselect">
                                        <ng-select 
                                        [placeholder]="'incident_form_sub_category_placeholder'| translate" [multiple]="false"
                                        formControlName="incident_sub_category_ids" bindLabel="title"
                                        (search)="searchIncidentSubCategory($event)"
                                        (open)="getIncidentSubCategory()">
                                     
                                        <ng-option [value]="item.id" *ngFor="let item of IncidentSubCategoryMasterStore.allItems">
                                            {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                         </ng-option>
                
                                    </ng-select>
                                  </div>
                                  <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.incident_sub_category_ids}}</p>
    
                                </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                             <label>{{'incident_form_reported_by' | translate}}</label>
                             <div class="clearfix">
                                 <div class="multiple-plain-ngselect select-width-plus">
                                     <div class="multiple-plain-ngselect">
                                         <ng-select [items]="UsersStore.usersList"
                                         [placeholder]="'incident_form_reported_by_placeholder'| translate" [multiple]="false"
                                         formControlName="reported_by" bindLabel="email"
                                         (search)="searchReportedBy($event)"
                                         (open)="getUsers()">
                                          <ng-template ng-label-tmp let-item="item" let-clear="clear">
                                           <img *ngIf="item.image_token" height="15" width="15"[attr.src]="createImagePreview('user-profile-picture',item.image_token)" onerror = "this.src='/assets/images/user-demo2.png'"/>
                                           <img *ngIf="!item.image_token" height="15" width="15" [attr.src]="getDefaultImage('user-logo')"/>
                                           <b style="padding-left: 3px;">{{getStringsFormatted([item.first_name,item.last_name],50,' ') | titlecase}}</b><span aria-hidden="true"
                                               (click)="clear(item)" style="border:none;"
                                               class="ng-value-icon left">Ã—</span>
                                       </ng-template>
                                       <ng-template ng-option-tmp let-item="item" let-index="index">
                                           <div class="user-post-department-pic">
                                              <img *ngIf="item.image_token" height="25" width="25" [attr.src]="createImagePreview('user-profile-picture',item.image_token)" onerror = "this.src='/assets/images/user-demo2.png'" />
                                               <img *ngIf="!item.image_token" height="25" width="25" [attr.src]="getDefaultImage('user-logo')"  />
                                           </div>
                                           <div class="user-post-department-div">
                                               <b>{{getStringsFormatted([item.first_name,item.last_name],50,' ') | titlecase}}</b>
                                               <p class="user-post-department-multiple">{{getStringsFormatted([item?.designation_title,' '+item?.department],50,',')}}</p>
                                           </div>
                                       </ng-template>
                 
                                     </ng-select>
                                   </div>
                                   <p class="form-error pt-1" *ngIf="formErrors && formErrors.reported_by">{{formErrors.reported_by}}</p>
     
                                    </div>
                             </div>
                          </div>
                       </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label>{{'invoved_party' | translate}}</label>
                            <div class="clearfix">
                                <div class="multiple-plain-ngselect select-width-plus">
                                    <div class="multiple-plain-ngselect">
                                        <ng-select 
                                        [placeholder]="'incident_form_invoved_party_placeholder'| translate" [multiple]="false"
                                        formControlName="incident_stakeholder_ids" bindLabel="title"
                                        (search)="searchInvolved($event)"
                                        (open)="getInvolvedUsers()">
                                     
                                        <ng-option [value]="item.id" *ngFor="let item of StakeholderMasterStore.stakeholders">
                                            {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                         </ng-option>
                
                                    </ng-select>
                                  </div>
                                  <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.incident_stakeholder_ids}}</p>
    
                                   </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label>{{'subsidiary' | translate}}</label>
                            <div class="clearfix">
                                <div class="multiple-plain-ngselect select-width-plus">
                                    <div class="multiple-plain-ngselect">
                                        <ng-select 
                                        [placeholder]="'select_subsidiary'| translate" [multiple]="false"
                                        formControlName="organization_ids" bindLabel="title"
                                        (search)="searchOrganization($event)"
                                        (open)="getOrganization()">
                                     
                                        <ng-option [value]="item.id" *ngFor="let item of SubsidiaryStore.subsidiaryList">
                                            {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                         </ng-option>
                
                                    </ng-select>
                                  </div>
                                  <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.organization_ids}}</p>
    
                                   </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                          <label>{{'division' | translate}}</label>
                          <div class="clearfix">
                              <div class="multiple-plain-ngselect select-width-plus">
                                  <div class="multiple-plain-ngselect">
                                      <ng-select 
                                      [placeholder]="'select_division'| translate" [multiple]="false"
                                      formControlName="division_ids" bindLabel="title"
                                      (search)="searchDivision($event)"
                                      (open)="getDevisions()">
                                   
                                      <ng-option [value]="item.id" *ngFor="let item of DivisionMasterStore.allItems">
                                          {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                       </ng-option>
              
                                  </ng-select>
                                </div>
                                <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.organization_ids}}</p>
  
                                 </div>
                          </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                             
                          <label>{{'department' | translate}}</label>
                          <div class="clearfix">
                              <div class="multiple-plain-ngselect select-width-plus">
                                  <div class="multiple-plain-ngselect">
                                      <ng-select 
                                      [placeholder]="'select_department'| translate" [multiple]="false"
                                      formControlName="department_ids" bindLabel="title"
                                      (search)="searchDepartment($event)"
                                      (open)="getDepartment()" >
                                     
                                   
                                      <ng-option [value]="item.id" *ngFor="let item of DepartmentMasterStore.allItems">
                                          {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                       </ng-option>
              
                                  </ng-select>
                                </div>
                                <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.department_ids}}</p>
  
                                 </div>
                          </div>
                          </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label>{{'section' | translate}}</label>
                            <div class="clearfix">
                                <div class="multiple-plain-ngselect select-width-plus">
                                    <div class="multiple-plain-ngselect">
                                        <ng-select 
                                        [placeholder]="'select_section'| translate" [multiple]="false"
                                        formControlName="section_ids" bindLabel="title"
                                        (search)="searchSections($event)"
                                        (open)="getSections()" >
                                     
                                        <ng-option [value]="item.id" *ngFor="let item of SectionMasterStore.allItems">
                                            {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                         </ng-option>
                
                                    </ng-select>
                                  </div>
                                  <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.department_ids}}</p>
    
                                   </div>
                            </div>
                         </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label>{{'sub_section' | translate}}</label>
                            <div class="clearfix">
                                <div class="multiple-plain-ngselect select-width-plus">
                                    <div class="multiple-plain-ngselect">
                                        <ng-select 
                                        [placeholder]="'select_sub_section'| translate" [multiple]="false"
                                        formControlName="sub_section_ids" bindLabel="title"
                                        (search)="searchSubSections($event)"
                                        (open)="getSubSections()" >
                                     
                                        <ng-option [value]="item.id" *ngFor="let item of SubSectionMasterStore.allItems">
                                            {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                                         </ng-option>
                
                                    </ng-select>
                                  </div>
                                  <p class="form-error pt-1" *ngIf="formErrors && formErrors.leader_id">{{formErrors.sub_section_ids}}</p>
    
                                   </div>
                            </div>
                         </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label for="title">{{'action_taken' | translate}}<span class="form-error">*</span></label>
                            <input type="text" formControlName="action" class="form-control"
                                placeholder="{{'action_taken' | translate}}" id="title" #titleInput>
                            <p style="color: red;" *ngIf="formErrors"> {{formErrors.title}}</p>
                        </div>
                        </div>
                        <div class="col-lg-6 col-sm-12">
                          <div class="form-group">
                            <label for="title">{{'location' | translate}}<span class="form-error">*</span></label>
                            <input type="text" formControlName="location" class="form-control"
                                placeholder="{{'incident_form_location_placeholder' | translate}}" id="title" #titleInput>
                            <p style="color: red;" *ngIf="formErrors"> {{formErrors.location}}</p>
                        </div>
                        </div>
                        <div class="col-sm-12">
                          <label class="label-style mb-0">{{'evidences_upload' | translate}}</label>
                          <div class="scroll-documents" #uploadArea>
                           <div class="row m-0 upload-section" style="padding-top: 0">
                               <div class="col-sm-2 col-lg-4 costmz-logo-new mt-2">
             
                                   <div class="question-circle-inp" style="margin-right: 7px;">
                                       <i class="far fa-question-circle"></i>
                                       <div class="message-password-inp">
                                           <p class="mb-0">{{'allowed_file_types' | translate}}
                                               {{OrganizationGeneralSettingsStore.organizationSettings?.support_file_allowed_types.toString()}}
                                           </p>
                                       </div>
                                   </div>
                                   <div class="form-group form-group-upload">
                                       <div class="darag-dropifile-upload">
                                           <div class="d-flex justify-content-center align-items-center text-center">
                                               <div>
                                                   <img src="assets/images/drag-pic.png" class="drag-pic-files">
                                                   <div class="drag-file-name">{{'drag_drop_file_here' | translate}}</div>
                                                   <div class="upload-btn-wrapper">
                                                       <input id="file" type="file" multiple name="myfile"
                                                           (change)="onFileChange($event,'support-file')"
                                                           [accept]="checkAcceptFileTypes('support-file')" />
                                                       <button class="btn">{{'browse_files' | translate}}</button>
                                                   </div>
                                               </div>
                                           </div>
                                       </div>
                                   </div>
                               </div>
                               <div [ngClass]="files.success? 'col-sm-2 col-lg-4 up-pic-cf mt-2 hide_loader' : 'col-sm-2 col-lg-4 up-pic-cf mt-2'"
                                   *ngFor="let files of fileUploadsArray">
                                   <div class="upload-pics edit-option file-upload-loader">
                                       <circle-progress class="browse-form-pic" [percent]=files.uploadProgress
                                           [title]=files.uploadProgress>
                                       </circle-progress>
                                   </div>
                               </div>
             
                               <div [ngClass]="doc.is_deleted ? 'col-sm-2 col-lg-4 up-pic-cf mt-2 image_deleted':'col-sm-2 col-lg-4 up-pic-cf mt-2'"
                                   *ngFor="let doc of form.value?.documents">
                                   <div class="upload-pics edit-option">
                                       <div *ngIf="doc.preview" class="browse-form-pic"
                                      [ngStyle]="{'background': 'url(' + doc.preview + ') no-repeat 0 0 / cover'}">
                                       </div>
                                       <div *ngIf="!doc.preview" class="browse-form-pic"
                                           [ngStyle]="{'background': 'url(' + createImageUrl('investigation-item',doc.token) + '), url(' + getDefaultImage('no-preview') + ') no-repeat 0 0 / cover '}">
                                       </div>
                                       <div class="browse-form-name clearfix">
                                           <div class="float-left">
                                               <h6 *ngIf="!doc.preview" [attr.title]="doc.title">
                                                   {{doc.title.length > 13 ? doc.title.substring(0,13)+'
                                                   ...': doc.title}}
                                               </h6>
                                               <h6 *ngIf="!doc.preview">{{doc?.name?.length>15 ? doc?.name.substring(0,15)+' ...':doc?.name}}</h6>                                                <span>{{doc.size/1048576 | number:'0.2-2'}}MB</span>
                                           </div>
                                           <div class="browse-logo">
                                               <img *ngIf="checkExtension(doc.ext,'excel') != -1"
                                                   src="/assets/images/md-xl.png">
                                               <img *ngIf="checkExtension(doc.ext,'image') != -1"
                                                   src="/assets/images/md-jpg.png">
                                               <img *ngIf="checkExtension(doc.ext,'doc') != -1"
                                                   src="/assets/images/md-doc.png">
                                               <img *ngIf="checkExtension(doc.ext,'pdf') != -1"
                                                   src="/assets/images/md-pdf.png">
                                           </div>
                                       </div>
                                       <div class="edit-option-show">
                                           <a (click)="removeDocument(doc.token)"><i class="fas fa-trash"></i></a>
                                       </div>
                                   </div>
                               </div>
                           </div>
                       </div>
                       </div>

                    </div>


        </div><!-- tab end -->
        <div class="tab">
          <!-- tab start -->
            <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <h6>{{'were_safe_work_practices' | translate}} <br>{{'being_used' |
                        translate}}
                      </h6>
                      <div class="Preview-block pt-0">
                        <div class="Preview-checkbox clearfix d-inline-block mr-3">
                          <label class="container2 remember-txt mb-0">
                            <input type="checkbox" [(ngModel)]='yes'
                              [ngModelOptions]="{standalone: true}"
                              (change)="onCheckboxChange1($event)">
                            <span class="checkmark"></span> Yes</label>
                        </div>
                        <div class="Preview-checkbox clearfix d-inline-block mr-3">
                          <label class="container2 remember-txt mb-0">
                            <input type="checkbox" [(ngModel)]='no'
                              [ngModelOptions]="{standalone: true}"
                              (change)="onCheckboxChange2($event)">
                            <span class="checkmark"></span> No</label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6 col-sm-12">
                    <div class="form-group">
                        <label>{{'incident_investigations' | translate}}</label>
                        <div class="d-flex"> <input type="text" class="form-control w-100"
                          [placeholder]="'incident_investigation_desc' | translate" formControlName="investigation_points">
                          <button class="btn multi-add-user ml-2" style="width: 42px;"
                              (click)="addInvestigationPoint()"><i class="fas fa-plus"></i></button>
                        </div>

                  <ul class="arrowlist pl-0 mt-2" *ngIf="IncidentStore.investigationsDes?.length>0">

                      <li class="clearfix" *ngFor="let investigation of IncidentStore.investigationsDes;let i=index">{{investigation}}
                          <Button type="button" (click) = "removeInvestigation(i)" class="btn btn-small float-right btn-small-delete" style="border: none;"><i class="fas fa-trash"></i></Button>
    
                      </li>

                  </ul>
                    </div>
                  </div>
                  <div class="col-lg-6 col-sm-12">
                      <div class="form-group">
                          <label>{{'recommendations' | translate}}</label>
                          <div class="d-flex"> 
                            <input type="text" class="form-control w-100"
                              [placeholder]="'description_recommendations' | translate" formControlName="investigation_recommendations">
                            <button class="btn multi-add-user ml-2" style="width: 42px;"
                                (click)="addRecommendationsPoint()"><i class="fas fa-plus"></i></button>
                          </div>
  
                    <ul class="arrowlist pl-0 mt-2" *ngIf="IncidentStore.recommendationsDes?.length>0">
  
                        <li class="clearfix" *ngFor="let recommendation of IncidentStore.recommendationsDes;let i=index">{{recommendation}}
                            <Button type="button" (click) = "removeRecommendations(i)" class="btn btn-small float-right btn-small-delete" style="border: none;"><i class="fas fa-trash"></i></Button>
      
                        </li>
  
                    </ul>
                      </div>
                  </div>
                  <div class="col-lg-6 col-sm-12">
                    <div class="form-group">
                      <label for="name">{{'investigation_root_causes' | translate}}
                      </label>
                      <div class="clearfix d-flex">
                          <div class="multiple-plain-ngselect select-width-plus">
                            <ng-select
                              [placeholder]="'investigation_root_cause_placeholder' | translate"
                              [multiple]="true"
                              formControlName="investigation_root_cause_ids"
                              bindLabel="title" (search)="searchRootCause($event)"
                              (open)="getRootCause()">
                                <ng-option [value]="item"
                                  *ngFor="let item of IncidentRootCauseMasterStore.allItems">
                                  {{item.title.length > 80 ?
                                  item.title.substring(0,80)+' ...' :
                                  item.title }}
                                </ng-option>
                            </ng-select>
                          </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6 col-sm-12">
                        <div class="form-group">
                            <label>{{'significant_observations' | translate}}</label>
                            <div class="d-flex"> 
                              <input type="text" class="form-control w-100"
                                [placeholder]="'investigation_observations_desc' | translate" formControlName="investigation_observations">
                              <button class="btn multi-add-user ml-2" style="width: 42px;"
                                  (click)="addObservationsPoint()"><i class="fas fa-plus"></i></button>
                            </div>
    
                      <ul class="arrowlist pl-0 mt-2" *ngIf="IncidentStore.significantObservationsDes?.length>0">
    
                          <li class="clearfix" *ngFor="let observation of IncidentStore.significantObservationsDes;let i=index">{{observation}}
                              <Button type="button" (click) = "removeObservations(i)" class="btn btn-small float-right btn-small-delete" style="border: none;"><i class="fas fa-trash"></i></Button>
        
                          </li>
    
                      </ul>
                      </div>
                  </div>
                  <div class="col-lg-6 col-sm-12">
                      <div class="form-group">
                          <label>{{'references' | translate}}</label>
                          <div class="d-flex"> 
                            <input type="text" class="form-control w-100"
                              [placeholder]="'description_recommendations' | translate" formControlName="investigation_references">
                            <button class="btn multi-add-user ml-2" style="width: 42px;"
                                (click)="addReferencesPoint()"><i class="fas fa-plus"></i></button>
                          </div>
  
                    <ul class="arrowlist pl-0 mt-2" *ngIf="IncidentStore.referencesDes?.length>0">
  
                        <li class="clearfix" *ngFor="let reference of IncidentStore.referencesDes;let i=index">{{reference}}
                            <Button type="button" (click) = "removeReference(i)" class="btn btn-small float-right btn-small-delete" style="border: none;"><i class="fas fa-trash"></i></Button>
      
                        </li>
  
                    </ul>
                      </div>
                  </div>
                  <div class="col-lg-6 col-sm-12">
                    <div class="form-group">
											<label for="name">{{'investigation_damage_severity' | translate}}</label>
											<div class="multiple-plain-ngselect select-width-plus">
												<ng-select
													[placeholder]="'investigation_damage_severity_placeholder'| translate"
													[multiple]="false" formControlName="incident_damage_severity_id"
													bindLabel="title" (search)="searchDamageSeverity($event)"
													(open)="getDamageSeverityCause()">
                            <ng-option [value]="item"
                              *ngFor="let item of IncidentDamageSeverityMasterStore.allItems">
                              {{item.title.length > 80 ? item.title.substring(0,80)+' ...' : item.title }}
                            </ng-option>


												</ng-select>
											</div>
										</div>
                  </div>
           </div>


        </div><!-- tab end -->
        <div class="tab">
          <!-- tab start -->

          <div class="mb-5">

            <div class="common-tab-md clearfix">
              <div class="tab-common-left-md">
                <div class=" issues-tab active-right-border-none">
                  <!-- tab menu start -->
                  <ul class="nav nav-tabs nav-tabs--vertical nav-tabs--left vertical-tab"
                    role="navigation">
                    <li class="nav-item"> <a href="#step-inner-left-one"
                        class="nav-link active" data-toggle="tab" role="tab"
                        aria-controls="lorem" aria-selected="false">{{'employee' |
                        translate}}</a>
                    </li>
                    <li class="nav-item"> <a href="#step-inner-left-two" class="nav-link"
                        data-toggle="tab" role="tab" aria-controls="ipsum"
                        aria-selected="false">{{'others' | translate}}</a>
                    </li>
                  </ul>
                </div><!-- tab menu end -->
              </div>

              <div
                class="tab-common-left-content-m bg-white cmn-bdr widg-padding-cmn min-height-590">
                <div class="tab-content">
                  <div class="tab-pane fade active show" id="step-inner-left-one"
                    role="tabpanel">

                    <div class="cmn-bdr p-3 d-flex mb-3 align-items-center">
                      <h6 class="mb-0 w-100">Add Employee</h6>
                      <div class="text-right ml-2" style="width: 100px;">
                        <button type="button" class="btn btn-small" data-toggle="modal" data-target="#person-involved-employee-pop"
                          style="margin: 0 !important;">Add</button>
                      </div>
                    </div>

                    <div class="audit-page-table-main">
                      <div class="row">
                        <div class="col-sm-12 full-width-table">
                          <table
                            class="table table-bordered ordinary-table audit-page-table mb-4 table-scroll"
                            *ngIf="IncidentInvestigationStore.involvedOtherUserDetails?.length > 0">
                            <thead>
                              <tr>
                                <th class="border-top-0 text-center" width="2%">
                                  #</th>
                                <th class="border-top-0" width="28%">{{'users' |
                                  translate}}</th>
                                <!-- <th class="border-top-0" width="70%">{{'	remarks' | translate}}</th> -->
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let involved of IncidentInvestigationStore.involvedOtherUserDetails;let num = index"
                                class="edit-and-delete-main">
                                <td class="text-center">{{num+1}}</td>
                                <td>
                                  <div
                                    class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                                    <!-- <img src="images/round-15.png" width="30px" height="30px" class="rounded-circle rounde-hov details-show-popup"> -->
                                    <img *ngIf="involved.image?.token"
                                      data-toggle="modal"
                                      data-target="#user02"
                                      data-ui-class="a-zoom"
                                      [attr.src]="createImagePreview('user-profile-picture',involved.image?.token)"
                                      width="30px" height="30px"
                                      class="rounded-circle rounde-hov details-show-popup"
                                      onerror="this.src='/assets/images/user-demo2.png'">
                                    <img *ngIf="!involved.image?.token"
                                      [attr.src]="getDefaultImage('user-logo')"
                                      width="30px" height="30px"
                                      class="rounded-circle"
                                      onerror="this.src='/assets/images/user-demo2.png'">
                                    <div>
                                      <h6>{{involved.first_name}}
                                        {{involved.last_name}}</h6>
                                      <span>{{involved.designation?
                                        involved.designation :
                                        involved.designation_title
                                        }}</span>

                                    </div>
                                  </div>
                                  <div
                                    class="edit-option-show"
                                    style="margin: 38px 16px 0 0; ">
                                    <!-- edit-and-delete starts -->
                                    <!-- <a (click)="editInvolvedOthers(user,num)" data-toggle="modal" data-target="#person-involved-popup"><i class="fas fa-pen"></i></a> -->
                                    <a
                                      (click)="deleteOtherInvovedPerson(involved.first_name)"><i
                                        class="fas fa-trash"></i></a>
                                  </div>
                                </td>
                                <!-- <td>Lorem ipsum lorel ipsum lorel ipsum lorel ipsum lorel ipsum lorel ipsum </td> -->
                              </tr>
                            </tbody>
                          </table>

                          <ng-container *mobxAutorun>
                            <app-no-data-list [source]="investigationEmptyList"
                              *ngIf="IncidentInvestigationStore.involvedOtherUserDetails.length == 0 ">
                            </app-no-data-list>
                          </ng-container>
                        </div>
                      </div>

                    </div>



                  </div>
                  <div class="tab-pane fade" id="step-inner-left-two" role="tabpanel">

                    <!-- <div class="clearfix mb-2">
                      <button type="button"
                        class="btn btn-small float-right" data-toggle="modal"
                        data-target="#person-involved-popup"
                        style="margin-right: 0 !important;"> <i
                          class="fas fa-plus mr-2"></i>Add</button>
                    </div> -->
                    <div class="cmn-bdr p-3 d-flex mb-3 align-items-center">
                      <h6 class="mb-0 w-100">Add other user</h6>
                      <div class="text-right ml-2" style="width: 100px;">
                        <button type="button" class="btn btn-small" data-toggle="modal" data-target="#person-involved-popup"
                          style="margin: 0 !important;">Add</button>
                      </div>
                    </div>

                    <div class="row"
                      *ngIf="IncidentStore.involvedOtherUserDetails?.length > 0">
                      <div class="col-lg-6 col-sm-12 edit-and-delete-main"
                        *ngFor=" let user of  IncidentStore.involvedOtherUserDetails">
                        <div class="hover-body-clr-bg cmn-bdr padding-bottom-none mb-4">
                          <h6>{{user?.name}}</h6>
                          <a class="call-and-mail-link mr-3 call-link"><i
                              class="fas fa-phone rotate-icon-call"></i>{{user.mobile}}</a>
                          <a *ngIf="user?.email"
                            class="call-and-mail-link mail-link"><i
                              class="fas fa-envelope"></i>{{user?.email}}</a>
                          <hr>
                          <div class="row">
                            <div class="col-md-6">
                              <h6>{{'designation' | translate}}</h6>
                              <p>{{user?.designation?user.designation :
                                AppStore.noContentText }}</p>
                            </div>
                            <div class="col-md-6">
                              <h6>{{'company_name' | translate}}</h6>
                              <p>{{user.company?user.company :
                                AppStore.noContentText }}</p>
                            </div>
                            <div class="col-md-6">
                              <h6>{{'age' | translate}}</h6>
                              <p>{{user.age?user.age : AppStore.noContentText }}
                              </p>
                            </div>
                            <div class="col-md-6">
                              <h6>{{'gender' | translate}}</h6>
                              <p>{{user.gender?user.gender :
                                AppStore.noContentText }}</p>
                            </div>
                            <div class="col-md-12">
                              <h6>{{'remarks' | translate}}</h6>
                              <p class="elips-1" [title]="user.remarks">{{user.remarks?user.remarks :
                                AppStore.noContentText }}</p>
                            </div>
                          </div>

                        </div>
                        <div class="edit-option-show"
                          style="margin: 38px 16px 0 0; ">
                          <!-- edit-and-delete starts -->
                          <!-- <a (click)="editInvolvedOthers(user,num)" data-toggle="modal" data-target="#person-involved-popup"><i class="fas fa-pen"></i></a> -->
                          <a (click)="deleteOthersInvovedPersons(user.name)"><i
                              class="fas fa-trash"></i></a>
                        </div>
                      </div>

                    </div>
                    <ng-container *mobxAutorun>
                      <app-no-data-list [source]="investigationEmptyList"
                        *ngIf="IncidentStore.involvedOtherUserDetails.length == 0 ">
                      </app-no-data-list>
                    </ng-container>



                  </div>
                </div>
              </div>

            </div>


          </div>

        </div><!-- tab end -->
        <div class="tab">
          <!-- tab start -->
          <div class="mb-5">

            <div class="common-tab-md clearfix">
              <div class="tab-common-left-md">
                <div class=" issues-tab active-right-border-none">
                  <!-- tab menu start -->
                  <ul class="nav nav-tabs nav-tabs--vertical nav-tabs--left vertical-tab"
                    role="navigation">
                    <li class="nav-item"> <a href="#step-inner-witness-one"
                        class="nav-link active" data-toggle="tab" role="tab"
                        aria-controls="lorem" aria-selected="false">{{'employee' | translate}}</a>
                    </li>
                    <li class="nav-item"> <a href="#step-inner-witness-two" class="nav-link"
                        data-toggle="tab" role="tab" aria-controls="ipsum"
                        aria-selected="false">{{'others' | translate}}</a>
                    </li>
                  </ul>
                </div><!-- tab menu end -->
              </div>

              <div
                class="tab-common-left-content-m bg-white cmn-bdr widg-padding-cmn min-height-590">
                <div class="tab-content">
                  <div class="tab-pane fade active show" id="step-inner-witness-one"
                    role="tabpanel">

                    <div class="cmn-bdr p-3 d-flex mb-3 align-items-center">
                      <h6 class="mb-0 w-100">Add Employee</h6>
                      <div class="text-right ml-2" style="width: 100px;">
                        <button type="button" class="btn btn-small" data-toggle="modal" data-target="#witness-employee-pop"
                          style="margin: 0 !important;">Add</button>
                      </div>
                    </div>

                    <div class="audit-page-table-main">
                      <div class="row">
                        <div class="col-sm-12 full-width-table">
                          <table
                            class="table table-bordered ordinary-table audit-page-table mb-4 table-scroll">
                            <thead>
                              <tr>
                                <th class="border-top-0 text-center" width="2%">
                                  #</th>
                                <th class="border-top-0" width="28%">{{'user' | translate}}</th>
                                <!-- <th class="border-top-0" width="70%">{{'remarks' | translate}}</th> -->
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let witness of IncidentInvestigationStore.involvedWitnessUserDetails; let num = index"
                                class="edit-and-delete-main">
                                <td class="text-center">{{num+1}}</td>
                                <td>
                                  <div
                                    class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                                    <!-- <img src="images/round-15.png" width="30px" height="30px" class="rounded-circle rounde-hov details-show-popup"> -->
                                    <img *ngIf="witness.image?.token"
                                      data-toggle="modal"
                                      data-target="#user02"
                                      data-ui-class="a-zoom"
                                      [attr.src]="createImagePreview('user-profile-picture',witness.image?.token)"
                                      width="30px" height="30px"
                                      class="rounded-circle rounde-hov details-show-popup"
                                      onerror="this.src='/assets/images/user-demo2.png'">
                                    <img *ngIf="!witness.image?.token"
                                      [attr.src]="getDefaultImage('user-logo')"
                                      width="30px" height="30px"
                                      class="rounded-circle"
                                      onerror="this.src='/assets/images/user-demo2.png'">
                                    <div>
                                      <h6>{{witness.first_name}}
                                        {{witness.last_name}}</h6>
                                      <span>{{witness.designation?
                                        witness.designation :
                                        witness.designation_title
                                        }}</span>
                                    </div>
                                  </div>
                                  <div
                                    class="edit-option-show"
                                    style="margin: 38px 16px 0 0; ">
                                    <!-- edit-and-delete starts -->
                                    <!-- <a (click)="editInvolvedOthers(user,num)" data-toggle="modal" data-target="#person-involved-popup"><i class="fas fa-pen"></i></a> -->
                                    <a
                                      (click)="deleteOtherWitnessPerson(witness.first_name)"><i
                                        class="fas fa-trash"></i></a>
                                  </div>
                                </td>
                                <!-- <td>Lorem ipsum lorel ipsum lorel ipsum lorel ipsum lorel ipsum lorel ipsum </td> -->
                              </tr>
                            </tbody>
                          </table>
                          <ng-container *mobxAutorun>
                            <app-no-data-list [source]="investigationEmptyList"
                              *ngIf="IncidentInvestigationStore.involvedWitnessUserDetails.length == 0 ">
                            </app-no-data-list>
                          </ng-container>
                        </div>
                      </div>

                      <div class="row">
                        <!-- <div class="col-sm-12">
                                        <ul class="pagination justify-content-center mt-0">
                                           <li class="page-item"><a class="page-link" href="javascript:void(0);"><i class="fas fa-chevron-left"></i></a></li>
                                           <li class="page-item"><a class="page-link active" href="javascript:void(0);">1</a></li>
                                           <li class="page-item"><a class="page-link" href="javascript:void(0);">2</a></li>
                                           <li class="page-item"><a class="page-link" href="javascript:void(0);"><i class="fas fa-chevron-right"></i></a></li>
                                           <li class="page-item"><input type="text" class="pagination-input" placeholder="100"></li>
                                           <li class="page-item"><a class="page-link per-page">Per Page</a></li>
                                        </ul>
                                     </div> -->
                      </div>

                    </div>



                  </div>
                  <div class="tab-pane fade" id="step-inner-witness-two" role="tabpanel">

                    <!-- <div class="clearfix mb-2">
                      <button type="button"
                        class="btn btn-small float-right" data-toggle="modal"
                        data-target="#other-involved-popup"
                        style="margin-right: 0 !important;"> <i
                          class="fas fa-plus mr-2"></i>{{'add' | translate}}</button>
                    </div> -->
                    <div class="cmn-bdr p-3 d-flex mb-3 align-items-center">
                      <h6 class="mb-0 w-100">Add Other witness</h6>
                      <div class="text-right ml-2" style="width: 100px;">
                        <button type="button" class="btn btn-small" data-toggle="modal" data-target="#other-involved-popup"
                          style="margin: 0 !important;">Add</button>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-lg-6 col-sm-12 edit-and-delete-main"
                        *ngFor=" let user of  IncidentStore.involvedWitnessUserDetails">
                        <div class="hover-body-clr-bg cmn-bdr padding-bottom-none mb-4"
                          *ngIf="IncidentStore.involvedWitnessUserDetails.length != 0 ">
                          <h6>{{user?.name? user.name : AppStore.noContentText}}</h6>
                          <a class="call-and-mail-link mr-3 call-link"><i
                              class="fas fa-phone rotate-icon-call"></i>{{user?.mobile?
                            user.mobile : AppStore.noContentText}}</a>
                          <a *ngIf="user?.email"
                            class="call-and-mail-link mail-link"><i
                              class="fas fa-envelope"></i>{{user?.email?
                            user.email : AppStore.noContentText}}</a>
                          <hr>
                          <div class="row">
                            <div class="col-md-6">
                              <h6>{{'designation' | translate}}</h6>
                              <p>{{user?.designation? user.designation :
                                AppStore.noContentText}}</p>
                            </div>
                            <div class="col-md-6">
                              <h6>{{'company_name' | translate}}</h6>
                              <p>{{user?.company? user.company :
                                AppStore.noContentText}}</p>
                            </div>
                          </div>

                        </div>
                        <div class="edit-option-show"
                          style="margin: 38px 16px 0 0; ">
                          <!-- edit-and-delete starts -->
                          <!-- <a (click)="editInvolvedOthers(user,num)" data-toggle="modal" data-target="#person-involved-popup"><i class="fas fa-pen"></i></a> -->
                          <a (click)="deleteOthersWitnessPersons(user.name)"><i
                              class="fas fa-trash"></i></a>
                        </div>
                      </div>



                    </div>
                    <ng-container *mobxAutorun>
                      <app-no-data-list [source]="investigationEmptyList"
                        *ngIf="IncidentStore.involvedWitnessUserDetails.length == 0 ">
                      </app-no-data-list>
                    </ng-container>


                  </div>
                </div>
              </div>

            </div>


          </div>




        </div><!-- tab end -->
        <div class="tab">
          <!-- tab start -->

          <div class="mb-5">
            <div class="row">
              <div class="col-sm-12 col-lg-8 padding-right-0">
                <div class="bg-white">
                  <div class="issue-top-sec">
                    <div class="clearfix">
                      <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                          class="issue-smoal-head-text">#{{IncidentStore.IncidentItemDetails?.reference_code}}</span>
                        {{form.value.title
                        ?form.value.title
                        :AppStore.noContentText}}<span
                          class="border-left issue-smoal-head-text border-right-0 pl-2 ml-2">{{form.value.incident_damage_type_id?form.value.incident_damage_type_id.title:AppStore.noContentText}}</span>
                      </h5>
                    </div>
                    <div class="clearfix">
                      <p [ngClass]="form.value?.description ? 'label-tag-style mb-2' : 'label-tag-style mb-3'"><i
                          class="fas fa-calendar-alt date-pics-two"></i>{{form.value?.incident_at
                        ?
                        (form.value?.incident_at
                        | date :
                        OrganizationGeneralSettingsStore.organizationSettings?.date_time_format)
                        : AppStore.noContentText }}</p>
                    </div>
                    <p *ngIf="form.value?.description">{{form.value?.description
                      ?
                      form.value?.description:AppStore.noContentText}}
                    </p>
                  </div>

                  <div class="row">
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'reported_date_time' | translate}}</h6>
                      <p>{{form.value?.reported_at
                        ?
                        (form.value?.reported_at
                        | date :
                        OrganizationGeneralSettingsStore.organizationSettings?.date_time_format)
                        : AppStore.noContentText }}</p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'category' | translate}} </h6>
                      <p>{{form.value?.incident_category_ids ?
                        form.value.incident_category_ids.title
                        : AppStore.noContentText }}</p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'incident_sub_category' | translate}}</h6>
                      <p>{{form.value?.incident_sub_category_ids ?
                        form.value.incident_sub_category_ids.title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <div class="label-and-user-pic">
                        <h6>{{'reported_by' | translate}}</h6>
                        <div
                          class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                          <!-- <img src="images/round-7.png" class="rounded-circle rounde-hov details-show-popup" width="35px" height="35px"> -->

                          <div class="pointer new-size-text">
                            <h6>{{form.value.reported_by?form.value.reported_by.first_name:AppStore.noContentText}}
                              {{form.value.reported_by?form.value.reported_by.last_name:AppStore.noContentText}}
                            </h6>
                            <span>{{form.value.reported_by?form.value.reported_by.designation:AppStore.noContentText}}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'involved_party' | translate}}</h6>
                      <p>{{form.value?.incident_stakeholder_ids?.length
                        > 0 ?
                        form.value.incident_stakeholder_ids[0].title
                        : AppStore.noContentText}}</p>
                    </div>
                    <div class="col-lg-4 col-sm-6"
                      *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_subsidiary">
                      <h6>{{'subsidiary' | translate}}</h6>
                      <p>{{form.value?.organization_ids?.length
                        > 0 ?
                        form.value.organization_ids[0].title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6"
                      *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_division">
                      <h6>{{'division' | translate}}</h6>
                      <p>{{form.value?.division_ids?.length
                        > 0
                        ?form.value.division_ids[0].title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6"
                      *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_department">
                      <h6>{{'department' | translate}}</h6>
                      <p>{{form.value?.department_ids?.length
                        > 0 ?
                        form.value.department_ids[0].title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6"
                      *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_section">
                      <h6>{{'section' | translate}}</h6>
                      <p>{{form.value.section_ids?.length
                        > 0
                        ?form.value.section_ids[0].title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6"
                      *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_sub_section">
                      <h6>{{'sub_section' | translate}}</h6>
                      <p>{{form.value.sub_section_ids?.length
                        > 0 ?
                        form.value.sub_section_ids[0].title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'action_taken' | translate}}</h6>
                      <p>{{form.value?.action?form.value?.action:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'incident_root_cause' | translate}} </h6>
                      <p *ngFor="let cause of form.value.investigation_root_cause_ids">
                        {{cause?.title ? cause?.title : AppStore.noContentText}}</p>
                      <p *ngIf="form.value.investigation_root_cause_ids?.length == 0">{{AppStore.noContentText}}</p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'were_safe_work_practices_being_used' | translate}}</h6>
                      <p *ngIf="form.value.is_safe_work == 1">{{'yes' | translate}}</p>
                      <p *ngIf="form.value.is_safe_work == 2">{{'no' | translate}}</p>

                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'incident_damage_types' | translate}}</h6>
                      <p>{{form.value.incident_damage_type_id?form.value.incident_damage_type_id.title:AppStore.noContentText}}
                      </p>
                    </div>
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'incident_damage_severity' | translate}}</h6>
                      <p>{{form.value.incident_damage_severity_id?.title ? form.value.incident_damage_severity_id?.title : AppStore.noContentText}}
                      </p>
                      
                    </div>

                  </div>

                  <div class="row">
                    <div class=" col-sm-12">
                      <h6>{{'incident_investigations' | translate}}</h6>
                      <ul class="arrowlist pl-0 mt-2"
                      *ngIf="IncidentStore.investigationsDes?.length > 0">
                        
                        <li style="white-space: pre-wrap;"
                          *ngFor="let row of IncidentStore.investigationsDes">{{row}}
                        </li>
                      </ul>
                      <p *ngIf="IncidentStore.investigationsDes.length == 0">
                        {{AppStore.noContentText}}</p>
                    </div>
                    <div class=" col-sm-12">
                      <h6>{{'significant_observations' | translate}} </h6>
                      <ul class="arrowlist pl-0 mt-2"
                      *ngIf="IncidentStore.significantObservationsDes?.length > 0">
                        
                        <li style="white-space: pre-wrap;"
                          *ngFor="let row of IncidentStore.significantObservationsDes">
                          {{row}}</li>
                      </ul>
                      <p *ngIf="IncidentStore.significantObservationsDes.length == 0">
                          {{AppStore.noContentText}}</p>
                    </div>
                    <div class=" col-sm-12">
                      <h6>{{'recommendations' | translate}} </h6>
                      <ul class="arrowlist pl-0 mt-2"
                      *ngIf="IncidentStore.recommendationsDes?.length > 0">
                        
                        <li style="white-space: pre-wrap;"
                          *ngFor="let row of IncidentStore.recommendationsDes">{{row}}
                        </li>
                      </ul>
                      <p *ngIf="IncidentStore.recommendationsDes.length == 0">
                        {{AppStore.noContentText}}</p>
                    </div>
                    <div class=" col-sm-12">
                      <h6>{{'references' | translate}} </h6>
                      <ul class="arrowlist pl-0 mt-2"
                      *ngIf="IncidentStore.referencesDes?.length > 0">
                      
                        <li style="white-space: pre-wrap;"
                          *ngFor="let row of IncidentStore.referencesDes">{{row}}</li>
                      </ul>
                      <p *ngIf="IncidentStore.referencesDes.length == 0">
                        {{AppStore.noContentText}}</p>
                    </div>
                  </div>

                </div>
              </div>
              <div class="col-sm-12 col-lg-4">
                <h5 class="cmn-head-style">{{'person_involved' | translate}}</h5>
                <div class="risk-rating-box bg-white p-3 mb-3">
                  <h6 class="text-left">{{'employee' | translate}}</h6>
                  <hr class="mt-0 mb-3">

                  <div class="row"
                  *ngIf="IncidentInvestigationStore.investigationItemDetails?.investigation_involved_users > 0">
                    <div class=" col-lg-6 col-sm-12 text-left"
                       *ngFor="let involved of IncidentInvestigationStore.investigationItemDetails?.investigation_involved_users; let isLast=last">
            
                        <div
                         class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                         <app-user-popup-box [source]="assignUserValues(involved)" [showName]="true">
                         </app-user-popup-box>
            
                        </div>
                    </div>
                   </div>
                   <p class="text-left" *ngIf="IncidentInvestigationStore.investigationItemDetails?.investigation_involved_users?.length == 0">
                     {{AppStore.noContentText}}
                   </p>

                  <h6 class="text-left mt-3">{{'others' | translate}}</h6>
                  <hr class="mt-0 mb-3">
                   <div *ngIf="IncidentStore.involvedOtherUserDetails?.length > 0">
                    <div *ngFor="let data of involvedOthers()"
                    class="name-and-position name-and-position-bdr cmn-bdr text-left">
                    <div class="row">
                      <div class="col-sm-12">
                        <!-- <h6 >Description</h6> -->
                        <p *ngIf="data.remarks">{{data?.remarks}} </p>
                      </div>
                      <div class="col-sm-12">
                        <h6>{{data?.name ? data.name : AppStore.noContentText }} </h6>
                        <span> {{data?.mobile ? data.mobile :
                          AppStore.noContentText}}</span>
                      </div>
                      <div class="col-sm-6 col-lg-6">
                        <h6 class="mt-3">Gender</h6>
                        <span>{{data?.gender ? data.gender :
                          AppStore.noContentText}}</span>
                      </div>
                      <div class="col-sm-6 col-lg-6">
                        <h6 class="mt-3">Age</h6>
                        <span>{{data?.age ? data.age : AppStore.noContentText }}</span>
                      </div>
                      <div class="col-sm-12 col-lg-6">
                        <h6 class="mt-3">Designation</h6>
                        <span>{{data?.designation ? data.designation:
                          AppStore.noContentText}}</span>
                      </div>
                      <div class="col-sm-12">
                        <h6 class="mt-3">Email</h6>
                        <span>{{data?.email ? data.email :
                          AppStore.noContentText}}</span>
                      </div>
                      <div class="col-sm-12">
                        <h6 class="mt-3">Company Name</h6>
                        <span>{{data?.company? data.company: AppStore.noContentText
                          }}</span>
                      </div>
                    </div>
                  </div>
                   </div>
                  <p class="text-left" *ngIf="IncidentStore.involvedOtherUserDetails?.length == 0">
                    {{AppStore.noContentText}}
                  </p>

                  <a class="view-more-pestel-box text-center"
                    *ngIf="IncidentStore.involvedOtherUserDetails?.length > 2"
                    data-toggle="modal" data-target="#others-popup"
                    (click)="openOtherInvolvedPerson()">{{'view_more' | translate}}</a>

                </div>

                <h5 class="cmn-head-style mt-3">{{'witness' | translate}}</h5>
                <div class="risk-rating-box bg-white p-3 mb-3">
                  <h6 class="text-left">{{'employee' | translate}}</h6>
                  <hr class="mt-0 mb-3">
                  <div class="row"
                  *ngIf="IncidentInvestigationStore.investigationItemDetails?.investigation_witness_users?.length > 0">
                    <div class=" col-lg-6 col-sm-12 text-left"
                       *ngFor="let witness of IncidentInvestigationStore.investigationItemDetails?.investigation_witness_users; let isLast=last">
            
                        <div
                         class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                         <app-user-popup-box [source]="assignUserValues(witness)" [showName]="true">
                         </app-user-popup-box>
            
                        </div>
                    </div>
                   </div>
                   <p class="text-left" *ngIf="IncidentInvestigationStore.investigationItemDetails?.investigation_witness_users?.length == 0">
                    {{AppStore.noContentText}}
                  </p>

                  <h6 class="text-left mt-3">{{'others' | translate}}</h6>
                  <hr class="mt-0 mb-3">
                  <div *ngIf="IncidentStore.involvedWitnessUserDetails?.length > 0">
                    <div *ngFor="let data of othersWitness()"
                    class="name-and-position name-and-position-bdr cmn-bdr text-left">
                    <div class="row">
                      <div class="col-sm-12">
                        <!-- <h6 >Description</h6> -->
                        <p *ngIf="data?.remarks">{{data?.remarks? data?.remarks :
                          AppStore.noContentText }} </p>
                      </div>
                      <div class="col-sm-12">
                        <h6>{{data?.name ? data.name : AppStore.noContentText }} </h6>
                        <span> {{data?.mobile ? data.mobile :
                          AppStore.noContentText}}</span>
                      </div>

                      <div class="col-sm-12 col-lg-6">
                        <h6 class="mt-3">{{'designation' | translate}}</h6>
                        <span>{{data?.designation ? data.designation:
                          AppStore.noContentText}}</span>
                      </div>
                      <div class="col-sm-12">
                        <h6 class="mt-3">{{'email' | translate}}</h6>
                        <span>{{data?.email ? data.email :
                          AppStore.noContentText}}</span>
                      </div>
                      <div class="col-sm-12">
                        <h6 class="mt-3">{{'company_name' | translate}}</h6>
                        <span>{{data?.company? data.company: AppStore.noContentText
                          }}</span>
                      </div>
                    </div>
                  </div>
                  </div>
                  <p class="text-left" *ngIf="IncidentStore.involvedWitnessUserDetails?.length == 0">
                    {{AppStore.noContentText}}
                  </p>

                  <a class="view-more-pestel-box text-center"
                    *ngIf="IncidentStore.involvedWitnessUserDetails?.length > 2"
                    data-toggle="modal" data-target="#others-popup"
                    (click)="openOthersWitnessModel()">{{'view_more' | translate}}</a>

                </div>

                <h6>{{'evidence' | translate}}</h6>
                <p *ngIf="IncidentInvestigationStore?.investigationIncidentObjects?.documents?.length==0">
                  {{AppStore.noContentText}}</p>
                <div class="thumb-pics-bg thumb-pics-col-2 thumb-pics-fix-text clearfix">
                  <div class="thumb-pics"
                    *ngFor="let doc of form.value?.documents">
                    <div class="upload-pics edit-option">
                      <div *ngIf="doc.preview" class="browse-form-pic"
                        [ngStyle]="{'background': 'url(' + doc.preview + ') no-repeat 0 0 / cover'}">
                      </div>
                      <div *ngIf="!doc.preview" class="browse-form-pic"
                        [ngStyle]="{'background': 'url(' + createImageUrl('incident-item',doc.token) + '), url(' + getDefaultImage('no-preview') + ') no-repeat 0 0 / cover '}">
                      </div>
                      <div class="browse-form-name clearfix">
                        <div class="float-left">
                          <h6 *ngIf="!doc.preview" [attr.title]="doc.title">
                            {{doc?.title?.length > 13 ? doc.title.substring(0,13)+'
                            ...': doc?.title}}
                          </h6>
                          <h6 *ngIf="doc.preview">{{doc?.name?.length>15 ?
                            doc?.name.substring(0,15)+' ...':doc?.name}}</h6>
                          <span>{{doc.size/1048576 | number:'0.2-2'}}MB</span>
                        </div>
                        <div class="browse-logo">
                          <img *ngIf="checkExtension(doc.ext,'image') != -1"
                            src="/assets/images/md-jpg.png">
                          <img *ngIf="checkExtension(doc.ext,'doc') != -1"
                            src="/assets/images/word-icone.png">
                          <img *ngIf="checkExtension(doc.ext,'pdf') != -1"
                            src="/assets/images/pdf-icone.png">
                          <img *ngIf="checkExtension(doc.ext,'excel') != -1"
                            src="/assets/images/excel-icone.png">
                          <img *ngIf="checkExtension(doc.ext,'video') != -1"
                            src="/assets/images/md-video.png">
                          <img *ngIf="checkExtension(doc.ext,'audio') != -1"
                            src="/assets/images/md-audio.png">
                          <img *ngIf="checkExtension(doc.ext,'ppt') != -1"
                            src="/assets/images/md-ppt.png">
                        </div>
                      </div>
                      <!-- <div class="edit-option-show-inner" title="Download Document">
                                              <a><i class="fas fa-download"
                                                      ></i></a>
                                          </div> -->
                    </div>
                  </div>
                </div>



              </div>
            </div>



          </div>

        </div><!-- tab end -->

        <div style="overflow:auto;">
          <div class="form-next-page-btns" style="float:left;">
            <button class="btn btn-active" type="button" id="nextBtn" [disabled]="form.invalid"
              (click)="nextPrev(1)">{{getButtonText(nextButtonText)}}</button>
            <button class="btn" type="button" id="prevBtn"
              (click)="nextPrev(-1)">{{getButtonText(previousButtonText)}}</button>
            <button class="btn" type="button" (click)="cancelClicked()">{{'cancel' | translate}}</button>
          </div>
        </div>

      </form>
    </div>
  </div>
</main>