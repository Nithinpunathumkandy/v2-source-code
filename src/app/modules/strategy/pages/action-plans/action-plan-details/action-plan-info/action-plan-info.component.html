<app-action-plan-detals-loader *ngIf="!ActionPlansStore.induvalActionPlanLoaded"></app-action-plan-detals-loader>
<main class="organization-page  mt-3" *ngIf="ActionPlansStore.induvalActionPlanLoaded">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12">
        <div class="widget">

          <div class="row">
            <div class="col-lg-8 col-sm-12 padding-right-0">
              <div class="bg-white widg-padding-cmn">
                <div class="min-height-64">

                  <div class="issue-top-sec">
                    <div class="clearfix">
                      <h5 class="d-inline-block cmn-head-style label-tag-style">
                        {{ActionPlansStore.induvalActionPlan?.title}} <span
                          [ngClass]="'dot-div '+ActionPlansStore.induvalActionPlan?.review_frequency?.strategy_initiative_action_plan_review_frequency_status?.label+'-dot'"
                          style="line-height: 16px; vertical-align: middle; margin-top: -4px; display: inline-block;">
                          {{ActionPlansStore.induvalActionPlan?.review_frequency?.strategy_initiative_action_plan_review_frequency_status
                          ?
                          ActionPlansStore.induvalActionPlan?.review_frequency?.strategy_initiative_action_plan_review_frequency_status?.language[0]?.pivot?.title
                          : "New"}}</span></h5>
                    </div>
                    <div class="clearfix">
                      <p class="label-tag-style mb-2"><i class="fas fa-calendar-alt date-pics-two"></i>
                        {{ActionPlansStore.induvalActionPlan?.start_date | date:
                        OrganizationGeneralSettingsStore.organizationSettings?.date_format}} -
                        {{ActionPlansStore.induvalActionPlan?.end_date | date:
                        OrganizationGeneralSettingsStore.organizationSettings?.date_format}} <span
                          class="blinking"></span></p>
                    </div>
                    <p style="white-space: pre-wrap;">{{ActionPlansStore.induvalActionPlan?.justification ?
                      ActionPlansStore.induvalActionPlan?.justification : AppStore.noContentText}}</p>
                  </div>

                  <div class="row">
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'strategy_profile' | translate }}</h6>
                      <p>{{ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile?.title}}</p>
                    </div>

                    <!-- <div class="col-lg-4 col-sm-6">
                      <h6>{{'focus_area' | translate }}</h6>
                      <p>
                        {{ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile_focus_area?.focus_area?.title}}
                      </p>
                    </div>

                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'objective' | translate }}</h6>
                      <p>
                        {{ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile_objective?.objective?.title}}
                      </p>
                    </div> -->

                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'Initiative' | translate }}</h6>
                      <p>{{ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_initiative_action?.title}}
                        {{ActionPlansStore.induvalActionPlan?.strategy_intiative?.title}}</p>
                    </div>

                    <div *ngIf="ActionPlansStore.induvalActionPlan?.strategy_intiative?.is_milestone"
                      class="col-lg-4 col-sm-6">
                      <h6>{{'milestone' | translate }}</h6>
                      <p>{{ActionPlansStore.induvalActionPlan?.strategy_initiative_milestone?.title ?
                        ActionPlansStore.induvalActionPlan?.strategy_initiative_milestone?.title :
                        AppStore.noContentText}}</p>
                    </div>

                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'sm_actual_end_date' | translate }}</h6>
                      <p>{{ActionPlansStore.induvalActionPlan?.actual_end_date ?
                        (ActionPlansStore.induvalActionPlan?.actual_end_date | date:
                        OrganizationGeneralSettingsStore.organizationSettings?.date_format) : AppStore.noContentText}}
                      </p>
                    </div>

                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'sm_cost' | translate }}</h6>
                      <p>{{ActionPlansStore.induvalActionPlan?.cost ? ActionPlansStore.induvalActionPlan?.cost :0}} {{OrganizationGeneralSettingsStore?.organizationSettings?.currency}}
                      </p>
                    </div>
                    
                    <div class="col-lg-4 col-sm-6">
                      <h6>{{'target' | translate }}</h6>
                      <p>{{ActionPlansStore.induvalActionPlan?.target ? ActionPlansStore.induvalActionPlan?.target :
                        AppStore.noContentText}} {{ActionPlansStore.induvalActionPlan?.target ? ActionPlansStore.induvalActionPlan?.target_unit?.title : ''}}</p>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-4 col-sm-6"
                        *ngIf="ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile_objectives?.length > 0">
                        <h5 class="cmn-head-style mb-3">{{'objective' | translate}}</h5>
                        <ul class="arrowlist mt-0 p-0">
                            <li *ngFor="let objective of ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile_objectives">
                                {{objective?.objective?.title}}</li>
                        </ul>
                    </div>
                    
                    <div class="col-lg-4 col-sm-6"
                        *ngIf="ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile_focus_areas?.length > 0">
                        <h5 class="cmn-head-style mb-3">{{'focus_area' | translate}}</h5>
                        <ul class="arrowlist mt-0 p-0">
                            <li *ngFor="let focus of ActionPlansStore.induvalActionPlan?.strategy_intiative?.strategy_profile_focus_areas">
                                {{focus?.focus_area?.title}}</li>
                        </ul>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-12">
                      <h6>{{'review_users' | translate }}</h6>
                      <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix">
                        <li *ngFor="let user of ActionPlansStore.induvalActionPlan?.review_users" class="rounde-hov-bg">
                          <app-user-popup-box [source]="getPopupDetails(user)" [showName]="false"
                            [activateButtons]="false"></app-user-popup-box>
                        </li>
                      </ul>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-lg-12 col-sm-12">
                      <h6>{{'attachments' | translate }}</h6>
                      <p
                        *ngIf="ActionPlansStore.induvalActionPlan?.strategy_initiative_action_plan_documents?.length == 0">
                        {{AppStore.noContentText}}</p>
                      <div class="thumb-pics-bg thumb-pics-col-4 clearfix"
                        *ngIf="ActionPlansStore.induvalActionPlan?.strategy_initiative_action_plan_documents?.length > 0">


                        <div class="thumb-pics"
                          *ngFor="let doc of ActionPlansStore.induvalActionPlan?.strategy_initiative_action_plan_documents">
                          <div class="upload-pics edit-option"
                            *ngIf="!doc.document_id && AuthStore.getActivityPermission(3200, 'PREVIEW_STRATEGY_INITIATIVE_REVIEW_DOCUMENT_FILE')"
                            (click)="viewIncidentDocument('plan-measure',doc,ActionPlansStore.induvalActionPlan?.id,doc)">
                            <div class="browse-form-pic"
                              [ngStyle]="{'background': 'url(' + createImageUrl('plan-measure',doc.token) + '), url(' + getDefaultImage('no-preview') + ') no-repeat 0 0 / cover '}">
                            </div>
                            <div class="browse-form-name clearfix">
                              <div class="float-left">
                                <h6 *ngIf="doc.title" [attr.title]="doc.title">
                                  {{doc.title.length > 13 ? doc.title.substring(0,13)+'
                                  ...': doc.title}}
                                </h6>
                                <span>{{doc.size/1048576 | number:'0.2-2'}}MB</span>
                              </div>
                              <div class="browse-logo">
                                <img *ngIf="checkExtension(doc.ext,'image') != -1" src="/assets/images/md-jpg.png">
                                <img *ngIf="checkExtension(doc.ext,'doc') != -1" src="/assets/images/word-icone.png">
                                <img *ngIf="checkExtension(doc.ext,'pdf') != -1" src="/assets/images/pdf-icone.png">
                                <img *ngIf="checkExtension(doc.ext,'excel') != -1" src="/assets/images/excel-icone.png">
                                <img *ngIf="checkExtension(doc.ext,'video') != -1" src="/assets/images/md-video.png">
                                <img *ngIf="checkExtension(doc.ext,'audio') != -1" src="/assets/images/md-audio.png">
                                <img *ngIf="checkExtension(doc.ext,'ppt') != -1" src="/assets/images/md-ppt.png">
                              </div>
                            </div>
                            <div class="edit-option-show-inner" title="Download Document">
                              <a
                                *ngIf="AuthStore.getActivityPermission(3200, 'DOWNLOAD_STRATEGY_INITIATIVE_REVIEW_DOCUMENT')"><i
                                  class="fas fa-download"
                                  (click)="downloKpiMesureDocument('plan-measure',doc,doc,ActionPlansStore.induvalActionPlan?.id)"></i></a>
                            </div>
                          </div>

                          <div class="upload-pics edit-option"
                            *ngIf="doc.document_id && AuthStore.getActivityPermission(3200, 'PREVIEW_STRATEGY_INITIATIVE_REVIEW_DOCUMENT_FILE')">
                            <div *ngFor="let mainDoc of doc.kh_document.versions"
                              (click)="viewIncidentDocument('document-version', doc,ActionPlansStore.induvalActionPlan?.id,mainDoc)">


                              <div class="browse-form-pic"
                                [ngStyle]="{'background': 'url('+createImageUrl('document-version',mainDoc?.token)+') no-repeat'}">
                              </div>
                              <div class="browse-form-name clearfix">
                                <div class="float-left">
                                  <h6 [attr.title]="doc.title">
                                    {{mainDoc.title}}.{{mainDoc.ext}}
                                  </h6>
                                  <span>{{mainDoc.size/1048576 | number:'0.2-2'}}MB</span><span
                                    class="text-blue bold pl-2">{{'knowledge_hub' | translate }}</span>
                                </div>
                                <div class="browse-logo">
                                  <img *ngIf="checkExtension(mainDoc.ext,'image') != -1"
                                    src="/assets/images/md-jpg.png">
                                  <img *ngIf="checkExtension(mainDoc.ext,'mainDoc') != -1"
                                    src="/assets/images/word-icone.png">
                                  <img *ngIf="checkExtension(mainDoc.ext,'pdf') != -1"
                                    src="/assets/images/pdf-icone.png">
                                  <img *ngIf="checkExtension(mainDoc.ext,'excel') != -1"
                                    src="/assets/images/excel-icone.png">
                                  <img *ngIf="checkExtension(mainDoc.ext,'video') != -1"
                                    src="/assets/images/md-video.png">
                                  <img *ngIf="checkExtension(mainDoc.ext,'audio') != -1"
                                    src="/assets/images/md-audio.png">
                                  <img *ngIf="checkExtension(mainDoc.ext,'ppt') != -1" src="/assets/images/md-ppt.png">
                                </div>
                              </div>
                              <div class="edit-option-show-inner" title="Download Document">
                                <a
                                  *ngIf="AuthStore.getActivityPermission(3200, 'DOWNLOAD_STRATEGY_INITIATIVE_REVIEW_DOCUMENT')"><i
                                    class="fas fa-download"
                                    (click)="downloKpiMesureDocument('document-version',doc,mainDoc,ActionPlansStore.induvalActionPlan?.id)"></i></a>
                              </div>

                            </div>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>

                <div class="row">
                  <div class="col-xl-12">
                    <hr>
                    <div class="d-flex flex-row user-list-sm">
                      <app-user-popup-box
                        [source]=" getCreatedByPopupDetails(ActionPlansStore.induvalActionPlan?.created_by,ActionPlansStore.induvalActionPlan?.created_at)"
                        [showName]="true" [activateButtons]="false">
                      </app-user-popup-box>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <div class="col-lg-4 col-sm-12">
              <div class="bg-white widg-padding-cmn-small mb-3">
                <h6 class="text-left">{{'achievement' | translate }}</h6>
                <hr class="mt-0 mb-3">
                <div class="residual-risk-graph text-center" *ngIf="ActionPlansStore.induvalActionPlan?.actual_value" >
                  <div id="gaugechartdiv"></div>
                </div>
                <div class="chart-new-round-pic text-right" style="width: 100%;" *ngIf="!ActionPlansStore.induvalActionPlan?.actual_value">
                  <app-no-chart-data [source]="'gauge'">
                  </app-no-chart-data>
              </div>
              </div>


              <div class="bg-white widg-padding-cmn-small mb-3" *ngIf="ActionPlansStore.induvalActionPlan?.closed_by">
                <h6 class="text-left">{{'closed_by' | translate }}</h6>
                <hr class="mt-0 mb-3">
                <app-user-popup-box *ngIf="ActionPlansStore.induvalActionPlan?.closed_by"
                  [source]="getCreatedByPopupDetails(ActionPlansStore.induvalActionPlan?.closed_by)" [showName]="true"
                  [activateButtons]="true"></app-user-popup-box>
                <!-- <p *ngIf="!ActionPlansStore.induvalActionPlan?.closed_by">NA</p> -->
                <ng-container>
                  <app-context-no-data *ngIf="!ActionPlansStore.induvalActionPlan?.closed_by"
                    [sourceData]="getNoDataSource('center')"></app-context-no-data>
                </ng-container>
              </div>



              <div class="bg-white widg-padding-cmn-small mb-3">
                <h6 class="text-left">
                  <!-- {{ActionPlansStore.induvalActionPlan?.budget_used}}%  -->
                  {{'total_budget_used' | translate }}</h6>
                <hr class="mt-0 mb-3">

                <!-- <div
                  [ngClass]="ActionPlansStore.induvalActionPlan?.budget_used > 50 ?'progress-circle progress-circle-big-one over50 p'+ActionPlansStore.induvalActionPlan?.budget_used:'progress-circle progress-circle-big-one p'+ActionPlansStore.induvalActionPlan?.budget_used">
                  <span>{{ActionPlansStore.induvalActionPlan?.budget_used ?
                    ActionPlansStore.induvalActionPlan?.budget_used : 0}}%</span>
                  <div class="left-half-clipper">
                    <div class="first50-bar"></div>
                    <div class="value-bar"></div>
                  </div>
                </div> -->
                <h5 class="text-light-blue text-center pt-2">
                  {{OrganizationGeneralSettingsStore?.organizationSettings?.currency}}{{ActionPlansStore.induvalActionPlan?.cost
                  ? ActionPlansStore.induvalActionPlan?.cost : '0'}} {{'used_for_action_plan' | translate }}</h5>
              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</main>

<div class="modal modal-style-1 popup-full-width fade" id="add-new-notes-popup" data-keyboard="false"
  data-backdrop="static" #planMesure>
  <app-add-plans-measure *ngIf="planMesureObject.type" [source]="planMesureObject"></app-add-plans-measure>
</div>

<!-- responsible user popup -->
<div class="modal modal-style-1 popup-full-width fade" id="add-milestone-popup" data-keyboard="false"
  data-backdrop="static" #otherResponsibleUsers>
  <app-other-responsible-users-modal [source]="otherResponsibleUsersObject" *ngIf="otherResponsibleUsersObject.type">
  </app-other-responsible-users-modal>
</div>

<div class="modal modal-style-1 fade" id="delete-popup" #confirmationPopUp data-backdrop="static" data-keyboard="false">
  <app-delete-popup [source]="popupObject"></app-delete-popup>
</div>

<div class="modal modal-style-1 popup-full-width fade popup-new-type" id="add-three-popup" data-keyboard="false"
  data-backdrop="static" #filePreviewModal *mobxAutorun>
  <button type="button" class="close" data-dismiss="modal" (click)="closePreviewModal($event)"><i
      class="lni-close"></i><span>esc</span></button>
  <app-preview-modal *ngIf="previewObject" [source]="previewObject" (close)="closePreviewModal($event)">
  </app-preview-modal>
</div>

<ng-container>
  <div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #commentModal>
    <app-action-plan-workflow-comment *ngIf="ActionPlanWorkflowStore.commentForm">
    </app-action-plan-workflow-comment>
  </div>
</ng-container>


<div class="modal modal-style-1 popup-full-width fade" id="process-popup" data-keyboard="false" data-backdrop="static"
  #workflowHistory *mobxAutorun>
  <app-action-plan-workflow-history *ngIf="workflowHistoryOpened == true"></app-action-plan-workflow-history>
</div>