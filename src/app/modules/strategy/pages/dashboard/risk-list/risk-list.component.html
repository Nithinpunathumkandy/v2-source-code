
<nav class="edit-bar" data-toggle="affix" #navigationBar *mobxAutorun>

    <app-sub-menu></app-sub-menu>
</nav>
  <main class="mt-3 acl-page" *mobxAutorun>
    <app-filter-menu></app-filter-menu>
    <div class="container-fluid"
      *ngIf="RisksStore.loaded && RisksStore.riskDetails?.length>0 && AuthStore.getActivityPermission(900,'RISK_LIST')">
      <div class="audit-program-box audit-page-table-main">
        <div class="row">
          <div class="col-sm-12">
            <div class="full-width-table table-scroll-first-time">
            <table class="table table-bordered ordinary-table audit-page-table mb-1 table-scroll" style="width:4000px !important">
              <thead>
                <tr>
                  <th></th>
                  <th colspan="6" class="text-center">{{'risk_statement'|translate}}</th>
                  <th colspan="4" class="text-center">{{'inherent_risk_rating'|translate}}</th>
                  <th colspan="3"></th>
                  <th colspan="4" class="text-center">{{'residual_risk_rating'|translate}}</th>
                  <th colspan="3"></th>
                 
                </tr>
                <tr>
                  
                  <th class="border-top-0" width="2%">#</th>
                  <th class="border-top-0 pointer" width="3%" (click)="setRiskSort('reference_code')">{{'ref_id' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'reference_code'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <!-- <th class="border-top-0 pointer" width="3%" (click)="setRiskSort('risks.id')">Risk ID
                    <img *ngIf="RisksStore.orderItem == 'risks.id'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th> -->
                  <th class="border-top-0 pointer" [style.width.%]="OrganizationLevelSettingsStore.organizationLevelSettings?.is_division ? 12 : 16" (click)="setRiskSort('risks.title')">{{'risk_opportunity' | translate}}
                    <img *ngIf="RisksStore.orderItem == 'risks.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0" width="8%">{{'description' | translate}}
                   
                  </th>
                 
                  <th class="border-top-0 pointer" *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_division" class="border-top-0 pointer" [style.width.%]="OrganizationLevelSettingsStore.organizationLevelSettings?.is_division ? 4 : ''" (click)="setRiskSort('divisions.title')">{{'divisions' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'divisions.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('departments.title')">{{'departments'
                    | translate}}
                    <img *ngIf="RisksStore.orderItem == 'departments.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('risk_categories.title')">
                    {{'risk_category' | translate}}
                    <img *ngIf="RisksStore.orderItem == 'risk_categories.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
  
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('likelihoods.title')">{{'likelihood' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'likelihoods.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('impacts.title')">{{'impact' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'impacts.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
  
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('risks.inherent_risk_score')">{{'risk_score' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'risks.inherent_risk_score'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                 
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('risk_ratings.title')">{{'risk_rating' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'risk_ratings.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                 
                  <th class="border-top-0 pointer" width="3%" (click)="setRiskSort('risk_sources.title')">{{'risk_sources'
                    | translate}}
                    <img *ngIf="RisksStore.orderItem == 'risk_sources.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0 pointer" width="8%" (click)="setRiskSort('users.first_name')">{{'risk_owner'|translate}}
                    <img *ngIf="RisksStore.orderItem == 'users.first_name'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('statuses.title')">{{'risk_status' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'statuses.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('likelihoods.title')">{{'likelihood' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'likelihoods.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('impacts.title')">{{'impact' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'impacts.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
  
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('risks.inherent_risk_score')">{{'risk_score' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'risks.inherent_risk_score'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                 
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('risk_ratings.title')">{{'risk_rating' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'risk_ratings.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                 
                  <!-- <th>
                  </th> -->
                  <th class="border-top-0 pointer" width="4%" (click)="setRiskSort('risk_types.title')">{{'risk_types' |
                    translate}}
                    <img *ngIf="RisksStore.orderItem == 'risk_types.title'"
                      [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                      class="sort-down-pics">
                  </th>
                 
                  <th class="border-top-0" width="7%">
                    {{'risk_treatment_strategy'|translate}}
                   
                  </th>
  
                
                
               
                  <th class="border-top-0" width="5%">{{'risk_mitigation_status'|translate}}
                  
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr class="pointer edit-and-delete-main"
                  *ngFor="let risk of RisksStore.riskDetails| paginate: {currentPage:RisksStore?.currentPage, itemsPerPage:RisksStore?.itemsPerPage,totalItems:RisksStore?.totalItems};let num = index">
                  <td>{{(RisksStore?.currentPage - 1) * RisksStore?.itemsPerPage + (num +1)}}</td>
                  <td (click)="getDetails(risk.id)">#{{risk.reference_code}}</td>
                  <!-- <td (click)="getDetails(risk.id)">{{risk.id}}</td> -->
                  
                  <td (click)="getDetails(risk.id)">{{risk.title}}</td>
                  <td (click)="getDetails(risk.id)">
                    <div class="elips-2" [title]="risk.description">
                      {{risk.description ? risk.description : AppStore.noContentText}}
                    </div>
                 
                   
                  </td>
                  <td *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_division" (click)="getDetails(risk.id)">{{risk.divisions?risk.divisions:AppStore.noContentText}}</td>
                  <td (click)="getDetails(risk.id)">{{risk.departments?risk.departments:AppStore.noContentText}}</td>
                  <td (click)="getDetails(risk.id)">{{risk.risk_category_title}}</td>
                  <td (click)="getDetails(risk.id)">{{risk.inherent_likelihood_title?risk.inherent_likelihood_title:AppStore.noContentText}}</td>
                  <td (click)="getDetails(risk.id)">{{risk.inherent_impact_title?risk.inherent_impact_title:AppStore.noContentText}}</td>
                  <td (click)="getDetails(risk.id)">{{risk.inherent_risk_score?risk.inherent_risk_score:AppStore.noContentText}}</td>
                  
                  <td (click)="getDetails(risk.id)">{{risk.inherent_risk_rating_title?risk.inherent_risk_rating_title:AppStore.noContentText}}</td>
                 <td (click)="getDetails(risk.id)">{{risk.risk_sources?risk.risk_sources:AppStore.noContentText}}</td>
                  <td (click)="getDetails(risk.id)">
                    <div class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg" *ngIf="risk.risk_owner_first_name">
                      <img
                          [attr.src]="risk.risk_owner_image_token?createImagePreview('user-profile-picture',risk.risk_owner_image_token):getDefaultImage('user-logo')"
                          width="30px" height="30px" class="rounded-circle">
                      
                      <div>
                          <h6>{{risk.risk_owner_first_name}} {{risk.risk_owner_last_name}}</h6>
                          <span>{{risk.risk_owner_designation}} </span>
                      </div>
                  </div>
                <p *ngIf="!risk.risk_owner_first_name">{{AppStore.noContentText}}</p></td>
                <td class="text-center" (click)="getDetails(risk.id)">
                  <div [ngClass]="'dot-div '+risk.label+'-dot'">
                    {{risk.risk_status_title}}</div>
                </td>
                <td (click)="getDetails(risk.id)">{{risk.residual_likelihood_title?risk.residual_likelihood_title:AppStore.noContentText}}</td>
                  
                  <td (click)="getDetails(risk.id)">{{risk.residual_impact_title?risk.residual_impact_title:AppStore.noContentText}}</td>
                  <td (click)="getDetails(risk.id)">{{risk.residual_risk_score?risk.residual_risk_score:AppStore.noContentText}}</td>
                  
                  <td (click)="getDetails(risk.id)">{{risk.residual_risk_rating_title?risk.residual_risk_rating_title:AppStore.noContentText}}</td>
                  
                  <td (click)="getDetails(risk.id)">
                    {{risk.risk_types?risk.risk_types:AppStore.noContentText}}</td>
  
                  <!-- <td>Rare</td>
                         <td>Minor</td>
                         <td><div class="dot-div red-dot">High (25)</div></td> -->
                  <!-- <td (click)="getDetails(risk.id)"> <p style="white-space:pre-wrap">{{risk.risk_observation?risk.risk_observation:AppStore.noContentText}}</p></td>
                  <td (click)="getDetails(risk.id)"> <p style="white-space:pre-wrap">{{risk.risk_cause?risk.risk_cause:AppStore.noContentText}}</p></td>
                  <td (click)="getDetails(risk.id)"> <p style="white-space:pre-wrap">{{risk.last_review_note?risk.last_review_note:AppStore.noContentText}}</p></td>
            -->
            <td (click)="getDetails(risk.id)">{{risk.risk_treatment_strategy?risk.risk_treatment_strategy:AppStore.noContentText}}</td>
            <!-- <td (click)="getDetails(risk.id)">{{risk.risk_treatment_plan?risk.risk_treatment_plan:AppStore.noContentText}}</td> -->
            
                 
                  <td class="text-center">
                    <!-- <div class="edit-option-show" style="margin:6px 0 0 0">
                      <a [attr.title]="'view'|translate" (click)="viewDetails(row.employee_id,row.id)"><i
                                     class="fas fa-eye"></i></a>
                      <a *ngIf="risk.risk_status_id==1" [attr.title]="'edit'|translate" (click)="editRisk(risk.id)"><i class="fas fa-pen"></i></a>
                      <a [attr.title]="'delete'|translate" (click)="deleteRisk(risk.id,num)"><i
                          class="fas fa-trash"></i></a>
                    </div> -->
                    <div *ngIf="risk.treatment_status_title" [ngClass]="'dot-div '+risk.treatment_status_label+'-dot'">
                      {{risk.treatment_status_title}}
                    </div>
                    <div *ngIf="!risk.treatment_status_title">
                      {{AppStore.noContentText}}
                    </div>
                       
                  </td>
                </tr>
              </tbody>
            </table>
          
          </div>
          <p class="float-right bold mb-0" *ngIf="RisksStore?.loaded && RisksStore.totalItems > 0">{{'total_Items' | translate}}:{{RisksStore?.totalItems}}</p>
  
          </div>
          <div class="col-sm-12" *ngIf="RisksStore?.totalItems>RisksStore?.itemsPerPage">
            <ul class="pagination justify-content-center mt-3">
              <pagination-controls (pageChange)="pageChange($event)" class="my-pagination"></pagination-controls>
            </ul>
  
          </div>
        </div>
      </div>
    </div>

    <ng-container *mobxAutorun>
      <div *ngIf="!RisksStore.loaded">
        <app-profile-list-loader></app-profile-list-loader>
      </div>
    </ng-container>

    <ng-container *mobxAutorun>
      <app-no-data *ngIf="RisksStore.loaded && RisksStore.riskDetails?.length==0" [border]=false></app-no-data>
    </ng-container>
  </main>