<button type="button" class="close" (click)="cancel()"><i class="lni-close"></i><span>{{'esc' | translate}}</span></button>

<div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
        <div class="modal-body form-body">
            <p class="head-details"></p>
            <div class="row" *ngIf="StrategyMappingStore?.objectiveDetailLoaded">
                <div class="col-sm-12">
                    <div class="widg-padding-cmn bg-white">
                        <div>
                            <div class="issue-top-sec">
                                <div class="clearfix">
                                    <h5 class="d-inline-block cmn-head-style label-tag-style">
                                        {{StrategyMappingStore?.getObjectiveDetails?.objective?.title ?
                                        StrategyMappingStore?.getObjectiveDetails?.objective?.title :
                                        StrategyMappingStore?.getObjectiveDetails?.title}}
                                        <!-- <span class="draft-tag label-tag-style-tag label-left-arow-tag"
                                            style="line-height: 16px; vertical-align: middle; margin-top: -4px; display: inline-block;">
                                            {{StrategyMappingStore?.getObjectiveDetails?.status?.language[0]?.pivot?.title ? StrategyMappingStore?.getObjectiveDetails?.status?.language[0]?.pivot?.title : StrategyMappingStore?.getObjectiveDetails?.status?.title[0]?.pivot?.title}}</span> -->
                                    </h5>
                                </div>
                                <div class="clearfix">
                                    <p class="label-tag-style mb-2"><i
                                            class="fas fa-calendar-alt date-pics-two"></i>{{StrategyMappingStore?.getObjectiveDetails?.start_date|date:
                                        OrganizationGeneralSettingsStore.organizationSettings?.date_format}} -
                                        {{StrategyMappingStore?.getObjectiveDetails?.end_date|date:
                                        OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                        <!-- <span class="blinking">( 28 Days )</span> -->
                                    </p>

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'start_date' | translate}}</h6>
                                    <p>{{StrategyMappingStore?.getObjectiveDetails.start_date ?
                                        StrategyMappingStore?.getObjectiveDetails.start_date : AppStore.noContentText }}
                                    </p>
                                </div>
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'end_date' | translate}}</h6>
                                    <p>{{StrategyMappingStore?.getObjectiveDetails.end_date ?
                                        StrategyMappingStore?.getObjectiveDetails.end_date : AppStore.noContentText}}
                                    </p>
                                </div>
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'weightage' | translate}}</h6>
                                    <p>{{StrategyManagementSettingStore?.strategyManagementSettings?.is_weightage_fraction
                                        ? (StrategyMappingStore?.getObjectiveDetails.weightage ?
                                        StrategyMappingStore?.getObjectiveDetails?.weightage : AppStore.noContentText) :
                                        (StrategyMappingStore?.getObjectiveDetails?.weightage ?
                                        (StrategyMappingStore?.getObjectiveDetails.weightage | number : '1.0-0') :
                                        AppStore.noContentText)}}%</p>
                                </div>
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'target' | translate}}</h6>
                                    <p>{{StrategyManagementSettingStore?.strategyManagementSettings?.is_weightage_fraction
                                        ? (StrategyMappingStore?.getObjectiveDetails?.target ?
                                        StrategyMappingStore?.getObjectiveDetails?.target : AppStore.noContentText) :
                                        (StrategyMappingStore?.getObjectiveDetails?.target ?
                                        (StrategyMappingStore?.getObjectiveDetails?.target |
                                        number : '1.0-0') :
                                        AppStore.noContentText)}}{{StrategyMappingStore?.getObjectiveDetails?.target ?
                                        StrategyMappingStore?.getObjectiveDetails?.target_unit?.title : ''}}</p>
                                </div>
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'score' | translate}}</h6>
                                    <p>{{StrategyManagementSettingStore?.strategyManagementSettings?.is_weightage_fraction
                                        ? (StrategyMappingStore?.getObjectiveDetails?.score ?
                                        StrategyMappingStore?.getObjectiveDetails?.score : AppStore.noContentText) :
                                        (StrategyMappingStore?.getObjectiveDetails?.score ?
                                        (StrategyMappingStore?.getObjectiveDetails?.score |
                                        number : '1.0-0') :
                                        AppStore.noContentText)}}{{StrategyMappingStore?.getObjectiveDetails?.target ?
                                        StrategyMappingStore?.getObjectiveDetails?.target_unit?.title : ''}}</p>
                                </div>
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'minimum' | translate}}</h6>
                                    <p>{{StrategyMappingStore?.getObjectiveDetails?.minimum ?
                                        StrategyMappingStore?.getObjectiveDetails?.minimum : AppStore.noContentText}}
                                    </p>
                                </div>
                                <div class="col-lg-3 col-sm-6">
                                    <h6>{{'maximum' | translate}}</h6>
                                    <p>{{StrategyMappingStore?.getObjectiveDetails?.maximum ?
                                        StrategyMappingStore?.getObjectiveDetails?.maximum : AppStore.noContentText}}
                                    </p>
                                </div>
                            </div>

                            <div class="row"
                                *ngIf="StrategyMappingStore?.getObjectiveDetails?.strategy_profile_focus_areas?.length > 0">
                                <div class="col-lg-3 col-sm-6 ">
                                    <h6>{{'focus_area' | translate}}</h6>
                                    <ul class="arrowlist mt-0 p-0">
                                        <li
                                            *ngFor="let focus of StrategyMappingStore?.getObjectiveDetails?.strategy_profile_focus_areas">
                                            {{focus?.focus_area?.title}}</li>
                                    </ul>
                                </div>
                            </div>

                            <h6 *ngIf="StrategyMappingStore?.getObjectiveDetails?.responsible_users">{{'responsible_users' | translate}}</h6>
                            <div class="row">
                                <div class="col-xl-3 col-lg-4 col-sm-6"
                                    *ngIf="StrategyMappingStore?.getObjectiveDetails?.responsible_users?.length > 0">
                                    <div class="label-and-user-pic" *ngFor="let user of StrategyMappingStore?.getObjectiveDetails?.responsible_users">
                                        <div class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                                            <img [attr.src]="(user?.image_token || user?.image?.token) ? createImageUrl(user.image_token ? user?.image_token : user?.image?.token) : getDefaultImage('user-logo')" 
                                            onerror = "this.src='/assets/images/user-demo2.png'" data-toggle="modal" data-target="#user500" class="rounded-circle rounde-hov details-show-popup" width="40px" height="40px">                                         
                                            <div class="new-size-text">
                                                <h6 class="d-flex">{{user.first_name ? user.first_name : user.created_by_first_name}} {{user.last_name ? user.last_name : user.created_by_last_name}}</h6>
                                                <span>{{user.designation_title ? user.designation_title : user?.designation?.title}}</span>
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                                <p *ngIf="StrategyMappingStore?.getObjectiveDetails?.responsible_users?.length == 0">{{AppStore.noContentText}}</p>
                            </div>                         

                            <div *ngIf="StrategyMappingStore?.getObjectiveDetails?.kpis?.length > 0">
                                <div class="row line-tab">
                                    <div class="col-md-12">
                                        <div class="cmn-bdr-bottom clearfix">
                                            <ul class="nav nav-tabs float-left">
                                                <li class="nav-item"> <a class="nav-link active show"
                                                        data-toggle="tab">KPI </a> </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-content tab-content-body pt-3 border-0">
                                    <div class="tab-pane active show">
                                        <div class="form-group mb-2">
                                            <label class="mt-3">{{'kpi_measures' | translate}}</label>

                                            <div *ngIf="StrategyMappingStore?.getObjectiveDetails?.kpis?.length > 0"
                                                class="audit-form-table w-100 table-align-top not-fixed-table">
                                                <table
                                                    class="table table-bordered ordinary-table audit-page-table mb-0">
                                                    <thead>
                                                        <tr>
                                                            <th class="border-top-0 text-center" width="4%">#</th>
                                                            <th class="border-top-0" width="40%">KPI</th>
                                                            <th class="border-top-0" width="15%">{{'minimum' |
                                                                translate}}</th>
                                                            <th class="border-top-0" width="15%">{{'maximum' |
                                                                translate}}</th>
                                                            <th class="border-top-0" width="11%">{{'target' |
                                                                translate}}</th>
                                                            <th class="border-top-0" width="15%">{{'action' |
                                                                translate}}</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="edit-option"
                                                            *ngFor="let k of StrategyMappingStore?.getObjectiveDetails?.kpis;let num = index">
                                                            <td class="text-center">{{num+1}}</td>
                                                            <td>{{k.kpi?.title}}</td>
                                                            <td *ngIf="k.minimum">{{k.minimum}}%</td>
                                                            <td *ngIf="k.minimum == null">{{AppStore.noContentText}}
                                                            </td>
                                                            <td *ngIf="k.maximum == null">{{AppStore.noContentText}}
                                                            </td>
                                                            <td *ngIf="k.maximum">{{k.maximum}}%</td>
                                                            <td>{{k.target?k.target:AppStore.noContentText}}{{k.target?k.target_unit?.title
                                                                :''}}
                                                            </td>
                                                            <td><button type="button"
                                                                    (click)="openStrategyKpiDetailsModal(k.id)"
                                                                    class="btn btn-small" data-toggle="modal">{{'view' |
                                                                    translate}}</button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <div id="content-oc">
                        <div class="strategy-mapping-tree">
                            <div class="tab-content mapping-tab-content">
                                <div class="tab-pane in active ">
                                    <div class="tree-scroll-new pt-3" style="min-height: 70vh;" #contentAreaStandard>
                                        <div class="tree auto-width-tree clearfix stg-tree stg-role-tree relative">
                                            <div class="btn-fixed-strategy-objective">
                                                <button id="left-button-objective" type="button" class="btn-round-cmn btn-round-cmn-left"
                                                    (click)="moveTostandard('left')"></button>
                                                <button id="right-button-objective" type="button" class="btn-round-cmn btn-round-cmn-right"
                                                    (click)="moveTostandard('right')"></button>
                                            </div>
                                            <ul class="clearfix pt-0">
                                                <li>
                                                    <a class="oc-user-box cmn-bdr stg-child-box radius-15 relative">                                                      
                                                        <span class="label-work-flow-audit mapping-label mapping-label-green">{{'objective'| translate}}</span>
                                                        <div class="row align-items-center"
                                                            (click)="goToDetails('profile',StrategyMappingStore?.individualStrategyMapping?.id)">
                                                            <div class="col-md-9 col-9">
                                                                <div class="d-flex align-items-center ">
                                                                    <div class="w-100 ml-3">
                                                                        <h6 class="mb-0 elips-2">{{StrategyMappingStore?.individualStrategyMapping?.title}}</h6>
                                                                        <p class="mb-0">
                                                                            {{StrategyMappingStore?.individualStrategyMapping?.start_date |
                                                                            date: OrganizationGeneralSettingsStore?.organizationSettings?.date_format}} -
                                                                            {{StrategyMappingStore?.individualStrategyMapping?.end_date |
                                                                            date: OrganizationGeneralSettingsStore?.organizationSettings?.date_format}}
                                                                        </p>                                        
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 col-3">
                                                                <div class="round-status round-status-green round-status-child">
                                                                    <span>{{StrategyManagementSettingStore?.strategyManagementSettings?.is_weightage_fraction
                                                                        ?
                                                                        (StrategyMappingStore?.individualStrategyMapping?.score ?
                                                                        StrategyMappingStore?.individualStrategyMapping?.score : '0') :
                                                                        StrategyMappingStore?.individualStrategyMapping?.score ?
                                                                        (StrategyMappingStore?.individualStrategyMapping?.score | number
                                                                        : '1.0-0') : '0'}}%</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </a>
                    
                                                    <ul class="clearfix" style="padding-top: 20px;"
                                                        *ngIf="StrategyMappingStore?.individualStrategyMapping?.strategy_profile_focus_areasobj?.initiatives?.length > 0">
                                                        <li *ngFor="let init of obj?.initiatives; let initInd = index">
                                                            <a class="oc-user-box cmn-bdr stg-child-box radius-15"
                                                                (click)="goToDetails('initiative',init?.id)">
                                                                <span
                                                                    class="label-work-flow-audit mapping-label mapping-label-orange">{{'initiatives'
                                                                    | translate}}</span>
                                                                <div class="row align-items-center">
                                                                    <div class="col-md-9 col-9">
                                                                        <div class="d-flex align-items-center ">
                                                                            <div class="w-100 ml-3">
                                                                                <h6 class="mb-0 elips-2">{{init?.title}}
                                                                                </h6>                                                                        
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-3 col-3">
                                                                        <div
                                                                            class="round-status round-status-green round-status-child">
                                                                            <span>{{StrategyManagementSettingStore?.strategyManagementSettings?.is_weightage_fraction
                                                                                ?
                                                                                init?.score : (init?.score | number
                                                                                :'1.0-0')}}{{!init?.score ?'0'
                                                                                :''}}%</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                    <ul class="clearfix" style="padding-top: 20px;"
                                                        *ngIf="StrategyMappingStore.individualLoaded && StrategyMappingStore?.individualStrategyMapping?.strategy_profile_focus_areas.length == 0">
                                                        <li>
                                                            <a class="oc-user-box cmn-bdr stg-child-box radius-15">
                                                                <div class="row align-items-center">
                                                                    <div class="col-md-12">
                                                                        <div class="d-flex align-items-center ">
                                                                            <div class="w-100 tree-img-border-hide">
                                                                                <app-context-no-data
                                                                                    [sourceData]="getNoDataSource('center',strategyEmptyList)">
                                                                                </app-context-no-data>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </li>
                                            </ul>
                    
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->

                        <div class="row">
                            <div class="col-xl-12">
                                <hr>
                                <div class="d-flex flex-row user-list-sm">
                                    <!-- <app-user-popup-box
                                        [source]="getPopupDetails(StrategyMappingStore?.getObjectiveDetails.created_by,StrategyMappingStore?.getObjectiveDetails.created_at)"
                                        [showName]="true" [activateButtons]="false">
                                    </app-user-popup-box> -->
                                    <img [attr.src]="StrategyMappingStore?.getObjectiveDetails.created_by.image?.token ? createImageUrl(StrategyMappingStore?.getObjectiveDetails.created_by?.image?.token) : getDefaultImage('user-logo')" 
                                        onerror = "this.src='/assets/images/user-demo2.png'" width="40px" height="40px" class="rounded-circle">
                                    <div>
                                        <h6>{{StrategyMappingStore?.getObjectiveDetails.created_by?.first_name}} 
                                            {{StrategyMappingStore?.getObjectiveDetails.created_by?.last_name}}
                                        </h6>
                                        <span>{{StrategyMappingStore?.getObjectiveDetails?.created_by?.designation}} | Created on {{StrategyMappingStore?.getObjectiveDetails.created_at|date:
                                            OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <app-mapping-objective-info-loader *ngIf="!StrategyMappingStore?.objectiveDetailLoaded"></app-mapping-objective-info-loader>
        </div>

    </div>
</div>

<div class="modal modal-style-1 popup-full-width fade" id="view-kpi-measures-popup" data-keyboard="false"
    data-backdrop="static" #strategyKpiDetailsModal>
    <app-strategy-kpi-details *ngIf="kpiDetailsObject.type" [source]="kpiDetailsObject"></app-strategy-kpi-details>
</div>


