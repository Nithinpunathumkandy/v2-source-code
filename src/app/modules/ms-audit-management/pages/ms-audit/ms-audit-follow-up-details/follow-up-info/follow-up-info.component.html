<ng-container *mobxAutorun>
   <div *ngIf="!AuditNonConfirmityStore.individualLoaded">
      <app-ms-audit-program-detials></app-ms-audit-program-detials>
   </div>
</ng-container>
<div class="row edit-and-delete-main"
   *ngIf="AuditNonConfirmityStore.individualLoaded  && AuthStore.getActivityPermission(5356,'MS_AUDIT_FINDING_DETAILS') ">
   <div class="col-sm-12">
      <div class="widget" *mobxAutorun>
         <div class="row">
            <div class="col-sm-12 col-lg-8 padding-right-0">


               <!-- <div *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.type != 'close' "
                  class="edit-option-show edit-option-full-time-show" style="margin: 12px 12px 0 0;opacity: 1 !important;">
                  <a title="close corrective action" (click)="closeNonConformity()"><i class="far fa-times"></i></a>

      
               </div> -->




               <div class="bg-white widg-padding-cmn">
                  <div class="min-height-64">
                  <div class="issue-top-sec">

                     <div class="d-flex align-items-start">
                        <div class="w-100">
                           <div class="clearfix">

                              <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                    class="issue-smoal-head-text">#{{AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.reference_code?
                                    AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.reference_code:
                                    '##'}}</span>
                                 {{ AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.title}}
                                 <span
                                    [ngClass]="'draft-tag draft-tag-'+AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.label+' label-tag-style-tag label-left-arow-tag d-inline-block status-tag-new-one'">{{AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status
                                    ?AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.language[0]?.pivot?.title
                                    : 'NA' }}</span>
                              </h5>
                           </div>
                           <!-- <div class="clearfix">
                              <p class="label-tag-style"><i class="fas fa-calendar-alt date-pics-two"></i>
                                 {{ AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.date | date:
                                 OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                              </p>
                           </div> -->
                        </div>

                        <button *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.type != 'close' && checkCloseEnable() && (isUser() || AuthStore.isRoleChecking('lead-auditor') || AuthStore.isRoleChecking('super-admin'))" 
                        type="button" (click)="closeNonConformity()" class="btn btn-small ml-3">{{'close' | translate}}</button>
                     </div>
                     

                     <p style="white-space: pre-wrap;"> {{
                        AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.description ?
                        AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.description:
                        AppStore.noContentText }}</p>
                  </div>

                  <div class="row">
                     <div class="col-md-4">
                        <h6>{{'finding_category' | translate}}</h6>
                        <p *ngIf="AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_category"> {{
                           AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_category?.language[0]?.pivot?.title }}</p>
                       
                     </div>
                     <!-- <div class="col-md-4">
                        <h6>{{'agreed_date' | translate}}</h6>
                        <p *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.agreed_date"> {{
                           AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.agreed_date | date:
                           OrganizationGeneralSettingsStore.organizationSettings?.date_format }}</p>
                        <p *ngIf="!AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.agreed_date"> {{
                           AppStore.noContentText}}</p>
                     </div>
                      -->
                     <div class="col-md-8">
                        <h6>{{'department' | translate}}</h6>
                        <div class="mb-3">
                           <p class="mb-0 d-inline-block mr-2"> {{ AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.title? AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.title : AppStore.noContentText }},</p>
                           <p class="mb-0 d-inline-block mr-2" *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.audited_date">{{'audited_date' | translate}}- {{ AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.audited_date | date: OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</p>
                        </div>
                     </div>

                     <!-- <div class="col-md-4" *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.audited_date">
                        <h6>{{'audited_date' | translate}}</h6>
                        
                        <p *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.audited_date"> {{ AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.audited_date | date: OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</p>
                     </div> -->

                     <div class="col-md-4" *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrective_action_type?.type == 'general' ">
                        <h6>{{'reason' | translate}}</h6>
                        <p> {{ AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.reason? AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.reason : AppStore.noContentText }}</p>
                        <!-- <p *ngIf="!AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.agreed_date"> {{ AppStore.noContentText}}</p> -->
                     </div>


                     <!-- <div class="col-md-4">
                        <h6>{{'responsible_users' | translate}}</h6>
                        <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix">
                           <ng-container
                              *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.responsible_users.length>0">
                              <div
                                 *ngFor="let users of AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.responsible_users;let i=index">
                                 <li class="rounde-hov-bg">
                                    <app-user-popup-box [source]="getEmployeePopupDetails(users)" [showName]="false">
                                    </app-user-popup-box>
                                 </li>
                              </div>
                           </ng-container>
                           <div
                              *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.responsible_users.length==0">
                              {{ AppStore.noContentText }}
                           </div>
                        </ul>
                     </div> -->
                     <div class="col-sm-12" *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrective_action_type?.type != 'general' ">
                        <h6>{{'clause' | translate}}</h6>
                        <div class="audit-form-table w-100 not-fixed-table mb-3">
                           <table
                              *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_ms_type_organizations.length>0"
                              class="table table-bordered ordinary-table audit-page-table mb-1 table-scroll">
                              <thead>
                                 <tr>
                                    <th class="border-top-0" width="50%">{{'iso_standard' | translate}}</th>
                                    <th class="border-top-0" width="50%">{{'clause' | translate}}</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr
                                    *ngFor="let row of AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_ms_type_organizations">
                                    <td>{{row?.ms_type_organization?.ms_type ?
                                       row?.ms_type_organization?.ms_type?.title: AppStore.noContentText }}</td>
                                    <td>
                                       <ul class="arrowlist m-0 p-0" *ngIf="row?.document_version_contents.length>0">
                                          <li *ngFor="let item of row?.document_version_contents">
                                             {{item?.clause_number}}.{{item?.title}}</li>
                                       </ul>
                                       <p *ngIf="row?.document_version_contents.length==0">{{ AppStore.noContentText }}
                                       </p>
                                    </td>
                                 </tr>
                              </tbody>
                           </table>
                           <div class="mb-3">
                              <app-no-data
                                 *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_ms_type_organizations.length==0"
                                 [height]="true" [border]="true">
                              </app-no-data>
                           </div>
                        </div>

                     </div>

                     <div class="col-md-6">
                        <h6>{{'auditees' | translate}}</h6>
                        <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix mb-3">
                           <li class="rounde-hov-bg" *ngFor="let users of AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.auditees;let i=index">
                              <app-user-popup-box [showName]="false"
                                 [source]="getEmployeePopupDetails(users?.user)">
                              </app-user-popup-box>
                           </li>
                        </ul>
                            <div
                                *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.auditees?.length==0">
                                {{ AppStore.noContentText }}
                            </div>
                        
                    </div>

                    <div class="col-md-6">
                        <h6>{{'auditors' | translate}}</h6>
                        <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix mb-3">
                           <li class="rounde-hov-bg" *ngFor="let users of AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.auditors;let i=index">
                              <app-user-popup-box [showName]="false"
                                 [source]="getEmployeePopupDetails(users?.user)">
                              </app-user-popup-box>
                              
                           </li>
                        </ul>
                            <div
                                *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_schedule?.auditors?.length==0">
                                {{ AppStore.noContentText }}
                            </div>
                      
                    </div>



                     <!-- <div class="col-sm-12">
                        <h5>{{'root_cause_analysis' | translate}}</h5>
                        <p style="white-space: pre-wrap;"> {{
                           AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_root_cause_analysis?.description
                           ?
                           AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_root_cause_analysis?.description:
                           AppStore.noContentText }}</p>
                     </div> -->

                     <!-- <div class="col-sm-12">
                        <h5>{{'preventive_action' | translate}}</h5>
                        <p style="white-space: pre-wrap;"> {{
                           AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.preventive_action
                           ?
                           AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.preventive_action:
                           AppStore.noContentText }}</p>
                     </div> -->

                     <!-- <div class="col-sm-12">
                        <h6>{{'audit_correction_or_immediate_action'|translate}}</h6>
                        <ul class="arrowlist mt-0 p-0"
                           *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections?.length>0">
                           <li
                              *ngFor="let item of AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections">
                              {{item?.title}}</li>
                        </ul>
                        <p
                           *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections?.length==0">
                           {{ AppStore.noContentText }}</p>
                     </div> -->
                    
                  </div>
                  </div>

                  <div class="row">
                     <div class="col-xl-12">
                        <hr class="mb-2">
                        <ng-container
                           *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.created_by.first_name">
                           <app-user-popup-box
                              [source]=" getEmployeePopupDetails( AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.created_by, AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.created_at )">
                           </app-user-popup-box>
                        </ng-container>
                     </div>
                  </div>
               </div>
            </div>

            <div class="col-sm-12 col-lg-4">

               <div class="bg-white widg-padding-cmn-small mb-3 edit-option text-left">

                  <h6 class="text-left">{{'correction' | translate}}</h6>
                  <hr class="mt-0 mb-3">
                  <div class="text-center">
                      <!-- <button (click)="openQuickCorrectionModal()" type="button" class="btn mr-0" 
                          *ngIf="AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections?.length==0">{{'add' | translate}}</button> -->

                          <button 
                          *ngIf="AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections?.length==0 && AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.type != 'close' &&
                          (checkIsAuditee() || AuthStore.isRoleChecking('super-admin'))" 
                          (click)="openQuickCorrectionModal()" type="button" class="btn mr-0" 
                         >{{'add' | translate}}</button>
                  </div>
                  <div
                  *ngIf="AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections?.length==0
                  && AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.type == 'close'
                  ">
                  {{ AppStore.noContentText }}
                  </div>
                  <div
                      *ngIf="AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections?.length>0">
                      <ng-container
                          *ngFor="let correction of AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections">
                          <div *ngIf="(checkIsAuditee() || AuthStore.isRoleChecking('super-admin'))"
                           class="edit-option-show-inner" style="margin: -3px 0 0 0;">
                              <a *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_status?.type != 'close'" (click)="editQuickCorrection(correction)" title="Edit"><i
                                      class="fas fa-pen"></i></a>
                              <a (click)="deleteQuickCorrectionItem(correction.id)" title="Delete"><i
                                      class="fas fa-trash"></i></a>
                          </div>
                          <h6>{{correction.title}}</h6>
                          <p style="white-space: pre-line;text-align: justify;">
                              {{correction.description}}</p>
                      </ng-container>
                      <hr class="mb-2">
                      <div class="d-flex flex-row user-list-sm text-left">
                          <app-user-popup-box
                              [source]=" getEmployeePopupDetails(AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections[0].created_by, AuditNonConfirmityStore?.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrections[0].created_at)">
                          </app-user-popup-box>
                      </div>
                  </div>


              </div>

               <div class="bg-white widg-padding-cmn-small mb-3">
                  <h5 class="cmn-head-style text-left">{{'corrective_action' | translate}}</h5>
                  <hr class="mt-0 mb-3">
                  <ul class="arrowlist mt-0 p-0"
                     *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrective_actions?.length>0">
                     <li
                        *ngFor="let item of AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrective_actions">
                        {{item?.title}}</li>
                  </ul>
                  <p
                     *ngIf="AuditNonConfirmityStore.individualMsAuditNonConfirmityDetails?.ms_audit_finding_corrective_actions?.length==0">
                     {{ AppStore.noContentText }}</p>

                  <!-- <div>NA</div> -->

               </div>

            </div>
         </div>
      </div>
   </div>
</div>

<div class="modal modal-style-1 popup-full-width fade" #formModal data-keyboard="false" data-backdrop="static">
   <app-new-audit-non-confirmity *ngIf="MsNonConformityObject.type" [source]="MsNonConformityObject">
   </app-new-audit-non-confirmity>
</div>

<!------------------- Delete Confirmation Modal Start --------------------------->
<div class="modal modal-style-1 fade" id="delete-popup" #confirmationPopUp data-backdrop="static" data-keyboard="false">
   <app-delete-popup [source]="popupObject"></app-delete-popup>
</div>

<!-- File Preview -->
<div class="modal modal-style-1 popup-full-width fade popup-new-type" id="add-three-popup" data-keyboard="false"
   data-backdrop="static" #filePreviewModal *mobxAutorun>
   <button type="button" class="close" data-dismiss="modal" (click)="closePreviewModal($event)"><i
         class="lni-close"></i><span>{{'esc' | translate}}</span></button>
   <app-preview *ngIf="previewObject" [source]="previewObject" (close)="closePreviewModal($event)"></app-preview>
</div>

<div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static"
    #addQuickCorrectionModal>
    <app-quick-correction-modal *ngIf="quickCorrectionObject.type" [source]="quickCorrectionObject">

    </app-quick-correction-modal>


</div>