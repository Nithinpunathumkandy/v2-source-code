<app-report-accordion-loader *ngIf ="!AuditProgramReportStore.loaded"></app-report-accordion-loader>
<ng-container *ngIf ="AuditProgramReportStore.AuditReportDetails && AuditProgramReportStore.loaded">
    <div class="report-book-height" *mobxAutorun><!-- report-book-height start -->

        <div class="pdf-menu-accodion-main clearfix">
            <div class="pdf-menu-accodion cmn-bdr-right mCustomScrollbar">
                <div class="pdf-menu-accodion-inner">
    
                    <div class="panel-group panel-drop-sections panel-drop-white" id="jd" role="tablist" aria-multiselectable="true">
    
                        <div class="panel panel-default" *ngFor="let leftMenuData of AuditProgramReportStore?.AuditReportDetails?.ms_audit_program_report_content;let num=index">
                            <div [ngClass]="selectedItemId!=null && selectedItemId==leftMenuData.id?'panel-heading active':'panel-heading'" role="tab" (click)="setSelectedReportItem(leftMenuData)">
                                <div class="panel-title">
                                    <a role="button"  aria-expanded="false" aria-controls="collapseOne" class="collapsed">
                                        <h5 class="width96pc mt-0">{{leftMenuData.section}}.{{leftMenuData.title}} <span
                                            *ngIf="leftMenuData['ms_audit_program_report_content_childrens'].length > 0" class="drop-down-icone"><i
                                               class="fas fa-chevron-down"></i></span> </h5>
                                    </a>
                                </div>
                            </div>
                            <div *ngIf="leftMenuData['ms_audit_program_report_content_childrens'].length > 0"[ngClass]="selectedItemId!=null && selectedItemId==leftMenuData.id?'drop-detail-sec panel-collapse collapse in show':'drop-detail-sec panel-collapse collapse'"   role="tabpanel" aria-labelledby="headingOne" [attr.data-parent]="'#menu'+num+'_'+leftMenuData.id">
                                <div class="panel-body">
                                    <h5 *ngFor="let childrenContent of leftMenuData?.ms_audit_program_report_content_childrens;let childrenNum=index" class="pdf-inner-title-accodion">{{childrenContent.section}}.{{childrenContent.title}}</h5>    
                                </div>
                            </div>
                        </div>
    
                    </div>
    
                </div>
    
            </div>
        </div>
    
        <!-- <div class="cmn-bdr bg-white p-3 pdf-zoom-header-main  d-flex report-top-approve-sec">
            <div class="bg-white w-100">
    
                <div class="resolved-accepted-box p-0">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="d-flex flex-row user-list-sm">
                                <img src="images/user-gate.jpg" class="rounded-circle" width="30px" height="30px">
                                <div>
                                    <h6>Mathew Alexander</h6>
                                    <span>02-03-2019 1:00 PM</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="accept-reject-btns clearfix d-flex justify-content-end w-100">
                                <button type="button" class="btn btn-green">Approve</button>
                                <button type="button" class="btn btn-yellow">Revert</button>
                                <button type="button" class="btn btn-red">Reject</button>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <hr class="mt-1">
                        </div>
                    </div>
                    <div class="resolved-accepted-para">
                        <p>Please change the title of commencement notification</p>
                    </div>
    
                </div>
    
            </div>
        </div> -->
    
        <div class="cmn-bdr bg-white p-3 pdf-zoom-header-main pdf-zoom-header d-flex"><!-- pdf search header start -->
            <div class="w-100">
                <form class="form-control issue-select-process-search bg-white search-popup-new">
                    <input type="text" placeholder="Search.." name="search" class="search-process" />
                    <button type="submit" style="width: 40px;"><i class="fa fa-search"></i></button>
                </form>
            </div>
        </div><!-- pdf search header end -->
    
        <div class="pdf-v2-report-html pdf-v2-report-list-view-html clearfix pdf-new-style-pagination"><!-- pdf-v2-report-html start -->
            <div class="pdf-right-contents main-container">
    
                <div class="maindiv relative">
                    <!-- <div class="status-tag-new-two bg-green">Completed</div> -->
    
                        <div class="holder" id="2">
                            <div class="pdf-page-inner-new-content not-target">
                                <div class="pdf-inner-no-border-accodion">
                                    <div class="panel-group" id="accordion101" role="tablist" aria-multiselectable="true">
                
    
                                        <div class="pdf-page-section" *ngFor="let rightContentData of AuditProgramReportStore?.AuditReportDetails?.ms_audit_program_report_content;let num=index"><!-- pdf-page-section start -->
                                            <div class="introduction-page intro-right" [attr.id]="rightContentData.type" style="scroll-margin: 50px">
                                                <div [ngClass]="defaultItemType==rightContentData.type?'panel panel-default report-selected':'panel panel-default'">
                                                    <div  [ngClass]="selectedItemId!=null && selectedItemId==rightContentData.id?'panel-heading active':'panel-heading'" (click)="setSelectedReportItem(rightContentData)" role="tab" >
                                                        <h4 class="panel-title">
                                                            <a role="button" data-toggle="collapse" data-parent="#accordion101" [ngClass]="selectedItemId!=null && selectedItemId==rightContentData.id?'':'collapsed'"   [attr.aria-expanded]="selectedItemId!=null && selectedItemId==rightContentData.id?'true':'false'" aria-controls="collapse103">{{rightContentData.section}}.{{rightContentData.title}}</a>
                                                        </h4>
                                                    </div>
                                                    <div [ngClass]="selectedItemId!=null && selectedItemId==rightContentData.id?'panel-collapse collapse in show':'panel-collapse collapse'"  role="tabpanel" aria-labelledby="heading103">
                                                        <div class="panel-body edit-and-delete-main">
                                                            <div class="edit-option-show" style="margin: -17px 20px 0 0;"><!-- edit-and-delete starts -->
                                                                <a><i class="fas fa-pen"
                                                                 *ngIf="AuthStore.getActivityPermission(4100,'UPDATE_MS_AUDIT_REPORT')" (click)="editReport(rightContentData)"></i></a>
                                                                </div>
                                                            <p class="text-editor-content bullet-point-list" [innerHTML] = "rightContentData.description  | safeHtml" style="white-space: pre-wrap;"></p>
                                                            <div class="pdf-page-section">
                                                                <div class="introduction-page intro-right ml-3">
    
                                                                    <div class="pdf-inner-no-border-accodion headding-style-no-border-accodion" *ngIf="rightContentData?.ms_audit_program_report_content_childrens.length > 0">
                                                                      <div class="panel-group" id="inner-accordion01" role="tablist" aria-multiselectable="true">
                                                                       <div class="panel panel-default mb-3" *ngFor="let childrenData of rightContentData?.ms_audit_program_report_content_childrens;let childrenNum=index;">
                                                                         <div class="panel-heading active" role="tab" id="heading01">
                                                                           <h4 class="panel-title sub-text-head-report">
                                                                           <a role="button" data-toggle="collapse" data-parent="#inner-accordion01" [attr.href]="'#child'+childrenData.type+'_'+childrenData.id" aria-expanded="true" aria-controls="inner-collapse01">
                                                                            {{childrenData.section}}.{{childrenData.title}}
                                                                           </a>
                                                                         </h4>
                                                                         </div>
                                                                         <div [attr.id]="'child'+childrenData.type+'_'+childrenData.id" class="panel-collapse collapse in show" role="tabpanel" aria-labelledby="heading01">
                                                                           <div class="panel-body edit-option">
                                                                            <div class="edit-option-show-inner" style="margin: -17px 20px 0 0;"><!-- edit-and-delete starts -->
                                                                                <a><i class="fas fa-pen"
                                                                                    *ngIf="AuthStore.getActivityPermission(4100,'UPDATE_MS_AUDIT_REPORT')" (click)="editReport(childrenData)"></i></a>
                                                                                   <a *ngIf="childrenData?.audit_agenda?.agenda.length > 0"><i class="fas fa-plus"
                                                                                    (click)="addAgenda()"></i></a>
                                                                                </div>
                                                                               <p *ngIf="!childrenData?.audit_team"  class="text-editor-content bullet-point-list" [innerHTML] = "childrenData.description  | safeHtml" style="white-space: pre-wrap;"></p>
                                                                                <div *ngIf="childrenData?.audit_team">

                                                                                    <div class="row mb-3">
                                                                                        <div class="col-lg-4 col-sm-6" *ngIf="childrenData?.audit_team?.lead_auditor">
                                                                                        <h6>Lead Auditor </h6>
                                                                                        <app-user-popup-box [source]="getCreatedByProcessDetails(childrenData?.audit_team?.lead_auditor)" [showName]="true">
                                                                                        </app-user-popup-box>   
                                                                        
                                                                                        </div>

                                                                                        <div class="col-lg-4 col-sm-6" *ngIf="childrenData?.audit_team?.auditee_lead">
                                                                                            <h6>Auditee Lead </h6>

                                                                                            <app-user-popup-box [source]=" getCreatedByProcessDetails(childrenData?.audit_team?.auditee_lead)" [showName]="true">
                                                                                            </app-user-popup-box>   

                                                                                         </div>
                                                                                     </div>                                
                                                                       
                                                                                     <div class="row mb-3" *ngIf="childrenData?.audit_team?.auditors.length>0">
                                                                                       <div class="col-lg-4 col-sm-6">
                                                                                           <h6>Auditors</h6>
                                                                                       
                                                                                            <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix">
                                                                                                    <li class="rounde-hov-bg"
                                                                                                    *ngFor="let auditors of childrenData?.audit_team?.auditors">
                                                                                                     <app-user-popup-box [source]=" getCreatedByProcessDetails(auditors)" [showName]="false">
                                                                                                     </app-user-popup-box>                      
                                                                                                    </li>
                                                                                            </ul>
                                                                                        </div>
                                                                                     </div>

                                                                                     <div class="row mt-2" *ngIf="childrenData?.audit_team?.auditees.length>0">
                                                                                       <div class="col-md-12">
                                                                                           <h6>Auditees </h6>

                                                                                            <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix">
                                                                                                <li class="rounde-hov-bg"
                                                                                                *ngFor="let auditees of childrenData?.audit_team?.auditees">
                                                                                                    <app-user-popup-box [source]=" getCreatedByProcessDetails(auditees)" [showName]="false">
                                                                                                    </app-user-popup-box>                      
                                                                                                </li>
                                                                                            </ul>
                                                                                        </div>
                                                                                     </div>

                                                                                 </div>

                                                                                 <!-- Audit Agenda Table Data Starts Here--> 

                                                                                 <div *ngIf="childrenData?.audit_agenda?.agenda.length > 0">


                                                                                    <div class="audit-form-table w-100 table-align-top not-fixed-table">
                                                                                        <table class="table table-bordered ordinary-table audit-page-table mb-1">
                                                                                            <thead>
                                                                                                <tr>
                                                                                                    <th class="border-top-0" width="2%">#</th>
                                                                                                    <th class="border-top-0" width="10%">MS Type</th>
                                                                                                    <th class="border-top-0" width="10%">Ref No.</th>
                                                                                                    <th class="border-top-0" width="30%">Title</th>
                                                                                                    <th class="border-top-0" width="19%">Audit Team</th>
                                                                                                    <th class="border-top-0" width="19%">Auditors</th>
                                                                                                    <th class="border-top-0" width="10%">Date</th>
                                                                                                    <th class="border-top-0" width="10%">Time</th>
                                                                                                </tr>
                                                                                            </thead>
                                                                                            <tbody>
                                                                                                <tr class="pointer edit-and-delete-main" *ngFor="let agenda of childrenData?.audit_agenda?.agenda;let num=index">
                                                                                                    <td>{{num+1}}</td>
                                                                                                    <td>{{agenda.ms_type.title}} </td>
                                                                                                    <td>{{agenda.reference_code}}</td>
                                                                                                    <td>{{agenda.title}}</td>
                                                                                                    <td>
                                                                                                        <app-user-popup-box [source]=" getCreatedByProcessDetails(agenda?.team?.team_lead)" [showName]="true">
                                                                                                        </app-user-popup-box>   
                                                                                                        <!-- <div class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                                                                                                          <img src="images/round-7.png" class="rounded-circle rounde-hov details-show-popup" width="35px" height="35px">
                                                                                                          
                                                                                                          <div class="pointer new-size-text">
                                                                                                              <h6>Jasica </h6>
                                                                                                              <span>Team Lead</span>
                                                                                                          </div>
                                                                                                      </div> -->
                                                                                                    </td>
                                                                                                    <td>
                                                                                                        <!-- <div class="d-flex flex-row user-list-sm user-box-smol-round user-box-smol-round-table-scrol rounde-hov-bg">
                                                                                                          <img src="images/round-9.png" class="rounded-circle rounde-hov details-show-popup" width="35px" height="35px">
                                                                                                          
                                                                                                          <div class="pointer new-size-text">
                                                                                                              <h6>Williams </h6>
                                                                                                              <span>Team Lead</span>
                                                                                                          </div>
                                                                                                      </div> -->
                                                                                                      <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix">
                                                                                                        <li class="rounde-hov-bg"
                                                                                                        *ngFor="let auditors of agenda?.team?.team_user">
                                                                                                            <app-user-popup-box [source]=" getCreatedByProcessDetails(auditors)" [showName]="false">
                                                                                                            </app-user-popup-box>                      
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                    </td>
                                                                                                    <!-- \  <p>{{findings.date | date:OrganizationGeneralSettingsStore?.organizationSettings?.date_format}}</p> -->
                                                                                                    <td>{{agenda.created_at | date:OrganizationGeneralSettingsStore?.organizationSettings?.date_format}}</td>
                                                                                                    <td>
                                                                                                        <div class="edit-option-show" > 
                                                                                                            <a [attr.title]="'edit'|translate" (click) = "editAgenda(agenda)" 
                                                                                                            *ngIf="AuthStore.getActivityPermission(4100,'UPDATE_MS_AUDIT_REPORT_AGENDA')" 
                                                                                                            ><i class="fas fa-pen pointer"></i></a> 
                                                                                                            <a [attr.title]="'delete'|translate" (click)="deleteAgendaConfirm(agenda.id)"
                                                                                                            *ngIf="AuthStore.getActivityPermission(4100,'DELETE_MS_AUDIT_REPORT_AGENDA')" 
                                                                                                            ><i class="fas fa-trash pointer"></i></a>
                                                                                                        </div>
                                                                                                        {{agenda.start_time | date:OrganizationGeneralSettingsStore?.organizationSettings?.date_time_format}}</td>
                                                                                                </tr>
                                                                                                

                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                                 </div>
                                                                                 <app-no-data *ngIf = "childrenData?.audit_agenda?.agenda?.length == 0" [border]="false" [height]="true"></app-no-data>
                                                                                                <!-- Audit Agenda Table Data Starts Here--> 

                                                                         


                                                                           </div>

                                                                         </div>
                                                                       </div>
                                                                     
    
                                                                    </div>
                                                                 </div>
    
                                                                
                                                                    
                                                                </div>
                                                                
                                                            </div>
                                                                                                                     
                                                            <div *ngIf="rightContentData.type=='list-of-non-conformities'" class="panel-group panel-drop-sections panel-drop-white accor-plus-remove plus-remove-accodion" id="jd" role="tablist" aria-multiselectable="true">
                                                                <div class="panel panel-default" *ngFor="let findings of rightContentData?.list_of_non_conformities?.ms_audit_findings;let index=num">
                                                                  <div  [ngClass]="selectedFindingId!=null && selectedFindingId==findings.id?'panel-heading active':'panel-heading'" (click)="setSelectedFinding(findings)" role="tab" id="headingOne">
                                                                     <div class="panel-title">
                                                                        <a role="button" data-toggle="collapse"  aria-expanded="false" aria-controls="collapseOne" class="collapsed">
                                                                           <h5 class="width96pc mt-0"><span class="issue-smoal-head-text">#{{findings.reference_code}} </span>{{findings.title}} <span class="drop-down-icone"><i class="fas fa-chevron-down"></i></span> </h5>
                                                                        </a>
                                                                     </div>
                                                                  </div>
                                                                  <div [ngClass]="selectedFindingId!=null && selectedFindingId==findings.id?'drop-detail-sec panel-collapse collapse in show':'drop-detail-sec panel-collapse collapse'" role="tabpanel" aria-labelledby="headingOne">
                                                                     <div class="panel-body bg-white edit-and-delete-main">
                                                                       <!-- <div class="edit-option-show" style="margin: -18px 24px 0 0;">
                                                                          <a href="#"><i class="fas fa-pen"></i></a>
                                                                          <a href="#"><i class="fas fa-trash"></i></a>
                                                                        </div> -->
                                                                        <div class="row">
                                                                            <div class="col-lg-4 col-sm-6">
                                                                                <h6>Date</h6>
                                                                                <p>{{findings.date | date:OrganizationGeneralSettingsStore?.organizationSettings?.date_format}}</p>
                                                                            </div>
                                                                            <!-- <div class="col-lg-4 col-sm-6">
                                                                                <h6>Standard clause reference</h6>
                                                                                <p>Lorem ipsum dolor sit amet</p>
                                                                            </div> -->
                                                                            <div class="col-lg-4 col-sm-6">
                                                                                <h6>Description</h6>
                                                                                <p>{{findings.description?findings.description:AppStore.noContentText}}</p>
                                                                            </div>
                                                                            <!-- <div class="col-lg-4 col-sm-6">
                                                                                <h6>Root Cause Analysis</h6>
                                                                                <p>Lorem ipsum d</p>
                                                                            </div> -->
                                                                            <!-- <div class="col-lg-4 col-sm-6">
                                                                                <h6>Evidence</h6>
                                                                                <div class="d-flex align-items-center mb-3">
                                                                                    <img src="images/md-jpg.png" class="img-fluid" width="20px" height="20px">
                                                                                    <div class="w-100 ml-2">
                                                                                        <p class="mb-0">Document</p>
                                                                                    </div>
                                                                                </div>
                                                                            </div> -->
                                                                            <div class="col-lg-4 col-sm-6" *ngIf="findings.ms_audit_finding_corrections.length > 0">
                                                                                <h6>Correction</h6>
                                                                                <ul class="arrowlist mt-0 p-0">
                                                                                    <li *ngFor="let correction of findings.ms_audit_finding_corrections">{{correction.title}}</li>
                                                                                </ul>
                                                                            </div>
                                                                            <div class="col-lg-4 col-sm-6" *ngIf="findings.ms_audit_finding_corrective_actions.length > 0">
                                                                                <h6>Corrective Action	</h6>
                                                                                <ul class="arrowlist mt-0 p-0">
                                                                                    <li *ngFor="let corrective_action of findings.ms_audit_finding_corrective_actions">{{corrective_action.title}}</li>
                                                                                </ul>
                                                                            </div>
                                                                            <!-- <div class="col-lg-4 col-sm-6">
                                                                                <h6>Effectiveness</h6>
                                                                                <p>Lorem ipsum d</p>
                                                                            </div> -->
                                                                            <div class="col-lg-4 col-sm-6">
                                                                                <h6>Agreed Date	</h6>
                                                                                <p>{{findings.target_date | date:OrganizationGeneralSettingsStore?.organizationSettings?.date_format}}</p>
                                                                            </div>
                                                                             <div class="col-lg-4 col-sm-6" *ngIf="findings.responsible_users.length > 0">
                                                                                <h6>Responsibility</h6>
                                                                                <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix">
                                                                                    <li class="rounde-hov-bg"
                                                                                     *ngFor="let responsible_user of findings.responsible_users">
                                                                                      <!-- <span class="user-delete-btn"><i class="fas fa-trash"></i></span> -->
                                                                                        <app-user-popup-box [source]=" getCreatedByProcessDetails(responsible_user)" [showName]="false">
                                                                                        </app-user-popup-box>                      
                                                                                    </li>
                                                                                </ul>
                                           
                                                                            </div>
                                                                            <div class="col-lg-12 col-sm-12" *ngIf="findings.ms_audit_finding_strengths.length > 0">
                                                                                <h6>Strength</h6>
                                                                                <ul class="arrowlist mt-0 p-0">
                                                                                    <li *ngFor="let strength of findings.ms_audit_finding_strengths">{{strength.title}}</li>
                                                                                </ul>
                                                                            </div>
                                                                            <div class="col-lg-12 col-sm-12" *ngIf="findings.ms_audit_finding_weaknesses.length > 0">
                                                                                <h6>Weakness</h6>
                                                                                <ul class="arrowlist mt-0 p-0">
                                                                                    <li *ngFor="let weakness of findings.ms_audit_finding_weaknesses">{{weakness.title}}</li>
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                     </div>
                                                                  </div>
                                                                </div>
                                                            </div>
                                                                    <!-- comments-and-recommendation -->
                                                                     <div *ngIf="rightContentData?.type=='comments-and-recommendation'">

                                                                                     <div class="audit-form-table w-100 table-align-top not-fixed-table">
                                                                        <table class="table table-bordered ordinary-table audit-page-table mb-1">
                                                                        <thead>
                                                                        <tr>
                                                                        <th class="border-top-0" width="5%">#</th>
                                                                        <th class="border-top-0" width="10%">{{'ref_no' | translate}}</th>
                                                                        <th class="border-top-0" width="30%">{{'title' | translate}}</th>
                                                                        <th class="border-top-0" width="55%">{{'strength_weakness' | translate}}</th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                        
                                                         
                                                                        <ng-container *ngFor="let process of rightContentData?.list_of_processes;let num=index"
                                                                        >
                                                                        <tr>
                                                                        <td rowspan="4">{{num+1}}</td>
                                                                        <td rowspan="4">{{process.reference_code?process.reference_code:AppStore.noContentText}}</td>
                                                                        <td rowspan="4">{{process.title?process.title:AppStore.noContentText}}</td>
                                                                        <th>Strengths</th>
                                                                        </tr>
                                                                        <tr>
                                                                        <td>
                                                                        <div *ngFor="let item of process.strengths;let itemIndex=index">{{itemIndex+1}}.{{item.title}}</div>
                                        
                                                                        </td>
                                                                        </tr>
                                                                        <tr>
                                                                        <th>Weaknesses</th>
                                                                        </tr>
                                                                        <tr>
                                                                        <td>
                                                                            <div *ngFor="let item of process.weaknesses;let itemIndex=index">{{itemIndex+1}}.{{item.title}}</div>
                          
                                                                        </td>
                                                                        </tr>
                                                                    </ng-container>
                                                                        </tbody>
                                                                        </table>
                                                                        </div>
                                                         

                                                                     </div> 

                                                        
                                                                     <!-- comments-and-recommendation -->
                                                        </div>
                                                    </div>
    
                                                </div>
                                            </div>
                                        </div><!-- pdf-page-section end 22 -->
    
                              
    
                              
                                    </div>
                                </div>
                            </div>                                                     
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- pdf-v2-report-html end -->
</ng-container>
<ng-container *mobxAutorun>
    <!-- Empty Screen Content -->
    <app-no-data *ngIf = "!AuditProgramReportStore.AuditReportDetails && AuditProgramReportStore.loaded" [border]='false'></app-no-data>
</ng-container>


<!-- Annual Summary Form Modal-->
<div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #agendaForm>
    <app-agenda-form [source]="agendaObject" *ngIf="showAgendaFormModal"></app-agenda-form>
 </div>
 
 <!-- Annual Summary Form Modal-->

 <div class="modal modal-style-1 fade" id="delete-popup" #confirmationPopUp>
    <app-delete-popup [source] = "popupObject"></app-delete-popup>
 </div>
 <div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #reportUpdateForm>
    <app-audit-program-report-update-modal [source]="reportObject" *ngIf="showReportUpdateModal"></app-audit-program-report-update-modal>
 </div>

