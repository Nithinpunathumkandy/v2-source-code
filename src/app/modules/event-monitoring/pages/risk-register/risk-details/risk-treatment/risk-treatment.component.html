<ng-container *mobxAutorun>
    <div class="tab-pane tab-edit-class" id="teamwise" *ngIf="EventRiskTreatmentStore.loaded">

        <div class="bg-white p-3"
            *ngIf="EventRiskTreatmentStore.riskTreatmentList.length>0">
            <div class="clearfix">
                <div class="row align-items-center" *ngIf="EventRiskTreatmentStore.summaryLoaded">
                    <div class="col-lg-4 col-sm-12">
                        <div class="d-flex">
                            <!-- <div class="risk-treatment-top-box risk-treatment-box-one" style="width:180px;">

                                <div class="form-group mb-0">
                                    <label for="name">{{'risk_treatment_strategy'|translate}}</label>
                                </div>
                            </div> -->

                            <div class="risk-treatment-top-box risk-treatment-box-two">
                                <div class="bg-white">
                                    <div class="form-group mb-0">
                                        <div class="clearfix">
                                            <div class="multiple-plain-ngselect">
                                                <!-- <ng-select [items]="RiskControlPlanMasterStore.allItems"
                                                    [attr.placeholder]="'select_risk_control_plan' | translate"
                                                    [multiple]="false" bindValue="id" searchable="true"
                                                    bindLabel="risk_control_plan_language_title"
                                                    [(ngModel)]="controlPlan"
                                                    [disabled]="EventRiskTreatmentStore.riskTreatmentList?.length>0 && controlPlan!=null"
                                                    (search)="searchRiskControlPlan($event)"
                                                    (clear)="getRiskControlPlan()" (open)="getRiskControlPlan()"
                                                    (change)="saveControlPlan()" autocomplete="new-password">

                                                </ng-select> -->
                                            </div>
                                            <!-- <h6 class="pt-2" *ngIf="controlPlan!=null">{{controlPlan.risk_control_plan_language_title?controlPlan.risk_control_plan_language_title:controlPlan.language[0]?.pivot?.title}}</h6> -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- <div class="clearfix" *ngIf="controlData">
                                <div class="float-right">
                                    <div class="question-circle-inp d-inline-block"
                                        style="vertical-align: middle; margin: -2px 0 0 15px; position: relative;">
                                        <i class="far fa-question-circle"></i>
                                        <div class="message-password-inp bottom-show">
                                            <p class="mb-0">
                                                {{controlData.risk_control_plan_language_title?controlData.risk_control_plan_language_title:controlData?.language[0]?.pivot?.description}}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                    </div>

                    <div class="col-lg-4  pdg-tab-and-mbl col-sm-6 text-center d-flex justify-content-center pb-0">
                        <div class="risk-treatment-top-box risk-treatment-box-four">
                            <div class="divide-style">
                                <h3 class="mb-0">
                                    {{EventRiskTreatmentStore.summaryDetails.closed_count}}/<span>{{EventRiskTreatmentStore.summaryDetails.total_count}}</span><label
                                        class="mb-0">{{'closed'|translate}}</label></h3>
                            </div>

                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-6 pdg-tab-and-mbl pb-0 d-flex justify-content-end">
                        <div class="risk-treatment-top-box risk-treatment-box-three">

                            <label class="indication-label indication-label-blue ml-0 mb-0"
                                style="margin-top: 0;
                                                padding: 13px 50px;
                                                font-size: 17px;">{{EventRiskTreatmentStore.summaryDetails?.completed_percentage?EventRiskTreatmentStore.summaryDetails?.completed_percentage:0}}%
                                {{'closed' | translate}}</label>
                        </div>
                    </div>

                </div>
                <div class="row mt-3">
                    <div class="col-sm-12">
                        <!-- <h6>Risk Treatment Plan</h6> -->
                        <p style="white-space: pre-line;">
                            {{RiskRegisterStore?.individualRiskRegisterDetails?.risk_treatment_plan}}
                        </p>
                    </div>
                </div>

            </div>
        </div>


        <div class="mt-3"
            *ngIf="EventRiskTreatmentStore.riskTreatmentList.length>0">
            <!-- common-tab-md starts -->
            <div class="common-tab-md clearfix">
                <div class="tab-common-left-md">
                    <div class=" issues-tab">
                        <!-- tab menu start -->
                        <ul class="nav nav-tabs nav-tabs--vertical nav-tabs--left vertical-tab" role="navigation">
                            <li class="nav-item"
                                *ngFor="let treatment of EventRiskTreatmentStore.riskTreatmentList| paginate: {currentPage:EventRiskTreatmentStore?.currentPage, itemsPerPage:EventRiskTreatmentStore?.itemsPerPage,totalItems:EventRiskTreatmentStore?.totalItems};let num = index"
                                (click)="getRiskTreatment(treatment.id)">
                                <a href="#risk-treatment-tab-one"
                                    [ngClass]="treatment.id==activeTreatment?'nav-link active':'nav-link'"
                                    data-toggle="tab" role="tab" aria-controls="lorem" aria-selected="false"
                                    data-original-title="" title="{{treatment.title}}">
                                    #{{treatment.reference_code?treatment.reference_code:'XXXXX'}}-
                                    {{treatment.title?.length>30?treatment.title.substring(0,30)+'...' :
                                    treatment.title}}
                                    <span
                                        [ngClass]="'draft-tag draft-tag-'+treatment.label+' label-tag-style-tag label-left-arow-tag'">
                                        {{treatment.risk_treatment_status_title}}</span></a>
                            </li>

                        </ul>
                    </div>
                    <!-- tab menu end -->
                </div>


                <div class="tab-common-left-content-m bg-white cmn-bdr widg-padding-cmn edit-and-delete-main"
                    *ngIf="EventRiskTreatmentStore.individualTreatmentLoaded">

                    <div class="edit-option-show" style="margin: 27px 14px 0 0;">

                        <a class="pointer" [attr.title]="'Close Treatment'|translate"
                            *ngIf="EventRiskTreatmentStore?.riskTreatmentDetails.risk_treatment_status.type=='resolved' && AuthStore.getActivityPermission(900,'CLOSE_RISK_TREATMENT')
                            && RiskRegisterStore.individualRiskRegisterDetails?.risk_status?.type!='closed' && this.getResponsiblePresent(AuthStore.user.id)"
                            (click)="closeRiskTreatment(EventRiskTreatmentStore.riskTreatmentDetails.id)"><i
                                class="fas fa-times"></i></a>
                        <a class="pointer" [attr.title]="'history'|translate" (click)="openHistoryModal()"
                            *ngIf="AuthStore.getActivityPermission(900,'RISK_TREATMENT_COMMENT_LIST')"><i
                                class="fas fa-history"></i></a>
                        <a class="pointer" [attr.title]="'update'|translate" (click)="openUpdateModal()"
                            *ngIf="EventRiskTreatmentStore?.riskTreatmentDetails.risk_treatment_status.type!='closed' && AuthStore.getActivityPermission(900,'CREATE_RISK_TREATMENT_COMMENT') && OrganizationModulesStore.checkIndividualSubModule(900,34301)
                            &&RiskRegisterStore.individualRiskRegisterDetails?.risk_status?.type!='closed' && RiskRegisterStore.isProperEditUser()"><i class="fas fa-pen-alt"></i></a>
                        <a class="pointer" [attr.title]="'edit'|translate" (click)="editTreatment()"
                            *ngIf="AuthStore.getActivityPermission(900,'UPDATE_RISK_TREATMENT') && EventRiskTreatmentStore?.riskTreatmentDetails.risk_treatment_status.type!='closed' && RiskRegisterStore.individualRiskRegisterDetails?.risk_status?.type!='closed' && RiskRegisterStore.isProperEditUser()"><i
                                class="fas fa-pen"></i></a>
                        <a class="pointer" [attr.title]="'delete'|translate"
                            (click)="deleteRiskTreatment(EventRiskTreatmentStore.riskTreatmentDetails.id)"
                            *ngIf="getResponsiblePresent(AuthStore.user?.id) && AuthStore.getActivityPermission(900,'DELETE_RISK_TREATMENT') && EventRiskTreatmentStore?.riskTreatmentDetails.risk_treatment_status.type!='closed' && EventRiskTreatmentStore?.riskTreatmentDetails?.risk_treatment_status.type!='resolved'
                            && RiskRegisterStore.individualRiskRegisterDetails?.risk_status?.type!='closed' && RiskRegisterStore.isProperEditUser()"><i class="fas fa-trash"></i></a>

                    </div>

                    <div class="tab-content">
                        <div class="tab-pane fade active show" id="risk-treatment-tab-one" role="tabpanel">
                            <div class="bg-white">
                                <div class="row issuue-new-style p-0">
                                    <div class="col-lg-8 col-sm-12">
                                        <div class="issue-top-sec">
                                            <div class="clearfix">

                                                <h5 class="d-inline-block cmn-head-style label-tag-style mr-2"><span
                                                        class="issue-smoal-head-text">#{{EventRiskTreatmentStore.riskTreatmentDetails.reference_code?EventRiskTreatmentStore.riskTreatmentDetails.reference_code:'XXXXX'}}</span>
                                                    {{EventRiskTreatmentStore.riskTreatmentDetails.title}}
                                                    <span
                                                        [ngClass]="'draft-tag draft-tag-'+EventRiskTreatmentStore?.riskTreatmentDetails?.risk_treatment_status?.label+' label-tag-style-tag label-left-arow-tag d-inline-block status-tag-new-one ml-3'">
                                                        {{EventRiskTreatmentStore.riskTreatmentDetails.risk_treatment_status.language[0].pivot.title}}</span>
                                                </h5>

                                            </div>
                                            <div class="clearfix d-inline-block">
                                                <label class="indication-label indication-label-red ml-0"
                                                    *ngIf="EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='resolved' && EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='closed'">{{createDaysString(EventRiskTreatmentStore.riskTreatmentDetails.days_remaining)}}
                                                    {{'remaining' | translate}}</label><span
                                                    class="small-text pt-1 pl-2">{{EventRiskTreatmentStore.riskTreatmentDetails?.percentage?EventRiskTreatmentStore.riskTreatmentDetails?.percentage:0}}%
                                                    {{'completed' | translate}}</span>
                                                <span class="ml-2 mr-2"
                                                    *ngIf="EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='resolved'&&EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='closed'">|</span>
                                                <span
                                                    *ngIf="EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='resolved'&&EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='closed' && EventRiskTreatmentStore.riskTreatmentDetails?.latest_risk_treatment_update?.revised_target_date!=null"
                                                    [ngClass]="getDays(EventRiskTreatmentStore.riskTreatmentDetails?.latest_risk_treatment_update?.revised_target_date) < 0 ? 'bold text-red' : 'bold text-green'">
                                                    <!-- Revised-{{getDays(EventRiskTreatmentStore.riskTreatmentDetails?.latest_risk_treatment_update?.revised_target_date)}} -->
                                                    {{getDays(EventRiskTreatmentStore.riskTreatmentDetails?.latest_risk_treatment_update?.revised_target_date) < 0 ? 'Overdue' : 'In Progress' }}</span>
                                                <span
                                                    *ngIf="EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='resolved'&&EventRiskTreatmentStore.riskTreatmentDetails?.risk_treatment_status?.type!='closed' && EventRiskTreatmentStore.riskTreatmentDetails?.latest_risk_treatment_update?.revised_target_date==null"
                                                    [ngClass] = "getDays(EventRiskTreatmentStore.riskTreatmentDetails?.start_date) > 0 ? 'bold text-green' : getDays(EventRiskTreatmentStore.riskTreatmentDetails?.target_date) < 0 ? 'bold text-red' : 'bold text-green'">
                                                    <!-- [ngClass]="getDays(EventRiskTreatmentStore.riskTreatmentDetails?.target_date)>0?'bold text-red':'bold text-green'" -->
                                                    {{getDays(EventRiskTreatmentStore.riskTreatmentDetails?.start_date) > 0 ? 'Yet To Start' : getDays(EventRiskTreatmentStore.riskTreatmentDetails?.target_date) < 0 ? 'Overdue' : 'In Progress'}}</span>
                                            </div>
                                            <div class="clearfix">
                                                <h6>{{'treatment_description'|translate}}</h6>
                                                <p style="white-space: pre-line;">
                                                    {{EventRiskTreatmentStore.riskTreatmentDetails.description?EventRiskTreatmentStore.riskTreatmentDetails.description:AppStore.noContentText}}
                                                </p>
                                            </div>




                                        </div>

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="label-and-user-pic user-big-pic">
                                                    <h6>{{'responsible_user'|translate}}</h6>
                                                    <app-user-popup-box id="jd"
                                                        *ngIf="EventRiskTreatmentStore.riskTreatmentDetails?.responsible_user"
                                                        [source]="getPopupDetails(EventRiskTreatmentStore.riskTreatmentDetails?.responsible_user)">
                                                    </app-user-popup-box>
                                                </div>
                                                <div *ngIf="!EventRiskTreatmentStore.riskTreatmentDetails?.responsible_user">
                                                    {{AppStore.noContentText}}</div>

                                            </div>
                                            <div class="col-md-4">
                                                <div class="label-and-user-pic user-big-pic">
                                                    <h6>{{'risk_owner'|translate}}</h6>
                                                    <div class="d-flex"
                                                    *ngIf="RiskRegisterStore.individualRiskRegisterDetails.risk_owner">
                                                    <ng-container>
                                                        <app-user-popup-box
                                                            [source]="getPopupDetails(RiskRegisterStore.individualRiskRegisterDetails.risk_owner)">
                                                        </app-user-popup-box>
                                                    </ng-container>
                                                </div>
                                                <p
                                                    *ngIf="!RiskRegisterStore.individualRiskRegisterDetails.risk_owner">
                                                    {{AppStore.noContentText}}</p>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <h6>{{'treatment_dependency'|translate}}</h6>
                                                <p style="white-space: pre-line;">
                                                    {{EventRiskTreatmentStore.riskTreatmentDetails.treatment_dependency?EventRiskTreatmentStore.riskTreatmentDetails.treatment_dependency:AppStore.noContentText}}
                                                </p>
                                            </div>
                                        </div>



                                        <div class="row">
                                            <div class="col-md-4"
                                                *ngIf="RiskManagementSettingStore.loaded && RiskManagementSettingStore.riskManagementSettings.is_budget">
                                                <h6>{{'budget' | translate}}({{OrganizationGeneralSettingsStore?.organizationSettings?.currency}}) </h6>
                                                <p>{{EventRiskTreatmentStore.riskTreatmentDetails.budget?EventRiskTreatmentStore.riskTreatmentDetails.budget:AppStore.noContentText}}
                                                </p>

                                            </div>

                                            <div class="col-md-4">
                                                <h6>{{'start_date' | translate}}</h6>
                                                <p>{{EventRiskTreatmentStore.riskTreatmentDetails.start_date|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                                </p>
                                            </div>
                                            <div class="col-md-4">
                                                <h6>{{'target_date' | translate}}</h6>
                                                <p>{{EventRiskTreatmentStore.riskTreatmentDetails.target_date|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                                </p>
                                            </div>


                                        </div>


                                        <div class="row"
                                            *ngIf="EventRiskTreatmentStore?.riskTreatmentDetails?.latest_risk_treatment_update">
                                            <div class="col-md-4"
                                                *ngIf="EventRiskTreatmentStore.riskTreatmentDetails.latest_risk_treatment_update?.actual_start_date">
                                                <h6>{{'actual_start_date' | translate}}</h6>
                                                <p>{{EventRiskTreatmentStore.riskTreatmentDetails.latest_risk_treatment_update?.actual_start_date|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                                </p>
                                            </div>
                                            <div class="col-md-4"
                                                *ngIf="EventRiskTreatmentStore.riskTreatmentDetails.latest_risk_treatment_update?.revised_target_date">
                                                <h6>{{'revised_due_date' | translate}}</h6>
                                                <p>{{EventRiskTreatmentStore.riskTreatmentDetails.latest_risk_treatment_update?.revised_target_date|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                                </p>
                                            </div>

                                        </div>




                                        <div class="row">
                                            <div class="col-md-12">
                                                <h6>{{'risk_title'|translate}}</h6>
                                                <p>#{{EventRiskTreatmentStore.riskTreatmentDetails?.risk?.reference_code}}
                                                    {{EventRiskTreatmentStore.riskTreatmentDetails?.risk?.title?EventRiskTreatmentStore.riskTreatmentDetails?.risk?.title:AppStore.noContentText}}
                                                </p>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <h6>{{'risk_description'|translate}}</h6>
                                                <p class="pt-1"
                                                    [innerHTML]="EventRiskTreatmentStore.riskTreatmentDetails?.risk?.description?EventRiskTreatmentStore.riskTreatmentDetails?.risk?.description:AppStore.noContentText">
                                                </p>
                                            </div>
                                        </div>
                                        <div class="row">

                                            <!-- <div class="col-md-6"
                                                *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_subsidiary">
                                                <h6>{{'organizations' | translate}}</h6>
                                                <p>{{RiskRegisterStore?.individualRiskRegisterDetails?.organizations?.length>0?getArrayFormatedString('title',RiskRegisterStore?.individualRiskRegisterDetails?.organizations):AppStore.noContentText}}
                                                </p>
                                            </div>

                                            <div class="col-md-6"
                                                *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_division">
                                                <h6>{{'divisions' | translate}}</h6>
                                                <p>{{RiskRegisterStore?.individualRiskRegisterDetails?.divisions?.length>0?getArrayFormatedString('title',RiskRegisterStore?.individualRiskRegisterDetails?.divisions):AppStore.noContentText}}
                                                </p>
                                            </div>
                                            <div class="col-md-6"
                                                *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_department">
                                                <h6>{{'departments' | translate}}</h6>
                                                <p>{{RiskRegisterStore?.individualRiskRegisterDetails?.departments?.length>0?getArrayFormatedString('title',RiskRegisterStore?.individualRiskRegisterDetails?.departments):AppStore.noContentText}}
                                                </p>
                                            </div>

                                            <div class="col-md-6"
                                                *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_section">
                                                <h6>{{'sections' | translate}}</h6>
                                                <p>{{RiskRegisterStore?.individualRiskRegisterDetails?.sections?.length>0?getArrayFormatedString('title',RiskRegisterStore?.individualRiskRegisterDetails?.sections):AppStore.noContentText}}
                                                </p>
                                            </div>

                                            <div class="col-md-6"
                                                *ngIf="OrganizationLevelSettingsStore.organizationLevelSettings?.is_sub_section">
                                                <h6>{{'sub_sections' | translate}}</h6>
                                                <p>{{RiskRegisterStore?.individualRiskRegisterDetails?.sub_sections?.length>0?getArrayFormatedString('title',RiskRegisterStore?.individualRiskRegisterDetails?.sub_sections):AppStore.noContentText}}
                                                </p>
                                            </div> -->

                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="label-and-user-pic">
                                                    <h6 class="mb-0">{{'watchers' | translate}}</h6>
                                                    <div class="row">
                                                        <div class="col-lg-12 col-sm-6">
                                                    
                                                            <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix" *ngIf="EventRiskTreatmentStore.riskTreatmentDetails.watchers.length!=0">
                                                                <li *ngFor="let watcher of EventRiskTreatmentStore.riskTreatmentDetails.watchers" class="rounde-hov-bg">
                                                                    <app-user-popup-box [source]="getWatcherPopupDetails(watcher)" [showName]="false" [activateButtons]="true">
                                                                    </app-user-popup-box>
                                                                </li>
                                                            </ul>
                                                            <p *ngIf="EventRiskTreatmentStore.riskTreatmentDetails.watchers.length==0">{{AppStore.noContentText}}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row mt-1">
                                            <div class="col-sm-12">

                                                <div class="audit-form-table w-100 table-align-top not-fixed-table"
                                                    *ngIf="EventRiskTreatmentStore.treatmentUpdateDataLoaded && EventRiskTreatmentStore.historyData.length>0">
                                                    <table
                                                        class="table table-bordered ordinary-table audit-page-table mb-3 table-scroll">
                                                        <thead>
                                                            <tr>
                                                                <th class="border-top-0" style="width: 4%;">#</th>
                                                                <th class="border-top-0" style="width: 24%;">
                                                                    {{'actions'|translate}}</th>

                                                                <!-- <th class="border-top-0" style="width: 8%;">Responsibility</th> -->
                                                                <th class="border-top-0" style="width: 8%;">
                                                                    %{{'completed'|translate}}</th>
                                                                <!-- <th class="border-top-0" style="width: 13%;">Proposed Start Date</th> -->
                                                                <th class="border-top-0" style="width: 15%;">
                                                                    {{'actual_start_date'|translate}}</th>
                                                                <!-- <th class="border-top-0" style="width: 8%;">Baseline Due Date</th> -->
                                                                <th class="border-top-0" style="width: 15%;">
                                                                    {{'revised_due_date'|translate}}</th>
                                                                <th class="border-top-0" style="width: 16%;"
                                                                    colspan="2">{{'status'|translate}}</th>

                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr
                                                                *ngFor="let history of EventRiskTreatmentStore.historyData| paginate: {id:'historyTreatmentUpdate',currentPage:EventRiskTreatmentStore?.historyCurrentPage, itemsPerPage:EventRiskTreatmentStore?.historyItemsPerPage,totalItems:EventRiskTreatmentStore?.historyTotalItems};let num = index">
                                                                <td>{{(EventRiskTreatmentStore?.historyCurrentPage - 1) *
                                                                    EventRiskTreatmentStore?.historyItemsPerPage + (num +1)}}
                                                                </td>
                                                                <td>{{history.comment?history.comment:AppStore.noContentText}}
                                                                </td>
                                                                <!-- <td></td> -->
                                                                <td>{{history.percentage?history.percentage:AppStore.noContentText}}
                                                                </td>
                                                                <td>{{history.actual_start_date?history.actual_start_date:AppStore.noContentText}}
                                                                </td>
                                                                <!-- <td></td> -->
                                                                <td>{{history.revised_target_date?history.revised_target_date:AppStore.noContentText}}
                                                                </td>
                                                                <!-- <td></td> -->

                                                                <td><span
                                                                        [ngClass]="'dot-div '+history.label+'-dot'"></span>{{history.risk_treatment_status_title}}
                                                                </td>
                                                                <!-- <td></td> -->

                                                            </tr>

                                                        </tbody>
                                                    </table>
                                                    <ul class="pagination justify-content-center mt-3"
                                                        *ngIf="EventRiskTreatmentStore?.historyTotalItems>EventRiskTreatmentStore?.historyItemsPerPage">
                                                        <pagination-controls (pageChange)="historyPageChange($event)"
                                                            class="my-pagination" id="historyTreatmentUpdate">
                                                        </pagination-controls>
                                                    </ul>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">


                                            <div class="col-sm-12"
                                                *ngIf="EventRiskTreatmentStore?.totalItems>EventRiskTreatmentStore?.itemsPerPage">
                                                <ul class="pagination justify-content-center mt-3">
                                                    <pagination-controls (pageChange)="pageChange($event)"
                                                        class="my-pagination"></pagination-controls>
                                                </ul>

                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-lg-4 col-sm-12 tab-and-mbl-right-top-mgn">

                                        <div class="bg-white cmn-bdr mt-3 p-2 pb-4">
                                            <h6>{{'risk_treatment'|translate}} % {{'completed' | translate}}</h6>
                                            <hr class="mt-0 mb-3">
                                            <div class="residual-risk-graph text-center">
                                                <div class="progress-round-small btm-top-pdg w-100">

                                                    <div
                                                        [ngClass]="EventRiskTreatmentStore?.riskTreatmentDetails?.percentage>50?'progress-circle over50 p'+EventRiskTreatmentStore?.riskTreatmentDetails?.percentage:'progress-circle p'+EventRiskTreatmentStore?.riskTreatmentDetails?.percentage">
                                                        <span>{{EventRiskTreatmentStore?.riskTreatmentDetails?.percentage>0?EventRiskTreatmentStore?.riskTreatmentDetails?.percentage:0}}%</span>
                                                        <div class="left-half-clipper">
                                                            <div class="first50-bar"></div>
                                                            <div class="value-bar"></div>
                                                        </div>
                                                    </div>

                                                </div>

                                            </div>

                                        </div>

                                        <div class="bg-white cmn-bdr mt-3 p-2 pb-3"
                                            *ngIf="RiskManagementSettingStore.loaded && RiskManagementSettingStore.riskManagementSettings.is_budget">
                                            <h6>{{'budget_allocation_vs_used' | translate}}</h6>
                                            <hr class="mt-0 mb-3">

                                            <div class="progress-round-small btm-top-pdg w-100">

                                                <div
                                                    [ngClass]="EventRiskTreatmentStore?.riskTreatmentDetails?.budget_vs_used_percentage>50?'progress-circle over50 p'+EventRiskTreatmentStore?.riskTreatmentDetails?.budget_vs_used_percentage:'progress-circle p'+EventRiskTreatmentStore?.riskTreatmentDetails?.budget_vs_used_percentage">
                                                    <span>{{EventRiskTreatmentStore?.riskTreatmentDetails?.budget_vs_used_percentage>0?EventRiskTreatmentStore?.riskTreatmentDetails?.budget_vs_used_percentage:0}}%</span>
                                                    <div class="left-half-clipper">
                                                        <div class="first50-bar"></div>
                                                        <div class="value-bar"></div>
                                                    </div>
                                                </div>
                                                <!-- <p class="mb-0">{{document.assessment_count}} {{'assessments'|translate}}</p> -->
                                            </div>
                                            <h5 class="text-light-blue text-center pt-2">
                                                {{OrganizationGeneralSettingsStore?.organizationSettings?.currency}}
                                                {{EventRiskTreatmentStore?.riskTreatmentDetails?.amount_used?EventRiskTreatmentStore?.riskTreatmentDetails?.amount_used:0}}/
                                                {{OrganizationGeneralSettingsStore?.organizationSettings?.currency}}
                                                {{EventRiskTreatmentStore?.riskTreatmentDetails?.budget>0?EventRiskTreatmentStore?.riskTreatmentDetails?.budget:0}}
                                            </h5>
                                        </div>

                                        <div class="bg-white cmn-bdr mt-3 p-2 pb-3">
                                            <h6>
                                                {{'days_remaining' | translate}}</h6>
                                            <hr class="mt-0 mb-3">
                                            <div class="clearfix">
                                                <div class="dot-and-text mt-4">
                                                    <span
                                                        class="dot-div-new font-normal mb-0 dot-green d-block">{{'remaining_days'|translate}}
                                                        ({{createDaysString(EventRiskTreatmentStore.riskTreatmentDetails.days_remaining)}})</span><span
                                                        class="dot-div-new font-normal mb-0 dot-red d-block">{{'total_days'|translate}}({{createDaysString(EventRiskTreatmentStore.riskTreatmentDetails.total_days)}})</span>
                                                </div>
                                            </div>
                                            <div class="vertical-progress-v2">
                                                <div class="progress-bg-sec">
                                                    <div class="progress-inner-color"
                                                        [style.height.%]="(EventRiskTreatmentStore.riskTreatmentDetails.days_remaining/EventRiskTreatmentStore.riskTreatmentDetails.total_days)*100">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-xl-12">
                                        <hr>
                                        <app-user-popup-box id="cb"
                                            [source]="getCreatedPopupDetails(EventRiskTreatmentStore.riskTreatmentDetails.created_by)">
                                        </app-user-popup-box>

                                    </div>
                                </div>


                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- common-tab-md end -->
        </div>

    </div>

    <ng-container *mobxAutorun>
        <div *ngIf="!EventRiskTreatmentStore.loaded">
            <app-risk-treatment-detail-loader></app-risk-treatment-detail-loader>
        </div>
    </ng-container>
</ng-container>
<ng-container *ngIf="(RiskRegisterStore.individualLoaded && !RiskRegisterStore?.individualRiskRegisterDetails?.is_analysis_performed)||EventRiskTreatmentStore.riskTreatmentList.length==0">
    <app-no-data [border]=false></app-no-data>
</ng-container>

<div class="modal modal-style-1 popup-full-width fade show" id="updatePopup" style="overflow: auto;"
    data-keyboard="false" data-backdrop="static" #updatePopup>
    <app-risk-treatment-update *ngIf="updateObject.type" [source] = "updateForm.value"></app-risk-treatment-update>
</div>

<div class="modal modal-style-1 popup-full-width fade show" id="treatment-Popup"
    data-keyboard="false" data-backdrop="static" #treatmentPopup>
    <app-add-risk-treatment *ngIf="riskTreatmentObject.type" [source] = "riskTreatmentObject"></app-add-risk-treatment>
</div>

<!------------------- Delete Confirmation Modal Start --------------------------->

<div class="modal modal-style-1 fade" id="delete-popup" data-backdrop="static" data-keyboard="false" #deletePopup>
    <app-delete-popup [source]="deleteObject"></app-delete-popup>
</div>

<!------------------- Delete Confirmation Modal End --------------------------->

<div class="modal modal-style-1 fade popup-full-width" id="risk-update-treatment-popup" data-keyboard="false"
    data-backdrop="static" #historyPopup *mobxAutorun>
    <button type="button" class="close" (click)="closeHistoryModal()"><i class="lni-close"></i><span>{{'esc' |
            translate}}</span></button>
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4
                    [ngClass]="EventRiskTreatmentStore.treatmentUpdateDataLoaded && EventRiskTreatmentStore.historyData.length>0?'modal-title text-center':'modal-title'">
                    {{'risk_treatment_update_history' | translate}}</h4>
            </div>

            <div class="modal-body form-body">

                <div class="row">
                    <div class="col-sm-12"
                        *ngIf="EventRiskTreatmentStore.treatmentUpdateDataLoaded && EventRiskTreatmentStore.historyData.length>0">
                        <div class="cmn-bdr risk-treatment-update-history mb-3"
                            *ngFor="let history of EventRiskTreatmentStore.historyData| paginate: {id:'history',currentPage:EventRiskTreatmentStore?.historyCurrentPage, itemsPerPage:EventRiskTreatmentStore?.historyItemsPerPage,totalItems:EventRiskTreatmentStore?.historyTotalItems};let num = index">
                            <div class="row mb-3 align-items-center">
                                <div class="col-lg-6 col-sm-12">
                                    <div class="d-flex flex-row user-list-sm p-0">
                                        <!-- <img [attr.src]="history.created_by_image_token?createImageUrl('user',history.created_by_image_token):getDefaultImage('user-logo')"
                                            class="rounded-circle" width="30px" height="30px"> -->
                                        <div>
                                            <h6>{{history.created_by_first_name}} {{history.created_by_last_name}}</h6>
                                            <span>{{history.created_by_designation}} | {{'updated_at'|translate}}
                                                {{history.created_at|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-sm-12">
                                    <p class="dot-color-p mb-0 d-inline-block"><span
                                            [ngClass]="history.label?'dot-div '+history.label+'-dot':'dot-div green-dot'"></span>{{history.risk_treatment_status_title}}
                                    </p>
                                    <h6 class="d-inline-block text-light-blue bold mb-0 cmn-head-style ml-3">
                                        {{history.percentage?history.percentage:0}}%</h6>
                                </div>
                                <div class="col-lg-3 col-sm-12"
                                    *ngIf="RiskManagementSettingStore.loaded && RiskManagementSettingStore.riskManagementSettings.is_budget">
                                    <h3 class="price-text-cmn mb-0">
                                        {{OrganizationGeneralSettingsStore?.organizationSettings?.currency}}
                                        {{history.amount_used?history.amount_used:0}}</h3>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6 col-sm-12">
                                    <h6>{{'actual_start_date'|translate}}</h6>
                                    <p *ngIf="history.actual_start_date">
                                        {{history.actual_start_date|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                    </p>
                                    <p *ngIf="!history.actual_start_date">{{AppStore.noContentText}}</p>

                                </div>
                                <div class="col-lg-6 col-sm-12">
                                    <h6>{{'revised_due_date'|translate}}</h6>
                                    <p *ngIf="history.revised_target_date">
                                        {{history.revised_target_date|date:OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                    </p>
                                    <p *ngIf="!history.revised_target_date">{{AppStore.noContentText}}</p>

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                    <p>{{history.comment?history.comment:''}}</p>
                                </div>
                            </div>
                            <div class="row" *ngIf="history.documents.length>0">
                                <div class="col-sm-12">
                                    <h6>{{'attachments' | translate}}</h6>
                                    <div class="thumb-pics-bg thumb-pics-col-3 thumb-pics-fix-text clearfix" style="padding-top: 0"
                                        *ngIf="history?.documents.length != 0">
                                        <div class="thumb-pics"
                                            *ngFor="let docs of history?.documents;let i = index">
                            
                                            <!-- System Files Starts Here -->
                                            <div class="upload-pics edit-option" *ngIf="!docs.document_id"
                                                (click)="viewDocument('risk-treatment-documents',docs,docs,history.id)">
                                                <div class="browse-form-pic"
                                                    [ngStyle]="{'background': 'url('+createImageUrl('risk-treatment-documents',docs?.token)+') no-repeat'}">
                                                </div>
                                                <div class="browse-form-name clearfix">
                                                    <div class="float-left">
                                                        <h6>{{docs.title?docs.title:docs.name?docs.name:docs.version_title?docs.version_title:"NA"}}.{{docs.ext}}
                                                        </h6>
                                                        <span>{{docs.size/1048576 |
                                                            number:'0.2-2'}}MB</span><span class="text-blue bold pl-2">System</span>
                                                    </div>
                                                    <div class="browse-logo">
                                                        <img *ngIf="checkExtension(docs.ext,'image') != -1" class="folder-picher"
                                                            src="/assets/images/jpg-icone.png">
                                                        <img *ngIf="checkExtension(docs.ext,'doc') != -1" class="folder-picher"
                                                            src="/assets/images/word-icone.png">
                                                        <img *ngIf="checkExtension(docs.ext,'pdf') != -1" class="folder-picher"
                                                            src="/assets/images/pdf-icone.png">
                                                        <img *ngIf="checkExtension(docs.ext,'excel') != -1" class="folder-picher"
                                                            src="/assets/images/excel-icone.png">
                                                        <img *ngIf="checkExtension(docs.ext,'video') != -1" class="folder-picher"
                                                            src="/assets/images/md-video.png">
                                                        <img *ngIf="checkExtension(docs.ext,'audio') != -1" class="folder-picher"
                                                            src="/assets/images/md-audio.png">
                                                        <img *ngIf="checkExtension(docs.ext,'ppt') != -1" class="folder-picher"
                                                            src="/assets/images/md-ppt.png">
                                                    </div>
                                                </div>
                                                <div class="edit-option-show">
                                                    <a><i class="fas fa-download" (click)="downloadDocumentFile('risk-treatment-documents',docs)"></i></a>
                                                </div>
                                            </div>
                                            <div class="upload-pics edit-option" *ngIf="docs.document_id">
                            
                                                <div *ngFor="let mainDoc of docs.kh_document.versions"
                                                    (click)="viewDocument('document-version',docs,mainDoc)">
                                                    <div *ngIf="mainDoc.is_latest">
                                                        <div class="browse-form-pic"
                                                            [ngStyle]="{'background': 'url('+createImageUrl('document-version',mainDoc?.token)+') no-repeat'}">
                                                        </div>
                                                        <div class="browse-form-name clearfix">
                                                            <div class="float-left">
                                                                <h6>{{mainDoc.title}}.{{mainDoc.ext}}
                                                                </h6>
                                                                <span>{{mainDoc.size/1048576 |
                                                                    number:'0.2-2'}}MB</span><span class="text-blue bold pl-2">Knowledge
                                                                    Hub</span>
                                                            </div>
                                                            <div class="browse-logo">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'image') != -1" class="folder-picher"
                                                                    src="/assets/images/jpg-icone.png">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'doc') != -1" class="folder-picher"
                                                                    src="/assets/images/word-icone.png">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'pdf') != -1" class="folder-picher"
                                                                    src="/assets/images/pdf-icone.png">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'excel') != -1" class="folder-picher"
                                                                    src="/assets/images/excel-icone.png">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'video') != -1" class="folder-picher"
                                                                    src="/assets/images/md-video.png">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'audio') != -1" class="folder-picher"
                                                                    src="/assets/images/md-audio.png">
                                                                <img *ngIf="checkExtension(mainDoc.ext,'ppt') != -1" class="folder-picher"
                                                                    src="/assets/images/md-ppt.png">
                                                            </div>
                                                        </div>
                                                        <div class="edit-option-show">
                                                            <a><i class="fas fa-download"
                                                                    (click)="downloadDocumentFile('document-version',docs,mainDoc)"></i></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ul class="pagination justify-content-center mt-3"
                            *ngIf="EventRiskTreatmentStore?.historyTotalItems>EventRiskTreatmentStore?.historyItemsPerPage">
                            <pagination-controls (pageChange)="historyPageChange($event)" class="my-pagination"
                                id="history"></pagination-controls>
                        </ul>

                        <!-- </div> -->
                    </div>
                    <div class="col-sm-12"
                        *ngIf="EventRiskTreatmentStore.treatmentUpdateDataLoaded && EventRiskTreatmentStore.historyData.length==0">
                        <app-no-data-list [source]="historyEmptyList" [border]=false>

                        </app-no-data-list>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- risk-update-treatment-popup End -->


<!-- preview component for image preview -->
<div class="modal modal-style-1 popup-full-width fade popup-new-type" id="add-three-popup" data-keyboard="false"
    data-backdrop="static" #filePreviewModal *mobxAutorun>
    <button type="button" class="close" data-dismiss="modal" (click)="closePreviewModal($event)"><i
            class="lni-close"></i><span>esc</span></button>
    <!-- <app-bcm-preview *ngIf="previewObject" [source]="previewObject" (close)="closePreviewModal($event)">
    </app-bcm-preview> -->
</div>
<!-- preview modal end -->
