<main class="audit-program-details-page mt-3" *ngIf="SLAContractStore?.slaDetails_loaded && SLAContractStore?.slaContractDetails">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="widget">
                    <div class="row">
                        <div class="col-lg-8 col-sm-12 padding-right-0">
                            <div class="bg-white widg-padding-cmn">
                                <!-- <div class="edit-option-show" style="margin: 27px 14px 0 0;">
                                    <a (click)="openWorkflowPopup()"><i class="fas fa-tasks"></i><span>{{'workflow'|translate}}</span></a>
                                    <a (click)="openHistoryPopup()"><i class="fas fa-history"></i><span>{{'history'|translate}}</span></a>
                                   
                                </div> -->
                                <div class="min-height-64">
                                <div class="issue-top-sec">
                                    <div class="clearfix">
                                        <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                class="issue-smoal-head-text">#{{SLAContractStore.slaContractDetails?.reference_code}}</span>
                                            {{SLAContractStore?.slaContractDetails?.title}}
                                            <span *ngIf="SLAContractStore?.slaContractDetails?.versions[0]?.sla_status?.language[0]?.pivot?.title"
                                                class="draft-tag label-tag-style-tag label-left-arow-tag"
                                                [ngClass]="SLAContractStore?.slaContractDetails?.versions.length > 0 ? getStatusColorKey() : ''"
                                                style="line-height: 16px; vertical-align: middle; margin-top: -4px; display: inline-block;">
                                                {{SLAContractStore?.slaContractDetails?.versions[0]?.sla_status?.language[0]?.pivot?.title}}</span>
                                        </h5>
                                    </div>
                                    <div class="clearfix">
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.versions[0]?.issue_date && SLAContractStore?.slaContractDetails?.versions[0]?.expiry_date" class="label-tag-style mb-2">
                                            <i class="fas fa-calendar-alt date-pics-two"></i>
                                            {{SLAContractStore?.slaContractDetails?.versions[0]?.issue_date | date:
                                            OrganizationGeneralSettingsStore.organizationSettings?.date_format}} -
                                            {{SLAContractStore?.slaContractDetails?.versions[0]?.expiry_date | date:
                                            OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</p>
                                    </div>
                                    <p *ngIf="SLAContractStore?.slaContractDetails?.description" style="white-space:pre-line">{{SLAContractStore?.slaContractDetails?.description}}</p>
                                </div>

                                <div class="row">
                                    <div class="col-xl-4 col-lg-6 col-sm-6" *ngIf = "OrganizationLevelSettingsStore.organizationLevelSettings?.is_subsidiary">
                                        <h6>{{'subsidiaries' | translate}}</h6>
                                        <div *ngFor="let organizations of SLAContractStore?.slaContractDetails?.organizations">
                                            <p *ngIf="SLAContractStore?.slaContractDetails?.organizations?.length != 0">{{organizations.title}}</p>
                                        </div>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.organizations?.length == 0"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6">
                                        <h6>{{'client' | translate}}</h6>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.client">{{SLAContractStore?.slaContractDetails?.client}}</p>
                                        <p *ngIf="!SLAContractStore?.slaContractDetails?.client"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6">
                                        <h6>{{'category' | translate}}</h6>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.sla_category">{{SLAContractStore?.slaContractDetails?.sla_category?.title}}</p>
                                        <p *ngIf="!SLAContractStore?.slaContractDetails?.sla_category"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6" *ngIf = "OrganizationLevelSettingsStore.organizationLevelSettings?.is_branch ">
                                        <h6>{{'branches' | translate}}</h6>
                                        <div *ngFor="let branches of SLAContractStore?.slaContractDetails?.branches">
                                            <p *ngIf="SLAContractStore?.slaContractDetails?.branches?.length != 0">{{branches.title}}</p>
                                        </div>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.branches?.length == 0"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_division ? 'none':'block'}">
                                        <h6>{{'divisions' | translate}}</h6>
                                        <!-- <p>{{SLAContractStore?.slaContractDetails?.issue_date}}</p> -->
                                        <div *ngFor="let division of SLAContractStore?.slaContractDetails?.divisions">
                                            <p *ngIf="SLAContractStore?.slaContractDetails?.divisions?.length != 0">{{division.title}}</p>
                                        </div>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.divisions?.length == 0"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_department ? 'none':'block'}">
                                        <h6>{{'departments' | translate}}</h6>
                                       
                                            <p *ngIf="SLAContractStore?.slaContractDetails?.departments?.length != 0">
                                                <span class="mr-2" *ngFor="let department of SLAContractStore?.slaContractDetails?.departments">{{department.title}},</span>
                                            </p>
                                       
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.departments?.length == 0"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_section ? 'none':'block'}">
                                        <h6>{{'sections' | translate}}</h6>
                                        <div *ngFor="let section of SLAContractStore?.slaContractDetails?.sections">
                                            <p *ngIf="SLAContractStore?.slaContractDetails?.sections?.length != 0">{{section.title}}</p>
                                        </div>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.sections?.length == 0"> {{AppStore.noContentText}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_sub_section ? 'none':'block'}">
                                        <h6>{{'sub_sections' | translate}}</h6>
                                        <div
                                            *ngFor="let subsection of SLAContractStore?.slaContractDetails?.sub_sections">
                                            <p *ngIf="SLAContractStore?.slaContractDetails?.sub_sections?.length != 0">{{subsection.title}}</p>
                                        </div>
                                        <p *ngIf="SLAContractStore?.slaContractDetails?.sub_sections?.length == 0"> {{AppStore.noContentText}}</p>
                                    </div>
                                    
                                    <div class="col-xl-4 col-lg-6 col-sm-6">
                                        <h6>{{'sla_details_product' | translate}}</h6>
                                        <p >{{SLAContractStore?.slaContractDetails?.product?.title ? SLAContractStore?.slaContractDetails?.product?.title : AppStore.noContentText}}</p>
                                        <!-- <p *ngIf="!SLAContractStore?.slaContractDetails?.product"> {{AppStore.noContentText}}</p> -->
                                    </div>
                                    <div class="col-xl-4 col-lg-6 col-sm-6">
                                        <h6>{{'sla_contract_value' | translate}}</h6>
                                        <p >{{SLAContractStore?.slaContractDetails?.contract_value ? SLAContractStore?.slaContractDetails?.contract_value : AppStore.noContentText}}</p>
                                        <!-- <p *ngIf="!SLAContractStore?.slaContractDetails?.product"> {{AppStore.noContentText}}</p> -->
                                    </div>
                                </div>
                                <h6>{{'responsible_users'|translate}}</h6>
                                <div class="pb-3" *ngIf="SLAContractStore?.slaContractDetails?.compliance_responsible_users?.length > 3">
                                    <ul class="arci-user-tab-dtl workflow-lst-pics-loop clearfix" 
                                        >
                                        <li class="rounde-hov-bg"
                                        *ngFor="let user of SLAContractStore?.slaContractDetails?.compliance_responsible_users;let i=index">
                                            <app-user-popup-box [showName]="false" [source]="getPopupDetails(user)"></app-user-popup-box>
                                        </li>
                                    </ul>
                                </div>
                                <div class="row"  *ngIf="!(SLAContractStore?.slaContractDetails?.compliance_responsible_users?.length > 3)">
                                    <div class="col-xl-4 col-lg-6 col-sm-6"
                                    *ngFor="let user of SLAContractStore?.slaContractDetails?.compliance_responsible_users; let i = index">
                                        <div class="label-and-user-pic">
                                            
                                            <!-- <div> -->
                                                <app-user-popup-box [source]="getPopupDetails(user)" [showName]="true" [activateButtons]="false">
                                                </app-user-popup-box>
                                            <!-- </div> -->
                                            <div *ngIf="SLAContractStore?.slaContractDetails?.compliance_responsible_users?.length == 0">
                                                {{AppStore.noContentText}}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" *ngIf = "checkDocumentPresent()">
                                    <div class="col-sm-12">
                                        <h6>{{'documents' | translate}}</h6>
                                        <div class="thumb-pics-bg thumb-pics-col-4 thumb-pics-fix-text clearfix">
                                            <div class="thumb-pics" *ngFor="let row of SLAContractStore?.slaContractDetails?.versions">
                                                <div class="upload-pics upload-pics-small edit-option pointer" *ngIf="row?.token != null && row?.token != ''">
                                                    <div class="browse-form-pic"
                                                        [ngStyle]="{'background': 'url('+createImageUrl('sla-contract-document',row.token)+') no-repeat'}"
                                                        (click)="viewCertificate(row)">
                                                    </div>
                                                    <div class="browse-form-name clearfix">
                                                        <div class="float-left">
                                                            <h6>{{row?.title?.length>20 ? row?.title.substring(0,20)+'
                                                                ...' : row?.title}}</h6>
                                                            <span>{{row.size/1048576 | number:'0.2-2'}}MB</span>
                                                        </div>
                                                        <div class="browse-logo">
                                                            <img *ngIf="checkExtension(row.ext,'excel') != -1"
                                                                src="/assets/images/md-xl.png" width="30px"
                                                                height="30px">
                                                            <img *ngIf="checkExtension(row.ext,'image') != -1"
                                                                src="/assets/images/md-jpg.png" width="30px"
                                                                height="30px">
                                                            <img *ngIf="checkExtension(row.ext,'doc') != -1"
                                                                src="/assets/images/md-doc.png" width="30px"
                                                                height="30px">
                                                            <img *ngIf="checkExtension(row.ext,'pdf') != -1"
                                                                src="/assets/images/md-pdf.png" width="30px"
                                                                height="30px">
                                                            <img *ngIf="checkExtension(row.ext,'video') != -1"
                                                                src="/assets/images/md-video.png" width="30px"
                                                                height="30px">
                                                            <img *ngIf="checkExtension(row.ext,'audio') != -1"
                                                                src="/assets/images/md-audio.png" width="30px"
                                                                height="30px">
                                                            <img *ngIf="checkExtension(row.ext,'ppt') != -1"
                                                                src="/assets/images/md-ppt.png" width="30px"
                                                                height="30px">
                                                        </div>
                                                    </div>
                                                    <div class="edit-option-show-inner">
                                                        <a [attr.title]="'download'|translate"
                                                            (click)="downloadCertificate(row)">
                                                            <i class="fas fa-download"></i></a>
                                                    </div>
                                                </div>
                                                <div class="col-sm-12 mb-2 edit-option" *ngIf="row?.token == ''">
                                                    <p> {{AppStore.noContentText}}</p>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <hr class="mb-2">
                                            <app-user-popup-box
                                                [source]=" getCreatedByPopupDetails(SLAContractStore?.slaContractDetails?.created_by, SLAContractStore?.slaContractDetails?.created_at)">
                                            </app-user-popup-box>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="col-lg-4 col-sm-12">

                            <div class="bg-white mb-3 widg-padding-cmn-small edit-option">
                                <div class="edit-option-show" style="margin: 35px 0px 0 0;">
                                    <a *ngIf="AuthStore.getActivityPermission(1900,'LIST_SERVICE_LEVEL_AGREEMENT_AND_CONTRACT_HISTORY')" (click)="goToHistory()"><i class="fas fa-history" [attr.title]="'history'|translate"></i></a>
                                    <!-- <a href="#"><i class="fas fa-pen"></i></a>
                                    <a href="#"><i class="fas fa-trash"></i></a> -->
                                </div>
                                <h6>{{'document_status' | translate}}</h6>
                                <hr class="mt-0 mb-3">
                                    <h5 *ngIf="SLAContractStore?.slaContractDetails?.renewed_count > 0" class="mb-3 text-center font-normal">Renewed  <span class="bold text-black">{{SLAContractStore?.slaContractDetails?.renewed_count}}</span> times</h5>
                                
                                    <div class="pending-pic">
                                        <img src="/assets/images/pending.svg" class="img-fluid">
                                    </div>
                                <div *ngIf="AuthStore.getActivityPermission(1900,'SERVICE_LEVEL_AGREEMENT_AND_CONTRACT_EXPIRY_REMINDER')">
                                    <h5 *ngIf="SLAContractStore?.slaContractDetails?.is_expired" class="cmn-head-style mb-0 text-center text-red">
                                        Your document expired {{SLAContractStore?.slaContractDetails?.no_of_days}} days ago.</h5>
                                    <h5 *ngIf="!SLAContractStore?.slaContractDetails?.is_expired" class="cmn-head-style mb-0 text-center text-green">
                                        Your document expires in {{SLAContractStore?.slaContractDetails?.no_of_days}} days.</h5>
                                </div>
                                <div class="text-center mt-3">
                                    <button type="button" data-toggle="modal" (click)="renewDocument()"
                                    *ngIf="AuthStore.getActivityPermission(1900,'RENEW_SERVICE_LEVEL_AGREEMENT_AND_CONTRACT') 
                                    && SLAContractStore?.slaContractDetails?.versions[0]?.sla_status?.language[0]?.pivot?.title != 'End Contract'
                                    && SLAContractStore?.slaContractDetails?.versions[0]?.sla_status?.language[0]?.pivot?.title != 'Archive'"
                                        class="btn">{{'renew' | translate}}</button>
                                        <button type="button" data-toggle="modal" (click)="endContractDocument()"
                                    *ngIf="AuthStore.getActivityPermission(1900,'RENEW_SERVICE_LEVEL_AGREEMENT_AND_CONTRACT') 
                                    && AuthStore.getActivityPermission(1900,'END_SERVICE_LEVEL_AGREEMENT_AND_CONTRACT') 
                                    && SLAContractStore?.slaContractDetails?.versions[0]?.sla_status?.language[0]?.pivot?.title != 'End Contract' 
                                    && SLAContractStore?.slaContractDetails?.versions[0]?.sla_status?.language[0]?.pivot?.title != 'Archive'"
                                        class="btn">{{'end_contract' | translate}}</button>
                                </div>
                                <!-- <div class="text-center mt-3">
                                    
                                </div> -->

                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>

<ng-container *mobxAutorun>
    <div *ngIf="!SLAContractStore?.slaDetails_loaded">
        <app-sla-contract-details-loader></app-sla-contract-details-loader>
    </div>
 </ng-container>

 <!-- edit modal start -->
<div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #formModal>
    <app-sla-contract-model *ngIf="formObject.type != null" [source]="formObject">
    </app-sla-contract-model>
</div>
<!-- edit modal end -->

<!-- renew modal start -->
<div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #renewModal>
    <app-sla-contract-document-renew-modal *ngIf="documentID != null" [source]="documentID">
    </app-sla-contract-document-renew-modal>
</div>
<!-- renew modal end -->

<!-- history modal start -->
<div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #historyModal>
    <app-sla-contract-document-history *ngIf="documentID != null" [source]="documentID">
    </app-sla-contract-document-history>
</div>
<!-- history modal end -->

<!------------------- Delete Confirmation Modal Start --------------------------->

<div class="modal modal-style-1 show" id="delete-popup" data-backdrop="static" data-keyboard="false" #deletePopup>
    <app-delete-popup [source]="deleteObject" *ngIf="deleteObject.id != null"></app-delete-popup>
  </div>
  
  <!------------------- Delete Confirmation Modal End --------------------------->

  <!-- preview component for image preview -->
<div class="modal modal-style-1 popup-full-width fade popup-new-type" id="add-three-popup" data-keyboard="false"
data-backdrop="static" #filePreviewModal *mobxAutorun>
<app-compliance-mangement-preview
    *ngIf="previewObject"
    [source]="previewObject">
</app-compliance-mangement-preview>
</div>
<!-- preview modal end -->

<ng-container>
    <div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #commentModal>
      <app-sla-contract-workflow-comment *ngIf="SlaContractWorkflowStore.commentForm">
      </app-sla-contract-workflow-comment>
    </div>
  </ng-container>
  
  <div class="modal modal-style-1 popup-full-width fade" id="process-popup" data-keyboard="false" data-backdrop="static"
    #workflowHistory *mobxAutorun>
    <app-sla-contract-workflow-history *ngIf="workflowHistoryOpened == true"></app-sla-contract-workflow-history>
  </div>
  
  <div class="modal modal-style-1 popup-full-width fade" id="process-popup" data-keyboard="false" data-backdrop="static"
    #workflowModal *mobxAutorun>
    <app-sla-contract-workflow-popup *ngIf="workflowModalOpened == true"></app-sla-contract-workflow-popup>
  </div>