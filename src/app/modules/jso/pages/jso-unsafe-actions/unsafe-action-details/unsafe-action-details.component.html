
<main class="audit-program-details-page mt-3" *ngIf="JsoUnsafeActionStore?.jsoUnsafeActionsDetails_loaded && JsoUnsafeActionStore?.jsoUnsafeActionsDetails">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="widget">

                    <div class="row">
                        <div class="col-lg-8 col-sm-12 padding-right-0">
                            <div class="bg-white widg-padding-cmn">
                                <div class="min-height-64">
                                    <div class="issue-top-sec">
                                        <div class="clearfix">
                                            <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                    class="issue-smoal-head-text">#{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.reference_code}}</span>
                                                    {{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description.length>60 ?
                                                    JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description.substring(0,60)+' ...':JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description}}<span
                                                    class="draft-tag label-tag-style-tag label-left-arow-tag"
                                                    style="line-height: 16px; vertical-align: middle; margin-top: -4px; display: inline-block;">
                                                    {{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_status?.language[0]?.pivot?.title}}</span></h5>
                                        </div>
                                        <!-- <div class="clearfix">
                                            <p class="label-tag-style mb-2"><i
                                                    class="fas fa-calendar-alt date-pics-two"></i>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.created_at
                                                | date: OrganizationGeneralSettingsStore.organizationSettings?.date_format}} {{'to' | translate}}
                                                {{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.corrective_action_target_date | date:
                                                OrganizationGeneralSettingsStore.organizationSettings?.date_format}} </p>
                                        </div> -->
                                        <p style="white-space:pre-line">{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description}}</p>
                                    </div>
                            
                                    <div class="row">
                                        <div class="col-lg-4 col-sm-6">
                                            <h6>{{'category'|translate}}</h6>
                                            <p>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_category?.title}} </p>
                                        </div>
                                        <div class="col-lg-4 col-sm-6">
                                            <h6>{{'sub_category'|translate}}</h6>
                                            <p>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_sub_category?.title}} </p>
                                        </div>
                                        <div class="col-lg-4 col-sm-6">
                                            <h6>{{'group_observed'|translate}} </h6>
                                            <p>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_observed_group?.title}} </p>
                                        </div>
                                        <div class="col-sm-12">
                                            <h6>{{'corrective_action'|translate}}</h6>
                                            <p style="white-space:pre-line">{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.corrective_action}}</p>
                                        </div>
                                        <div class="col-lg-4 col-sm-6">
                                            <h6>{{'target_date'|translate}}</h6>
                                            <p>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.corrective_action_target_date | date: OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</p>
                                        </div>
                                        <div class="col-lg-4 col-sm-6">
                                            <div class="label-and-user-pic">
                                                <h6>{{'responsible_person'|translate}}</h6>
                                                <!-- <div class="row">
                                                    <div class="col-sm-1 animation-pulse"> -->
                                                        <app-user-popup-box [source]="getPopupDetails()" [showName]="true">
                                                        </app-user-popup-box>
                                                    <!-- </div>
                                                </div> -->
                                                <div *ngIf="!JsoUnsafeActionStore.jsoUnsafeActionsDetails?.corrective_action_responsible_user?.id">
                                                    {{AppStore.noContentText}}</div>
                                            </div>
                                        </div>
                                    </div>
                            
                                    <!-- <div class="row">
                                                                <div class="col-sm-12">
                                                                    <hr>
                                                                    <div class="d-flex flex-row user-list-sm">
                                                                        <img src="assets/images/user-gate.jpg" width="30px" height="30px"
                                                                            class="rounded-circle">
                                                                        <div>
                                                                            <h6>Mohammed Shihabudheen</h6>
                                                                            <span>Project Manger | Created on jan 31,2020 11:41:AM</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div> -->
                                    
                                </div>
                                <div class="row">
                                    <div class="col-sm-12">
                                        <hr class="mb-2">
                                            <app-user-popup-box
                                                [source]=" getCreatedByPopupDetails(JsoUnsafeActionStore.jsoUnsafeActionsDetails?.created_by, JsoUnsafeActionStore.jsoUnsafeActionsDetails?.created_at)">
                                            </app-user-popup-box>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-sm-12">
                            <div class="bg-white p-3 mb-3">
                                <div class="bg-main p-3">
                                    <div class="d-flex align-items-center">
                                        <div class="w-100">
                                            <h5 class="mb-0">{{'car_due_date'|translate}} <br>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.corrective_action_target_date | date: OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</h5>
                                        </div>
                                        <div class="text-right" style="width: 106px;" *ngIf="JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_status?.type == 'new'">
                                            <button type="button" class="btn" data-toggle="modal"
                                                (click)="statusChange()"
                                                style="margin-right: 0px !important;">{{'resolve'|translate}}</button>
                                        </div>
                                        <div class="text-right" style="width: 106px;" *ngIf="JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_status?.type == 'resolved'">
                                            <button type="button" class="btn" data-toggle="modal"
                                                (click)="closeStatus()"
                                                style="margin-right: 0px !important;">{{'close_now'|translate}}</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- resolve accordian start-->
                            <div class="panel-group panel-drop-sections panel-drop-white panel-drop-hide-border" id="jd" role="tablist"
                                aria-multiselectable="true" *ngIf="JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_status?.type !='new'">
                                <div class="panel panel-default">
                                    <div [ngClass]="selectedTab == 0 ? 'panel-heading active' : 'panel-heading'"
                                         role="tab" id="headingOne">
                                        <div class="panel-title">
                                            <a role="button" data-toggle="collapse" aria-expanded="false"
                                                aria-controls="collapseOne" class="collapsed" (click)="openAccordian(0)">
                                                <h5 class="width96pc mt-0">{{'resolved_by'|translate}}<span class="drop-down-icone"><i
                                                            class="fas fa-chevron-down"></i></span>
                                                </h5>
                                            </a>
                                        </div>
                                    </div>
                                    <div  [ngClass]="selectedTab == 0 ? 'panel-collapse collapse show' : 'panel-collapse collapse'"
                                        role="tabpanel" aria-labelledby="headingOne" >
                                        <div class="panel-body bg-white">
                                            <div class="approve-detail-box-cnt p-0">
                                                <h5 class="d-inline-block cmn-head-style"><span
                                                    class="issue-smoal-head-text">#{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.reference_code}}</span>
                                                    {{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description.length>40 ?
                                                    JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description.substring(0,40)+' ...':JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description}}</h5>                                         

                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <hr class="mb-2">
                                                    <div class="d-flex flex-row user-list-sm">
                                                        <app-user-popup-box
                                                            [source]=" getCreatedByPopupDetails(JsoUnsafeActionStore.jsoUnsafeActionsDetails?.updated_by, JsoUnsafeActionStore.jsoUnsafeActionsDetails?.updated_at)">
                                                        </app-user-popup-box>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- resolve accordian end-->
                            <!-- close accordian start-->
                            <div class="panel-group panel-drop-sections panel-drop-white panel-drop-hide-border" id="jd" role="tablist"
                                aria-multiselectable="true" *ngIf="JsoUnsafeActionStore.jsoUnsafeActionsDetails?.unsafe_action_status?.type =='closed'">
                                <div class="panel panel-default">
                                    <div [ngClass]="selectedTab == 1 ? 'panel-heading active' : 'panel-heading'"
                                         role="tab" id="headingOne">
                                        <div class="panel-title">
                                            <a role="button" data-toggle="collapse" aria-expanded="false"
                                                aria-controls="collapseOne" class="collapsed" (click)="openAccordian(1)">
                                                <h5 class="width96pc mt-0">{{'closed_by'|translate}}<span class="drop-down-icone"><i
                                                            class="fas fa-chevron-down"></i></span>
                                                </h5>
                                            </a>
                                        </div>
                                    </div>
                                    <div 
                                        [ngClass]="selectedTab == 1 ? 'panel-collapse collapse show' : 'panel-collapse collapse'"
                                        role="tabpanel" aria-labelledby="headingOne" >
                                        <div class="panel-body bg-white">
                                            <div class="approve-detail-box-cnt p-0">
                                                <h5 class="d-inline-block cmn-head-style"><span
                                                    class="issue-smoal-head-text">#{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.reference_code}}</span>
                                                    {{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description.length>40 ?
                                                    JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description.substring(0,40)+' ...':JsoUnsafeActionStore.jsoUnsafeActionsDetails?.description}}</h5>
       
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <hr>
                                                    <h6>{{'closure_date'|translate}}</h6>
                                                    <p>{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.closure_date | date: OrganizationGeneralSettingsStore.organizationSettings?.date_format}}</p>
                                                </div>
                                                <div class="col-sm-12">
                                                    <h6>{{'comments'|translate}}</h6>
                                                    <p style="white-space:pre-wrap">{{JsoUnsafeActionStore.jsoUnsafeActionsDetails?.comments}}</p>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <hr class="mb-2">
                                                    <div class="d-flex flex-row user-list-sm">
                                                        <app-user-popup-box
                                                            [source]=" getCreatedByPopupDetails(JsoUnsafeActionStore.jsoUnsafeActionsDetails?.updated_by, JsoUnsafeActionStore.jsoUnsafeActionsDetails?.updated_at)">
                                                        </app-user-popup-box>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <!-- close accordian end-->
                            
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>
<ng-container *mobxAutorun>
    <div *ngIf="!JsoUnsafeActionStore.jsoUnsafeActionsDetails_loaded">
        <app-unsafe-action-details-loader></app-unsafe-action-details-loader>
    </div>
 </ng-container>
<div class="modal modal-style-1 popup-full-width fade show" data-keyboard="false" data-backdrop="static" #formModal>
    <app-unsafe-action-model *ngIf="formObject.type != null" [source]="formObject">
    </app-unsafe-action-model>
  </div>
  <!------------------- Delete Confirmation Modal Start --------------------------->
  
  <div class="modal modal-style-1 show" id="delete-popup" data-backdrop="static" data-keyboard="false" #deletePopup>
    <app-delete-popup [source]="deleteObject" *ngIf="deleteObject.id != null"></app-delete-popup>
  </div>
  
  <!------------------- Delete Confirmation Modal End --------------------------->

  <!-- for close unsafe action Modal part -->
<div class="modal modal-style-1 popup-full-width show" data-keyboard="false" data-backdrop="static" #closeStatusFormModal>
    <app-close-unsafe-action-modal *ngIf = "closeObject.type" [source]="closeObject">
    </app-close-unsafe-action-modal>
</div>