<nav class="edit-bar" data-toggle="affix" #navigationBar>
    <div class="module-name-block float-left">
        <app-breadcrumb-menu></app-breadcrumb-menu>

    </div>
    <app-sub-menu></app-sub-menu>
</nav>

<main class="mt-3 organization-page">
    <div class="container-fluid">
        <div class="organization-form-page" *mobxAutorun>
            <div [ngStyle] = "{'display':!showForm ? 'none' : 'block'}">
                <form *ngIf = "regForm" [formGroup]="regForm" id="regForm" class="organization-multi-stup-form multi-stup-form-common">

                    <div id="header-sroll-form" class="form-indicates-sec clearfix pointer" #formSteps>
                        <span class="step" (click)="changeStep(0)"><span class="multi-form-nbr">1</span>{{'info'|translate}}</span>
                        <span class="step" (click)="changeStep(1)"><span class="multi-form-nbr">2</span>{{'contact_details'|translate}}</span>
                        <span class="step" (click)="changeStep(2)"><span class="multi-form-nbr">3</span>{{'role'|translate}}</span>
                        <span class="step" (click)="changeStep(3)"><span class="multi-form-nbr">4</span>{{'preview_save'|translate}}</span>
                    </div>
    
                    <div class="tab">
                        <!-- tab start -->
                        <label for="name" class="label-style mb-0">{{'profile_image'|translate}}</label>
                        <div class="row m-0 upload-section" style="padding-top: 0">
                            <div class="col-sm-4 col-lg-3 costmz-logo-new mt-2">
                                <div class="question-circle-inp" *ngIf = "OrganizationGeneralSettingsStore.organizationSettings?.logo_allowed_types.length > 0" style="margin-right: 7px;">
                                    <i class="far fa-question-circle"></i>
                                    <div class="message-password-inp">
                                        <p class="mb-0">{{'allowed_file_types' | translate}} {{OrganizationGeneralSettingsStore.organizationSettings?.logo_allowed_types.toString()}}</p>
                                    </div>
                                 </div>
                                <div class="form-group form-group-upload">
                                    <div class="darag-dropifile-upload">
                                        <div class="d-flex justify-content-center align-items-center text-center">
                                            <div>
                                                <img src="assets/images/drag-pic.png" class="drag-pic-files">
                                                <div class="drag-file-name"> {{'select_upload_your_file_here'|translate}} </div>
                                                <div class="upload-btn-wrapper">
                                                    <input type="file" name="myfile" (change)="onFileChange($event,'logo')"
                                                    [accept]="checkAcceptFileTypes('logo')" />
                                                    <button class="pointer" class="btn">{{'browse_files'|translate}}</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="col-sm-4 col-lg-3 up-pic-cf mt-2" *ngIf="AddUserStore.logo_preview_available">
    
                                <div class="upload-pics edit-option">
                                    <circle-progress class="browse-form-pic" [percent]=fileUploadProgress
                                        [title]=fileUploadProgress></circle-progress>
                                </div>
                            </div>
    
                            <div [ngClass]="AddUserStore.getProductImageDetailsByType('logo')?.is_deleted ? 'col-sm-4 col-lg-3 up-pic-cf mt-2 image_deleted':'col-sm-3 up-pic-cf mt-2'"
                                *ngIf="AddUserStore.getProductImageDetailsByType('logo')">
    
                                <div class="upload-pics edit-option">
                                    <div class="browse-form-pic"
                                        [ngStyle]="{'background': 'url(' + AddUserStore.getProductImageDetailsByType('logo')?.preview +  ') no-repeat 0 0 / cover'}">
                                    </div>
                                    <div class="browse-form-name clearfix">
                                        <div class="float-left">
                                            <h6>{{AddUserStore.getProductImageDetailsByType('logo')?.name.length > 15 ? AddUserStore.getProductImageDetailsByType('logo')?.name.substring(0,15)+' ...': AddUserStore.getProductImageDetailsByType('logo')?.name}}
                                            </h6>
                                            <span>{{AddUserStore.getProductImageDetailsByType('logo')?.size/1048576 | number:'0.2-2'}}MB</span>
                                        </div>
                                        <div class="browse-logo">
                                            <img *ngIf="checkExtension(AddUserStore.getProductImageDetails.ext,'excel') != -1"
                                                src="/assets/images/md-xl.png">
                                            <img *ngIf="checkExtension(AddUserStore.getProductImageDetails.ext,'image') != -1"
                                                src="/assets/images/md-jpg.png">
                                            <img *ngIf="checkExtension(AddUserStore.getProductImageDetails.ext,'doc') != -1"
                                                src="/assets/images/md-doc.png">
                                            <img *ngIf="checkExtension(AddUserStore.getProductImageDetails.ext,'pdf') != -1"
                                                src="/assets/images/md-pdf.png">
                                        </div>
                                    </div>
                                    <div class="edit-option-show">
                                        <a (click)="removeDocument()"><i class="fas fa-trash"></i></a>
                                    </div>
                                </div>
    
                            </div>
    
                        </div>
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
    
                                    <label for="name">{{'first_name'|translate}}<sup>*</sup></label>
                                    <input type="text" formControlName="first_name" class="form-control"
                                        [placeholder]="'enter_first_name'|translate">
                                    <p class="form-error pt-1"
                                        *ngIf="regForm?.value.first_name && regForm?.value.first_name.length > 500 && !formErrors">
                                        {{'maximum_500_characters'|translate}}</p>
                                    <p class="form-error pt-1" *ngIf="formErrors&&formErrors.first_name">
                                        {{formErrors.first_name[0]}}</p>
    
                                </div>
    
    
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="name">{{'last_name'|translate}}<sup>*</sup></label>
                                    <input type="text" formControlName="last_name" class="form-control"
                                        [placeholder]="'enter_last_name'|translate">
                                    <p class="form-error pt-1"
                                        *ngIf="regForm?.value.last_name && regForm?.value.last_name.length>500 && !formErrors">
                                        {{'maximum_500_characters'|translate}</p>
    
                                    <p class="form-error pt-1" *ngIf="formErrors&&formErrors.last_name">
                                        {{formErrors.last_name[0]}}</p>
                                </div>
    
    
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="name">{{'email'|translate}}<sup>*</sup></label>
                                    <input type="text" class="form-control" formControlName="email"
                                        [placeholder]="'user_addform_placeholder_email'|translate">
                                    <p class="form-error pt-1" *ngIf="regForm?.get('email').invalid && regForm.value.email">
                                        {{'enter_valid_email'|translate}}</p>
                                    <p class="form-error pt-1" *ngIf="formErrors&&formErrors.email">
                                        {{formErrors.email[0]}}</p>
                                </div>
    
    
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="name">{{'mobile_number'|translate}}</label>
                                    <input type="text" class="form-control input-number" formControlName="mobile"
                                        [placeholder]="'user_addform_placeholder_mobile_number'|translate">
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.mobile">
                                            {{formErrors.mobile[0]}}</p>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="name">{{'office_number'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="office_number"
                                        [placeholder]="'user_addform_placeholder_office_number'|translate">
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.office_number">
                                            {{formErrors.office_number[0]}}</p>
                                </div>
                            </div>
                            <div class="col-sm-6" *ngIf = "OrganizationLevelSettingsStore.organizationLevelSettings?.is_subsidiary">
                                <div class="form-group">
                                    <label for="name">{{'subsidiary'|translate}}<sup>*</sup></label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
    
                                            <ng-select
                                            [multiple]="false"
                                            [placeholder]="'select_subsidiary' | translate"
                                            searchable = "false"
                                            formControlName = "organization_id"
                                            (search) = "searchSubsidiary($event)"
                                            (change)="setValuesToShow('subsidiary',$event)"
                                            (clear) = "getSubsidiary();getDivision();handleDropDownClear('organization_id')"
                                            (open) = "getSubsidiary()"
                                            (remove) = "handleDropDownClear('organization_id')">
                                            <ng-option
                                           [value]="type.id"
                                            *ngFor="let type of SubsidiaryStore.subsidiaryList">
                                            {{type.title}}
                                        </ng-option>
                                      </ng-select>
                                      <!-- setValuesToShow('subsidiary',type) -->
                                      <!-- <ng-select [placeholder]="'subsidiaries'|translate" [multiple]="false"
                                                        searchable="true" (search)="searchCountry($event)"
                                                        formControlName="country_id" (clear)="getCountry()"
                                                        (open)="getCountry()">
                                                        <ng-option [value]="type.id"
                                                            *ngFor="let type of SubsidiaryStore.subsidiaryList">
                                                            {{type.title}}
                                                        </ng-option>
                                                    </ng-select> -->
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.organization_id">
                                            {{formErrors.organization_id[0]}}</p>
    
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_branch ? 'none':'block'}">
                                <div class="form-group">
                                    <label for="name">{{'branch'|translate}}<sup>*</sup></label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
    
                                            <!-- <ng-select [placeholder]="'select_branch'|translate" [multiple]="false" searchable="true"
                                                formControlName="branch_id" (clear)="getBranch()"
                                                (search)="searchBranch($event)" (open)="getBranch()"
                                                autocomplete="new-password">
                                                <ng-option
                                                    *ngFor="let type of BranchesStore.branchDetails">
                                                    {{type.title}}
                                                </ng-option>
                                            </ng-select> -->
                                            <ng-select
                                            
                                            [placeholder]="'select_branch' | translate"
                                            [closeOnSelect]="true"
                                            searchable = "false"
                                            formControlName = "branch_id"
                                            (change)="setValuesToShow('branch',$event)"
                                            (search) = "searchBranch($event)"
                                            (clear) = "getBranch()"
                                            (open) = "getBranch()">
                                            <ng-option [value]="type.id"
                                            
                                            *ngFor="let type of BranchesStore.branchDetails">
                                            {{type.title}}
                                        </ng-option>
                                      </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.branch_id">
                                            {{formErrors.branch_id[0]}}</p>
    
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_division ? 'none':'block'}">
                                <div class="form-group">
                                    <label for="name">{{'division'|translate}}<sup>*</sup></label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
                                            <ng-select
                                            
                                            [placeholder]="'select_division' | translate"
                                            searchable = "false"
                                            formControlName = "division_id"
                                            (change)="setValuesToShow('division',$event)"
                                            (search) = "searchDivision($event)"
                                            (clear) = "getDivision();handleDropDownClear('division_id')"
                                            (open) = "getDivision()"
                                            (remove) = "handleDropDownClear('division_id')">
                                            <ng-option [value]="type.id"
                                            
                                            *ngFor="let type of DivisionStore.allItems">
                                            {{type.title}}
                                        </ng-option>
                                      </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.division_id">
                                            {{formErrors.division_id}}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_department ? 'none':'block'}">
                                <div class="form-group">
                                    <label for="name">{{'department'|translate}}<sup>*</sup></label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
                                            <ng-select
                                          
                                            [placeholder]="'select_department' | translate"
                                            formControlName = "department_id"
                                            (change)="setValuesToShow('department',$event)"
                                            (search) = "searchDepartment($event)"
                                            (clear) = "getDepartment();handleDropDownClear('department_id')"
                                            (open) = "getDepartment()"
                                            (remove) = "handleDropDownClear('department_id')">
                                            <ng-option [value]="type.id"
                                            
                                            *ngFor="let type of DepartmentStore.allItems">
                                            {{type.title}}
                                        </ng-option>
                                      </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.department_id">
                                            {{formErrors.department_id}}</p>
    
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_section ? 'none':'block'}">
                                <div class="form-group">
                                    <label for="name">{{'section'|translate}}<sup>*</sup></label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
                                            <ng-select
                                          
                                            [placeholder]="'select_section' | translate"
                                            formControlName = "section_id"
                                            (change)="setValuesToShow('section',$event)"
                                            (search) = "searchSection($event)"
                                            (clear) = "getSection();handleDropDownClear('section_id')"
                                            (open) = "getSection()"
                                            (remove) = "handleDropDownClear('section_id')">
                                            <ng-option [value]="type.id"
                                            
                                            *ngFor="let type of SectionStore.allItems">
                                            {{type.title}}
                                        </ng-option>
                                      </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.section_id">
                                            {{formErrors.section_id}}</p>
    
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_sub_section ? 'none':'block'}">
                                <div class="form-group">
                                    <label for="name">{{'sub_section'|translate}}<sup>*</sup></label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
                                            <ng-select
                                           
                                            [placeholder]="'select_sub_section' | translate"
                                            formControlName = "sub_section_id"
                                            (search) = "searchSubSection($event)"
                                            (change)="setValuesToShow('subsection',$event)"
                                            (clear) = "getSubSection();handleDropDownClear('sub_section_id')"
                                            (open) = "getSubSection()"
                                            (remove) = "handleDropDownClear('sub_section_id')">
                                            <ng-option [value]="type.id"
                                            
                                            *ngFor="let type of SubSectionStore.allItems">
                                            {{type.title}}
                                        </ng-option>
                                         </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.sub_section_id">
                                            {{formErrors.sub_section_id}}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" [ngStyle] = "{'pointer-events': AddUserStore.editFlag && UsersStore.individualUser?.designation?.is_super_admin ? 'none' : ''}">
                                <div class="form-group">
                                    <label for="name">{{'designation'|translate}}<sup>*</sup></label>
                                    <div class="clearfix d-flex">
                                        <div class="multiple-plain-ngselect w-100">
                                            <!-- <ng-select [placeholder]="'select_designation'|translate" [multiple]="false" searchable="true"
                                                formControlName="designation_id" (search)="searchDesignation($event)"
                                                (clear)="getDesignation()" (open)="getDesignation()"
                                                autocomplete="new-password">
                                                <ng-option
                                                    *ngFor="let type of DesignationMasterStore.designations;let d=index">
                                                    {{type.title}}
                                                </ng-option>
                                            </ng-select> -->
    
                                            <ng-select
                                            
                                            [placeholder]="'select_designation' | translate"
                                            searchable = "false"
                                            formControlName = "designation_id"
                                            (change)="setValuesToShow('designation',$event)"
                                            (search) = "searchDesignation($event)"
                                            (clear) = "getDesignation()"
                                            (open) = "getDesignation()">
                                            <ng-option [value]="type.id"
                                            
                                            *ngFor="let type of DesignationMasterStore.designations">
                                            {{type.title}}
                                        </ng-option>
                                      </ng-select>
                                            
                                        </div>
                                        <button class="btn multi-add-user ml-2" style="width: 42px;" *ngIf="AuthStore.getActivityPermission(200,'CREATE_DESIGNATION')"
                                            (click)="openFormModal()"><i
                                                class="fas fa-plus"></i></button>
    
                                    </div>
                                    <p class="form-error pt-1" *ngIf="formErrors&&formErrors.designation_id">
                                        {{'designation_required'|translate}}</p>
                                </div>
                            </div>
    
                            
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="name">{{'reporting_user'|translate}}</label>
    
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
                                            <ng-select [items]="UsersStore.usersList" bindLabel="email"
                                                [placeholder]="'select_reporting_user'|translate" formControlName="user_id"
                                                (clear)="getUsers()" (search)="searchUers($event)" (open)="getUsers()"
                                                autocomplete="new-password" [searchFn]="customSearchFn">
                                               
                                                <ng-template ng-label-tmp let-item="item" let-clear="clear">
                                                    <img *ngIf = "item.image_token" class="ng-select-user-display" height="15" width="15" [attr.src]="createImageUrl(item.image_token)" onerror = "this.src='/assets/images/user-demo2.png'"/>
                                                    <img *ngIf = "!item.image_token" class="ng-select-user-display" height="15" width="15" [attr.src]="getDefaultImage('user-logo')" onerror = "this.src='/assets/images/user-demo2.png'"/>
                                                    <b style="padding-left: 3px;">{{getStringsFormatted([item.first_name,item.last_name],50,' ') | titlecase}}</b><span aria-hidden="true" (click) = "clear(item)" style="border:none;" class="ng-value-icon left">×</span>
                                                 </ng-template>
                                                 <ng-template ng-option-tmp let-item="item" let-index="index">
                                                    <div class="user-post-department-pic">
                                                       <img *ngIf = "item.image_token" class="ng-select-user-display" height="25" width="25" [attr.src]="createImageUrl(item.image_token)" onerror = "this.src='/assets/images/user-demo2.png'"/>
                                                       <img *ngIf = "!item.image_token" class="ng-select-user-display" height="25" width="25" [attr.src]="getDefaultImage('user-logo')" onerror = "this.src='/assets/images/user-demo2.png'"/>
                                                    </div>
                                                    <div class="user-post-department-div">
                                                       <b>{{getStringsFormatted([item.first_name,item.last_name],50,' ') | titlecase}}</b>
                                                       <p class="user-post-department-multiple">{{getStringsFormatted([item.designation_title,' '+item.department],50,',')}}</p>
                                                    </div>
                                                 </ng-template>
                                            </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.user_id">
                                            {{formErrors.user_id[0]}}</p>


                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6" *ngIf="!AddUserStore.editFlag">
                                <div class="form-group">
                                    <label for="name">{{'password'|translate}}<sup>*</sup></label>
                                    <div class="password-icon-input">
                                        <input [attr.type]="togglePassword ? 'text' : 'password'" class="form-control"
                                            formControlName="password" [placeholder]="'password'|translate" autocomplete="new-password"
                                            (change)="validatePassword()">
                                        <a class="eye-icon-pswd" (click)="toggleFieldTextType()">
                                            <i [ngClass]="togglePassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i></a>
                                        <div class="question-circle-inp">
                                            <i class="far fa-question-circle"></i>
                                            <div class="message-password-inp">
                                                <p class="mb-0">{{'password_warning'|translate}}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="form-error pt-1"
                                        *ngIf="formErrors&&!AddUserStore.editFlag&&formErrors.password">
                                        {{formErrors.password[0]}}</p>
                                </div>
    
                            </div>
                           
                            <div class="col-sm-6" *ngIf="!AddUserStore.editFlag">
                                <div class="form-group">
                                    <label for="name">{{'confirm_password'|translate}}<sup>*</sup></label>
                                    <input [attr.type]="togglePassword ? 'text' : 'password'" class="form-control" formControlName="password_confirm"
                                        [placeholder]="'confirm_password'|translate" autocomplete="new-password">
                                    <p class="form-error pt-1"
                                        *ngIf="formErrors&&!AddUserStore.editFlag&&formErrors.password_confirm">
                                        {{formErrors.password_confirm[0]}}</p>
                                    <p class="form-error pt-1"
                                        *ngIf="regForm.value.password&&regForm.value.password_confirm&&(regForm.value.password!=regForm.value.password_confirm)">
                                        {{'password_not_matching'|translate}}</p>
                                </div>
    
                            </div>
                            
                            <div class="col-sm-6" 
                            *ngIf="OrganizationGeneralSettingsStore.organizationSettings?.is_user_license_activation == 1">
                                <div class="form-group">
                                                                                 
                                    <div class="custom-control pt-2 custom-radio"
                                        [ngStyle]="{'pointer-events': AclStore?.loaded ? '' : 'none'}">
                                        <input type="radio" class="custom-control-input" id="customRadio3" name="example3" value="customEx" 
                                            (change)="roleTypeCheck($event,'is_active_user')" [checked]="isActiveUser">
                                        <label class="custom-control-label" for="customRadio3" style="padding-top: 2px;"> {{'is_active_user'|translate}}</label>



                                       <span class="pl-5"><input type="radio" class="custom-control-input" id="customRadio4" name="example3" value="customEx"
                                            (change)="roleTypeCheck($event,'is_passive_user')" [checked]="!isActiveUser">
                                        <label class="custom-control-label" for="customRadio4" style="padding-top: 2px;">{{'is_passive_user'|translate}}</label></span>
                                      </div>
                                </div>
                            </div>
                            <div class="col-sm-6" *ngIf="OrganizationGeneralSettingsStore.organizationSettings?.is_user_license_activation == 1 && isActiveUser">
                                <div class="form-group" [ngStyle] = "{'pointer-events': (AddUserStore.editFlag && UsersStore?.individualUser?.user_license) ? 'none' : ''}">
                                    <label for="name">{{'activation_key'|translate}}<sup>*</sup></label>
                                    <input type="text" formControlName="license_key" class="form-control"
                                        placeholder="xxxxx-xxxxx--xxxxx-xxxxx-xxxxx">
                                    <p class="form-error pt-1" *ngIf="formErrors&&formErrors.license_key">
                                        {{formErrors.license_key[0]}}</p>
    
                                </div>
    
    
                            </div>
                            <div class="col-lg-6 col-sm-12">
                                <div class="form-group">
                                    <label for="name">{{'date_of_birth' | translate}}</label>
                                    <!-- (dateSelect)="frequencyChange()" -->
                                    <div class="input-group date-picker">
                                       <input class="form-control cal4 bg-white"
                                           placeholder="yyyy-mm-dd" [readonly]="true" (click)="dobDateInput.toggle()"
                                           id="db" ngbDatepicker #dobDateInput="ngbDatepicker" formControlName="date_of_birth">
                   
                                       <div class="input-group-append">
                                           <button class="btn btn-outline-secondary calendar"
                                               (click)="dobDateInput.toggle()" type="button"><i
                                                   class="fas fa-calendar-alt"></i></button>
                                       </div>
                                   </div>
                                   <p  class="pt-1" style="color: red;" *ngIf="formErrors && formErrors.date_of_birth">{{formErrors.date_of_birth}}</p>
                                  </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label for="name">{{'national_insurance_number'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="national_insurance_number"
                                        [placeholder]="'user_addform_placeholder_national_insurance_number'|translate">
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.national_insurance_number">
                                            {{formErrors.national_insurance_number}}</p>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-12">
                                <div class="form-group">
                                    <label for="name">{{'joining_date' | translate}}</label>
                                    <!-- (dateSelect)="frequencyChange()" -->
                                    <div class="input-group date-picker">
                                       <input [readonly]="true" class="form-control cal4 bg-white"
                                           placeholder="yyyy-mm-dd"  (click)="joingDateInput.toggle()"
                                           id="jd" ngbDatepicker #joingDateInput="ngbDatepicker" formControlName="joining_date">
                   
                                       <div class="input-group-append">
                                           <button class="btn btn-outline-secondary calendar"
                                               (click)="joingDateInput.toggle()" type="button"><i
                                                   class="fas fa-calendar-alt"></i></button>
                                       </div>
                                   </div>
                                   <p  class="pt-1" style="color: red;" *ngIf="formErrors && formErrors.joining_date">{{formErrors.joining_date}}</p>
                                  </div>
                            </div>
                            <div class="col-lg-6 col-sm-12" *ngIf="AddUserStore.editFlag">
                                <div class="form-group">
                                    <label for="name">{{'leaving_date' | translate}}</label>
                                    <div class="input-group date-picker">
                                       <input [readonly]="true" class="form-control cal4 bg-white" 
                                           placeholder="yyyy-mm-dd"
                                           (click)="leavingDateInput.toggle()"
                                           id="ld" ngbDatepicker #leavingDateInput="ngbDatepicker" [minDate]="regForm.value.joining_date" formControlName="leaving_date">
                              
                                       <div class="input-group-append">
                                           <button class="btn btn-outline-secondary calendar"
                                               (click)="leavingDateInput.toggle()" type="button"><i
                                                   class="fas fa-calendar-alt"></i></button>
                                       </div>
                                   </div>
                                   <p  class="pt-1" style="color: red;" *ngIf="formErrors && formErrors.leaving_date">{{formErrors.leaving_date}}</p>
                                           </div>
                            </div>

                        </div>


                        <div class="row">
                            <div class="col-sm-6 mt-2">
                                <div class="form-group">
                                    <div class="Preview-checkbox clearfix">
                                        <label class="container2 float-left pl-4 mb-0 font-normal" style="font-size: 15px; padding-top: 2px; display: inline-block;">
                                            <input type="checkbox" [checked]="regForm.value.is_top_user"
                                                (change)="setTopUser($event)">
                                            <span class="checkmark mt-1"></span> {{'top_user'|translate}}?</label>
                                            <div class="question-circle-inp d-inline-block" style="vertical-align: middle; margin: -15px 0 0 15px; position: relative;">
                                                <i class="far fa-question-circle"></i>
                                                <div class="message-password-inp">
                                                    <p class="mb-0">{{'top_user_description'|translate}}</p>
                                                </div>
                                            </div>
                                    </div>
    
    
                                    <div class="Preview-checkbox clearfix mt-1">
                                        <label class="container2 float-left pl-4 font-normal" style="font-size: 15px; padding-top: 2px; display: inline-block;">
                                            <input type="checkbox" [checked]="regForm.value.is_auditor"
                                                (change)="setAuditor($event)">
                                            <span class="checkmark mt-1"></span> {{'auditor'|translate}}?</label>
                                    </div>
    
                                </div>
    
                            </div>
    
                            <!-- <div class="col-sm-6" *ngIf="regForm.value.is_auditor && (regForm.value.is_auditor == true)">
                                <div class="form-group">
                                    <label for="name">{{'audit_category'|translate}}</label>
                                    <div class="clearfix">
                                        <div class="multiple-plain-ngselect">
                                            <ng-select [placeholder]="'select_audit_categories'|translate" multiple="true"
                                                searchable="true" (search)="searchAuditCategory($event)"
                                                formControlName="audit_category_ids" (clear)="getAuditCategory()"
                                                (open)="getAuditCategory()" autocomplete="new-password">
                                                <ng-option [value]="type.id"
                                                    *ngFor="let type of AuditCategoryMasterStore.allItems">
                                                    {{type.title}}
                                                </ng-option>
                                            </ng-select>
                                        </div>
                                        <p class="form-error pt-1" *ngIf="formErrors&&formErrors.audit_category_ids">
                                            {{formErrors.audit_category_ids}}</p>
    
                                    </div>
                                </div>
                            </div> -->
                        </div>
    
                    </div>
                    <!-- tab end -->
    
                    <div class="tab">
                        <!-- tab start -->
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <h5 class="f-18"> {{'permanent_address'|translate}} </h5>
                                    <hr class="mt-1">
                                </div>
                                <div class="form-group add-kpi-textarea add-user-form-textarea">
                                    <label for="name">{{'address'|translate}}</label>
                                    <textarea formControlName="address" class="form-control" rows="11" id="comment1"
                                        [placeholder]="'user_addform_placeholder_address'|translate"></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="name">{{'street'|translate}}</label>
                                            <input type="text" formControlName="street" class="form-control" [placeholder]="'user_addform_placeholder_street'|translate">
                                        </div>
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="name">{{'state'|translate}}</label>
                                            <input type="text" formControlName="state" class="form-control" [placeholder]="'user_addform_placeholder_state'|translate">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="name">{{'city'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="city" [placeholder]="'user_addform_placeholder_city'|translate">
                                </div>
                                <div class="form-group">
                                    <label for="name">{{'contact'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="contact" [placeholder]="'user_addform_placeholder_contact'|translate">
                                </div>
    
                                <div class="form-group">
                                    <label for="name">{{'personal_email'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="personal_email"
                                        [placeholder]="'user_addform_placeholder_email'|translate">
                                    <p class="form-error pt-1" *ngIf="regForm?.get('personal_email').invalid && regForm.value.personal_email">
                                        {{'enter_valid_email'|translate}}</p>
                                    <p class="form-error pt-1" *ngIf="formErrors&&formErrors.personal_email">
                                        {{formErrors.personal_email[0]}}</p>
                                </div>
    
    
    
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="name">{{'country'|translate}}</label>
                                            <div class="clearfix">
                                                <div class="multiple-plain-ngselect">
                                                    <ng-select [placeholder]="'user_addform_placeholder_country'|translate" [multiple]="false"
                                                        searchable="true" (search)="searchCountry($event)"
                                                        formControlName="country_id" (clear)="getCountry()"
                                                        (change)="setValuesToShow('country',$event)"
                                                        (open)="getCountry()">
                                                        <ng-option [value]="type.id" 
                                                        
    
                                                            *ngFor="let type of CountryMasterStore.allItems">
                                                            {{type.title}}
                                                        </ng-option>
                                                    </ng-select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="name">Country</label>
                                            <input type="text" class="form-control" formControlName="country"
                                                placeholder="Country">
                                        </div>
                                    </div> -->
                                    <div class="col-sm-6">
                                        <div class="form-group">
                                            <label for="name">{{'postal_code'|translate}}</label>
                                            <input type="text" class="form-control" formControlName="zip"
                                                [placeholder]="'user_addform_placeholder_postal_code'|translate">
                                        </div>
                                    </div>
                                </div>
    
    
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <h5 class="f-18"> {{'emergency_address'|translate}} </h5>
                                    <hr class="mt-1">
                                </div>
                                <div class="form-group">
                                    <label for="name">{{'relative_name'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="relative_name"
                                        [placeholder]="'user_addform_placeholder_relative_name'|translate">
                                </div>
                                <div class="form-group">
                                    <label for="name">{{'relationship'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="relationship"
                                        [placeholder]="'user_addform_placeholder_relative_relationship'|translate">
                                </div>
                                <div class="form-group">
                                    <label for="name">{{'mobile'|translate}}</label>
                                    <input type="text" class="form-control" formControlName="relative_mobile"
                                        [placeholder]="'user_addform_placeholder_relative_mobile_number'|translate">
                                    
                                </div>
                                <div class="form-group add-kpi-textarea add-user-form-textarea">
                                    <label for="name">{{'address'|translate}}</label>
                                    <textarea class="form-control" formControlName="relative_address" rows="11"
                                        id="comment2" [placeholder]="'user_addform_placeholder_relative_address'|translate"></textarea>
                                </div>
    
                            </div>
                        </div>
    
                    </div><!-- tab end -->
    
                    <div class="tab">
                        <!-- tab start -->
                        <div class="row" *ngIf="AclStore?.loaded">
    
                            <div class="col-sm-12 app-costomization-page">
                                <p class="form-error pt-1" *ngIf="formErrors&&formErrors.role_ids">
                                    {{'role_required'|translate}}</p>
                                <div class="setting-item" *ngFor="let role of AclStore.aclRoles | paginate: {currentPage:AclStore?.currentPage, itemsPerPage:AclStore?.itemsPerPage,totalItems:AclStore?.totalItems}; let r=index">
                                    <div class="row ">
                                        <div class="col-sm-8 col-8 d-flex align-items-center">
                                            <h4>{{role.title}}</h4>
                                        </div>
                                        <div class="col-sm-4 col-4 d-flex align-items-center justify-content-end">
                                            <label class="switch">
                                                <input type="checkbox" [disabled]="!isActiveUser ? true : false"
                                                    [attr.checked]="roleChecked(role)" (change)="getRoles(role)">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12" *ngIf="(AclStore?.totalItems>AclStore?.itemsPerPage)">
                                <ul class="pagination justify-content-center mt-3">
                                    <pagination-controls [previousLabel]="'previous' | translate"  [nextLabel]="'next' | translate" (pageChange)="rolePageChange($event)" class="my-pagination"></pagination-controls>
                                </ul>
                            </div>
                        </div>
    
                    </div><!-- tab end -->
    
                    <div class="tab">
                        <!-- tab start -->
    
                        <div class="row">
                            <div class="col-sm-12 mbl-preview">
                                <main class="organization-page user-details-page m-0">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-xl-4 col-lg-4 col-md-12 user-side-bar">
                                                <div class="organization-profile-sidebar previw-left-side p-0">
                                                    <div class="profile-img text-center">
                                                        <figure
                                                            *ngIf="!AddUserStore.preview_url||AddUserStore?.getProductImageDetails?.is_deleted"
                                                            class="w-100 d-block"><img width="80"
                                                                src="assets/images/user-demo2.png"
                                                                class="d-block mx-auto img-fluid rounded-circle zoomIn">
                                                        </figure>
                                                        <figure
                                                            *ngIf="AddUserStore.preview_url&&!AddUserStore?.getProductImageDetails?.is_deleted"
                                                            class="w-100 d-block"><img width="80"
                                                                [attr.src]="AddUserStore.preview_url"
                                                                class="d-block mx-auto img-fluid rounded-circle zoomIn">
                                                        </figure>
    
                                                        <div>
                                                            <h5>{{regForm.value.first_name}} {{regForm.value.last_name}}
                                                            </h5>
                                                            <p>{{showData.designation}}</p>
                                                            <small *ngIf="regForm.value.is_auditor">{{'auditor'|translate}}</small>
                                                            <small
                                                                *ngIf="regForm.value.is_auditor && regForm.value.is_top_user">,</small>
                                                            <small *ngIf="regForm.value.is_top_user">{{'top_user'|translate}}</small>
                                                        </div>
                                                        <!-- <div class="user-beginer-block d-flex">
                                                            <div
                                                                class="beginner-icon d-flex align-items-center zoom-animation">
                                                                <i class="fas fa-star"></i> </div>
                                                            <div class="progress  flex-grow-1">
                                                                <div class="progress-bar progress-bar-animation"
                                                                    role="progressbar" aria-valuenow="70" aria-valuemin="0"
                                                                    aria-valuemax="100"
                                                                    [style.max-width.%]="!AddUserStore.editFlag?0:70">
                                                                </div>
                                                            </div>
                                                            <div
                                                                class="master-icon d-flex align-items-center zoom-animation">
                                                                <i class="fas fa-trophy"></i> </div>
                                                        </div> -->
                                                        <!-- <div class="mt-1"> <small class="float-left">{{'beginner'|translate}}</small>
                                                            <small class="float-right">{{'master'|translate}}</small> </div> -->
                                                    </div>
                                                    <div class="clearfix"></div>
                                                    <div class="pt-4 pb-4 preview-mobile">
                                                        <div class="row">
                                                            <div class="col-sm-6" *ngIf = "OrganizationLevelSettingsStore.organizationLevelSettings?.is_subsidiary">
                                                                <h6>{{'subsidiary'|translate}}</h6>
                                                                <p>{{showData.subsidiary?showData.subsidiary:AppStore.noContentText}}
                                                                </p>
                                                            </div>
                                                            <div class="col-sm-6" *ngIf = "OrganizationLevelSettingsStore.organizationLevelSettings?.is_branch">
                                                                <h6>{{'branch'|translate}}</h6>
                                                                <p>{{showData.branch?showData.branch:AppStore.noContentText}}
                                                                </p>
    
                                                            </div>
                                                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_department ? 'none':'block'}">
                                                                <h6>{{'department'|translate}}</h6>
                                                                <p>{{showData.department?showData.department:AppStore.noContentText}}
                                                                </p>
                                                            </div>
                                                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_division ? 'none':'block'}">
                                                                <h6>{{'division'|translate}}</h6>
                                                                <p>{{showData.division?showData.division:AppStore.noContentText}}
                                                                </p>
                                                            </div>
                                                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_section ? 'none':'block'}">
                                                                <h6>{{'section'|translate}}</h6>
                                                                <p>{{showData.section?showData.section:AppStore.noContentText}}
                                                                </p>
                                                            </div>
                                                            <div class="col-sm-6" [ngStyle] = "{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_sub_section ? 'none':'block'}">
                                                                <h6>{{'sub_section'|translate}} </h6>
                                                                <p>{{showData.subsection?showData.subsection:AppStore.noContentText}}
                                                                </p>
                                                            </div>
                                                            <div class="col-sm-12">
                                                                <h6>{{'mobile'|translate}}</h6>
                                                                <p>{{regForm.value.mobile?regForm.value.mobile:AppStore.noContentText}}
                                                                </p>
                                                            </div>
                                                            <div class="col-sm-12">
                                                                <h6>{{'email'|translate}} </h6>
                                                                <p>{{regForm.value.email?regForm.value.email:AppStore.noContentText}}
                                                                </p>
                                                            </div>
    
                                                            <div class="col-sm-12">
                                                                <h6>{{'personal_email'|translate}} </h6>
                                                                <p>{{regForm.value.personal_email?regForm.value.personal_email:AppStore.noContentText}}
                                                                </p>
                                                            </div>
    
    
                                                            <div class="col-sm-12">
                                                                <h6>{{'reporting_user' | translate}}</h6>
                                                               
                                                                  <app-user-popup-box *ngIf="regForm.value.user_id" [source]="getPopupDetails(regForm.value.user_id)" [activateButtons] = "false"></app-user-popup-box>
                                                                  <p *ngIf="!regForm.value.user_id">
                                                                      {{AppStore.noContentText}}
                                                                  </p>
                                                            </div>
                                                            <div class="col-sm-12">
    
                                                                <h6>{{'role'|translate}} </h6>
                                                                <div *ngFor="let role of selected_role">
                                                                    <p>{{role.title?role.title:AppStore.noContentText}}
                                                                    </p>
                                                                </div>
                                                                <div *ngIf="selected_role.length==0">
                                                                    {{AppStore.noContentText}}
                                                                </div>
    
    
                                                            </div>
                                                            <div class="col-sm-12" *ngIf = "OrganizationGeneralSettingsStore.organizationSettings.is_user_license_activation && isActiveUser">
                                                                <h6>{{'activation_key'|translate}} </h6>
                                                                <p>{{regForm.value.license_key ? regForm.value.license_key : AppStore.noContentText}}
                                                                </p>
                                                            </div>
    
                                                            <div class="col-sm-12 mt-4" *ngIf="!AddUserStore.editFlag">
                                                                <div class="Preview-block checkbox-Preview-block">
                                                                    <!-- <div class="Preview-checkbox clearfix">
                                                                        <label class="container2 remember-txt float-left">
                                                                            <input type="checkbox"
                                                                                (change)="setDetail($event)">
                                                                            <span class="checkmark"></span> {{'send_details_to_user'|translate}}</label>
                                                                    </div> -->
                                                                    <div class="Preview-checkbox clearfix">
                                                                        <label
                                                                            class="container2 remember-txt float-left mb-0">
                                                                            <input type="checkbox"
                                                                                (change)="setWelcome($event)">
                                                                            <span class="checkmark"></span> {{'send_welcome_email'|translate}}</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="col-sm-12">
                                                                <div class="Preview-block pt-2">
                                                                    <div class="Preview-checkbox clearfix">
                                                                        <label
                                                                            class="container2 remember-txt float-left mt-2">
                                                                            <input type="checkbox">
                                                                            <span class="checkmark"></span> Send
                                                                            detail to user</label>
                                                                    </div>
                                                                    <div class="Preview-checkbox clearfix">
                                                                        <label
                                                                            class="container2 remember-txt float-left mt-2">
                                                                            <input type="checkbox">
                                                                            <span class="checkmark"></span> Send
                                                                            welcome email</label>
                                                                    </div>
                                                                </div>
                                                            </div> -->
                                                            <div class="clearfix"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-8 col-lg-8 col-md-12 user-right-details">
                                                <div class="tab-content">
                                                    <!-- Profille -->
                                                    <div class="tab-pane active" id="profile">
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <div class="widget bg-white">
                                                                    <!-- Nav tabs -->
                                                                    <!-- Tab panes -->
                                                                    <div
                                                                        class="widget-body-light right-block previw-right-side preview-mobile p-0">
                                                                        <div class="row">
                                                                            <div class="col-sm-12">
                                                                                <h5 class="mt-0"> <span> {{'permanent_address'|translate}}
                                                                                    </span> </h5>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'address'|translate}}</h6>
                                                                                <p>{{regForm.value.address?regForm.value.address:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'state'|translate}}</h6>
                                                                                <p>{{regForm.value.state?regForm.value.state:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'city'|translate}}</h6>
                                                                                <p>{{regForm.value.city?regForm.value.city:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
    
    
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'street'|translate}}</h6>
                                                                                <p>{{regForm.value.street?regForm.value.street:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'postal_code'|translate}}</h6>
                                                                                <p>{{regForm.value.zip?regForm.value.zip:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'country'|translate}}</h6>
                                                                                <p>{{showData.country?showData.country:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'contact'|translate}}</h6>
                                                                                <p>{{regForm.value.contact?regForm.value.contact:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-sm-12">
                                                                                <h5> <span> {{'emergency_address'|translate}} </span>
                                                                                </h5>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-sm-4">
                                                                                <div class="row">
                                                                                    <div class="col-sm-12">
                                                                                        <h6>{{'relative_name'|translate}}</h6>
                                                                                        <p>{{regForm.value.relative_name?regForm.value.relative_name:AppStore.noContentText}}
                                                                                        </p>
    
                                                                                    </div>
                                                                                    <div class="col-sm-12">
                                                                                        <h6>{{'relationship'|translate}} </h6>
                                                                                        <p>{{regForm.value.relationship?regForm.value.relationship:AppStore.noContentText}}
                                                                                        </p>
    
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'address'|translate}}</h6>
                                                                                <p> {{regForm.value.relative_address?regForm.value.relative_address:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                            <div class="col-sm-4">
                                                                                <h6>{{'mobile'|translate}}</h6>
                                                                                <p>{{regForm.value.relative_mobile?regForm.value.relative_mobile:AppStore.noContentText}}
                                                                                </p>
    
                                                                            </div>
                                                                        </div>
    
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
    
                                            </div>
                                        </div>
                                    </div>
                                </main>
                            </div>
                        </div>
    
                    </div><!-- tab end -->
                    <div style="overflow:auto;">
                        <div class="form-next-page-btns pt-0 mt-3" style="float:left;">
                            <button class="btn btn-active" type="button" id="nextBtn" (click)="nextPrev(1)"
                            [disabled]="AppStore.loading || !checkFormObject()">{{getButtonText(nextButtonText)}}</button>
                            <button class="btn" type="button" id="prevBtn" (click)="nextPrev(-1)"
                            [disabled]="AppStore.loading">{{getButtonText(previousButtonText)}}</button>
                            <button class="btn" type="button" (click)="confirmCancel()">{{ AppStore.loading  ? getButtonText('loading') : getButtonText('cancel') }}</button>
                        </div>
                    </div>
    
                </form>
            </div>

            <div [ngStyle] = "{'display':!showForm ? 'block' : 'none'}">
                <app-table-loader></app-table-loader>
             </div>

        </div>

    </div>
</main>


<div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #formModal>
    <app-designation-modal></app-designation-modal>

</div>

<!------------------- Cancel Confirmation Modal Start --------------------------->

<div class="modal modal-style-1 fade" id="delete-popup" #cancelPopup>
    <app-delete-popup [source]="cancelObject"></app-delete-popup>
</div>

<!------------------- Cancel Confirmation Modal End --------------------------->