<nav class="edit-bar" data-toggle="affix">
    <div class="module-name-block module-name-block-space float-left">
        <a class="dropdown module-title">
            {{'internal_audit_dashboard' | translate}}
        </a>
    </div>
    <ul class="nav nav-pills edit-icons float-right d-none d-xl-block" role="tablist">
        <li>
            <button (click)="routeToFindingDetails()" type="button" class="btn btn-small btn-header-db">Finding
                {{'details' | translate}}
            </button>
        </li>
    </ul>
</nav>
<main class="mt-3 acl-page cpf-space-adjust db-small-space-boxes">
    <div class="container-fluid" *ngIf="IADashboardStore.dashboardLoaded">
        <div class="row sm-row">
            <div class="col-sm-12 sm-col">
                <div class="bg-white widg-padding-cmn-small btm-space-10 db-shadow">
                    <div class="row sm-row">
                        <div class="col-lg-6 col-sm-6 sm-col">
                            <h5 class="cmn-head-style m-0 pt-2">  {{'audit_status' | translate}}</h5>
                        </div>
                        <div class="col-lg-6 col-sm-6 sm-col">
                            <div class="small-slect-btn btn-clr-select clearfix">
                                <div class="form-group mb-0 float-right">
                                    <div class="clearfix d-flex">
                                        <div class="plain-select w-100">
                                            <select class="form-control" name="test">
                                                <option value="a1">2021</option>
                                                <option value="a2">2020</option>
                                                <option value="a3">2019</option>
                                            </select>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="row sm-row">
                        <div class="col-lg-6 col-sm-12 sm-col">
                            <div class="dafm-audit-db-one">

                                <div class="audit-satus-db-left d-flex mb-2">
                                    <div class="audit-satus-db-left-inner w-100">
                                        <h6 class="font-weight-700 mb-0 pt-1">Total Number of Audits on Plan (General /
                                            IT /Scrutiny)</h6>
                                    </div>
                                    <div class="audit-satus-db-left-inner text-center border-left-none"
                                        style="width: 80px;">
                                        <h3 class="big-text-one mb-0">09</h3>
                                    </div>
                                </div>
                                <div class="audit-satus-db-left d-flex mb-2">
                                    <div class="audit-satus-db-left-inner w-100">
                                        <h6 class="font-weight-700 mb-0 pt-1">Completed</h6>
                                    </div>
                                    <div class="audit-satus-db-left-inner text-center border-left-none"
                                        style="width: 80px;">
                                        <h3 class="big-text-one mb-0">01</h3>
                                    </div>
                                </div>

                                <div class="audit-satus-db-left d-flex">
                                    <div class="audit-satus-db-left-inner w-100">
                                        <h6 class="font-weight-700 mb-0 pt-1">Awaiting Finalisation</h6>
                                    </div>
                                </div>
                                <div class="audit-satus-db-left d-flex mb-2">
                                    <div class="w-100">
                                        <div class="audit-satus-db-left-inner border-top-none">
                                            <div class="d-flex align-items-center">
                                                <h6 class="font-weight-600 mb-0 pt-1 w-100 pl-3">Management Comment</h6>
                                                <h5 class="cmn-head-style mb-0 text-center" style="width: 100px;">01
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="audit-satus-db-left-inner border-top-none">
                                            <div class="d-flex align-items-center">
                                                <h6 class="font-weight-600 mb-0 pt-1 w-100 pl-3">Draft Report</h6>
                                                <h5 class="cmn-head-style mb-0 text-center" style="width: 100px;">01
                                                </h5>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="audit-satus-db-left-inner text-center border-left-none db-md-screen-center border-top-none"
                                        style="width: 80px;">
                                        <h3 class="big-text-one mb-0">02</h3>
                                    </div>
                                </div>

                                <div class="audit-satus-db-left d-flex">
                                    <div class="audit-satus-db-left-inner w-100">
                                        <h6 class="font-weight-700 mb-0 pt-1">In Progress</h6>
                                    </div>
                                </div>
                                <div class="audit-satus-db-left d-flex mb-2">
                                    <div class="w-100">
                                        <div class="audit-satus-db-left-inner border-top-none">
                                            <div class="d-flex align-items-center">
                                                <h6 class="font-weight-600 mb-0 pt-1 w-100 pl-3">Planning</h6>
                                                <h5 class="cmn-head-style mb-0 text-center" style="width: 100px;">00
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="audit-satus-db-left-inner border-top-none">
                                            <div class="d-flex align-items-center">
                                                <h6 class="font-weight-600 mb-0 pt-1 w-100 pl-3">Field Work / Review
                                                </h6>
                                                <h5 class="cmn-head-style mb-0 text-center" style="width: 100px;">04
                                                </h5>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="audit-satus-db-left-inner text-center border-left-none db-md-screen-center border-top-none"
                                        style="width: 80px;">
                                        <h3 class="big-text-one mb-0">04</h3>
                                    </div>
                                </div>

                                <div class="audit-satus-db-left d-flex">
                                    <div class="audit-satus-db-left-inner w-100">
                                        <h6 class="font-weight-700 mb-0 pt-1">Not started yet</h6>
                                    </div>
                                    <div class="audit-satus-db-left-inner text-center border-left-none"
                                        style="width: 80px;">
                                        <h3 class="big-text-one mb-0">02</h3>
                                    </div>
                                </div>




                            </div>
                        </div>
                        <div class="col-lg-6 col-sm-12 sm-col">
                            <div class="dafm-audit-db-one dafm-audit-db-one-right widg-padding-cmn-small"
                                style="background: rgba(234, 240, 246, 0.14);">
                                <div class="dpt-pic-ceo w-100" style="width: 100%; height: 300px">
                                    <app-no-chart-data [source]="'pie'"></app-no-chart-data>
                                </div>
                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </div>


        <div class="row sm-row">
            <div class="col-lg-5 col-sm-12 sm-col">
                <div class="bg-white btm-space-10 db-shadow pt-4 pb-4">
                    <div class="row align-items-center">
                        <div class="col-md-4 border-right">
                            <div class="text-center">
                                <h3 class="big-text-four">{{open_count?.count+close_count?.count}}</h3>
                                <h5 class="mb-0">{{'total_findings' | translate}}</h5>
                            </div>
                        </div>
                        <div class="col-md-8 text-center">
                            <div class="clearfix round-type-status-main-bg">
                                <div class="round-type-status-main">
                                    <div class="open-close-status-db d-flex align-items-center status-open">
                                        <div class="round-type-status-value">
                                            <h6 class="mb-0">{{open_count?.percentage}}%</h6>
                                        </div>
                                        <div class="round-type-status-bg rounded-circle">
                                            <div class="round-type-status rounded-circle">
                                                <h5>{{'open' | translate}}</h5>
                                                <h6 class="mb-0">{{open_count?.count}}</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="round-type-status-main">
                                    <div
                                        class="open-close-status-db open-close-status-db-right d-flex align-items-center status-closed">
                                        <div class="round-type-status-bg rounded-circle">
                                            <div class="round-type-status rounded-circle">
                                                <h5>{{'closed' | translate}}</h5>
                                                <h6 class="mb-0">{{close_count?.count}}</h6>
                                            </div>
                                        </div>
                                        <div class="round-type-status-value">
                                            <h6 class="mb-0">{{close_count?.percentage}}%</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white widg-padding-cmn btm-space-10 db-shadow" style="min-height: 478px;">
                    <h5 class="cmn-head-style m-0">Finding By Rating Zone / Rating wise</h5>
                    <hr>
                    <div class="row sm-row ia-db-finding-sec">
                        <div class="col-lg-3 col-sm-4 sm-col">
                            <ng-container *ngFor="let row of IADashboardStore.RiskRatingFindings">
                                <div class="pt-2 pb-3">
                                    <h3 class="big-text-one">{{row.findings.count}}</h3>
                                    <p class="dot-div-new dot-normal-violet mb-0 span-dot-color">
                                        <span [ngStyle]="{'background':row.color_code}"></span>{{row.title}}
                                    </p>
                                </div>
                            </ng-container>
                        </div>
                        <div class="col-lg-9 col-sm-8 sm-col">
                            <div class="dpt-pic-ceo w-100" style="width: 100%; height: 370px"
                                *ngIf="IADashboardStore.RiskRatingFindings.length==0">
                                <app-no-chart-data [source]="'pie'"></app-no-chart-data>
                            </div>
                            <div class="dpt-pic-ceo w-100" style="width: 100%; height: 370px"
                                *ngIf="IADashboardStore.RiskRatingFindings.length!=0">
                                <div id="RiskRatingFindingsDiv" style="height: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-lg-7 col-sm-12 sm-col">
                <div class="bg-white widg-padding-cmn btm-space-10 db-shadow">
                    <h5 class="cmn-head-style m-0">{{'closed' | translate}}</h5>
                    <hr>

                    <div class="slider-db-top-ten-sec ia-db-slider-height" style="min-height: 506px;">
                        <owl-carousel-o [options]="clientOptions">

                            <ng-container *ngIf="IADashboardStore.Top10First?.length!=0">
                                <ng-template carouselSlide>
                                    <div class="bg-white btm-space-10 widg-padding-cmn-small cmn-bdr db-box-link-sec"
                                        *ngFor="let row of IADashboardStore.Top10First; let num=index">
                                        <div
                                            [ngClass]="AuthStore.getActivityPermission(100,'PROCESS_DETAILS') ? 'd-flex align-items-center pointer' : 'd-flex align-items-center'">
                                            <h3 class="mb-0 big-text-two text-black font-weight-600">{{num+1}}</h3>
                                            <div class="w-100 ml-3">
                                                <p class="mb-0 text-black font-weight-600 elips">{{row.title}}
                                                    ({{row.reference_code}})</p>
                                            </div>
                                            <div class="top-ten-right-left-line-type-text" style="width: 220px;">
                                                <div class="left-line-type-text-main d-inline-block">
                                                    <div class="ml-2 left-line-type-text">
                                                        <span
                                                            [attr.class]="'dot-div-new mb-3 dot-'+row.risk_rating_label"></span>
                                                        <h5 class="mb-0 text-black">{{row?.risk_ratings}}</h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </ng-template>
                            </ng-container>
                            <ng-container *ngIf="IADashboardStore.Top10First?.length!=0">
                                <ng-template *ngIf="IADashboardStore.totalItems>5" carouselSlide>
                                    <div class="bg-white btm-space-10 widg-padding-cmn-small cmn-bdr db-box-link-sec"
                                        *ngFor="let row of IADashboardStore.Top10Second; let num=index">
                                        <div class="d-flex align-items-center">
                                            <h3 class="mb-0 big-text-two text-black font-weight-600">{{num+6}}</h3>
                                            <div class="w-100 ml-3">
                                                <p class="mb-0 text-black font-weight-600 elips">{{row.title}}
                                                    ({{row.reference_code}})</p>
                                            </div>

                                            <!-- <div class="top-ten-right-left-line-type-text" style="width: 220px;">
                                                <div class="left-line-type-text-main d-inline-block">
                                                    <div class="left-line-type-text">
                                                        <span class="big-line-bdr-left" [ngStyle]="{'background':risk.color_code}"></span>
                                                        <h5>{{risk.risk_rating}}</h5>
                                                        <h6>{{risk.risk_score}}</h6>
                                                    </div>
                                                </div>
                                            </div> -->
                                            <div class="top-ten-right-left-line-type-text" style="width: 220px;">
                                                <div class="left-line-type-text-main d-inline-block">
                                                    <div class="ml-2 left-line-type-text">
                                                        <span
                                                            [attr.class]="'dot-div-new mb-3 dot-'+row.risk_rating_label"></span>
                                                        <h5 class="mb-0 text-black">{{row?.risk_ratings}}</h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </ng-template>
                            </ng-container>

                        </owl-carousel-o>
                    </div>
                    <ng-container *ngIf="IADashboardStore.Top10First?.length==0">
                        <div class="no-policy-demo-text bg-white d-flex align-items-center w-100 mt-2 p-3"
                            style="min-height: 505px;">
                            <div class="no-policy-demo">
                                <img class="pointer"
                                    [attr.src]="ThemeStructureSettingStore.themeStructureObject.empty_screen ? ThemeStructureSettingStore.themeStructureObject.empty_screen : '/assets/images/empty_screen.png'"
                                    onerror="this.src='assets/images/empty_screen.png'" style="width:200px" />
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>


        <div class="row sm-row">
            <div class="col-lg-5 col-sm-12 sm-col">
                <div class="bg-white widg-padding-cmn btm-space-10 db-shadow">
                    <h5 class="cmn-head-style m-0">{{'finding_by_division' | translate}}</h5>
                    <hr>
                    <div class="text-center ia-db-finding-division db-md-screen-center finding-sec-height-ia-db">
                        <div class="dpt-pic-ceo w-100" style="width: 100%; height: 370px"
                            *ngIf="IADashboardStore.DivisionFindings.length==0">
                            <app-no-chart-data [source]="'pie'"></app-no-chart-data>
                        </div>
                        <div class="dpt-pic-ceo w-100" *ngIf="IADashboardStore.DivisionFindings.length!=0">
                            <div id="DivisionFindingsDiv" style="width: 100%; height: 370px"></div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="col-lg-7 col-sm-12 sm-col">
                <div class="bg-white widg-padding-cmn btm-space-10 db-shadow">
                    <h5 class="cmn-head-style m-0">{{'finding_by_department' | translate}}</h5>
                    <hr>
                    <div class="text-center ia-db-finding-department db-md-screen-center finding-sec-height-ia-db">
                        <div class="dpt-pic-ceo w-100" style="width: 100%; height: 370px" *ngIf="showNoDataBarChart">
                            <app-no-chart-data [source]="'bar'"></app-no-chart-data>
                        </div>
                        <div class="dpt-pic-ceo w-100" *ngIf="!showNoDataBarChart">
                            <div id="DepartmentFindingsBarChartDiv" style="width: 100%; height: 370px"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row sm-row">
            <div class="col-lg-5 col-sm-12 sm-col">
                <div class="bg-white btm-space-10 db-shadow">
                    <div class="row align-items-center db-ia-box-hight-four">
                        <div class="col-md-4 border-right">
                            <div class="text-center">
                                <h3 class="big-text-four">{{IADashboardStore?.CorrectiveActionOpenCloseCount?.total}}
                                </h3>
                                <h5 class="mb-0">{{'action_plan' | translate}}</h5>
                            </div>
                        </div>
                        <div class="col-md-8 text-center">
                            <div class="clearfix round-type-status-main-bg">
                                <div class="round-type-status-main">
                                    <div class="open-close-status-db d-flex align-items-center status-open">
                                        <div class="round-type-status-value">
                                            <h6 class="mb-0">
                                                {{IADashboardStore?.CorrectiveActionOpenCloseCount?.open?.percentage}}%
                                            </h6>
                                        </div>
                                        <div class="round-type-status-bg rounded-circle">
                                            <div class="round-type-status rounded-circle">
                                                <h5>{{'open' | translate}}</h5>
                                                <h6 class="mb-0">
                                                    {{IADashboardStore?.CorrectiveActionOpenCloseCount?.open?.count}}
                                                </h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="round-type-status-main">
                                    <div
                                        class="open-close-status-db open-close-status-db-right d-flex align-items-center status-closed">
                                        <div class="round-type-status-bg rounded-circle">
                                            <div class="round-type-status rounded-circle">
                                                <h5>{{'closed' | translate}}</h5>
                                                <h6 class="mb-0">
                                                    {{IADashboardStore?.CorrectiveActionOpenCloseCount?.closed?.count}}
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="round-type-status-value">
                                            <h6 class="mb-0">
                                                {{IADashboardStore?.CorrectiveActionOpenCloseCount?.closed?.percentage}}%
                                            </h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-7 col-sm-12 sm-col">
                <div class="row sm-row">
                    <div class="col-lg-4 col-sm-4 col-6 sm-col">
                        <div class="bg-white btm-space-10 db-shadow db-md-screen-center db-ia-box-hight-four">
                            <div>
                                <h3 class="big-text-one">23</h3>
                                <p class="dot-div-new dot-green mb-0">{{'resolved' | translate}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-4 col-6 sm-col">
                        <div class="bg-white btm-space-10 db-shadow db-md-screen-center db-ia-box-hight-four">
                            <div>
                                <h3 class="big-text-one">02</h3>
                                <p class="dot-div-new dot-dark-red mb-0">{{'overdue' | translate}}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-4 col-12 sm-col">
                        <div class="bg-white btm-space-10 db-shadow db-md-screen-center db-ia-box-hight-four">
                            <div class="text-center">
                                <h3 class="big-text-three">96%</h3>
                                <p class="mb-0">{{'solved' | translate}}</p>
                            </div>
                            <span class="top-arow-db ml-2 text-dark-green"><i
                                    class="fas fa-long-arrow-alt-up"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row sm-row">
            <div class="col-lg-12 col-sm-12 sm-col">
                <div class="bg-white widg-padding-cmn btm-space-10 db-shadow">
                    <h5 class="cmn-head-style m-0">Overdue Action Plans</h5>
                    <hr>

                    <div class="row sm-row">
                        <div class="col-xl-12 col-lg-12 col-sm-12 sm-col">

                            <div class="no-fixed-table">
                                <div class="fix-table">

                                    <table class="table table-bordered ordinary-table cmn-table-style mb-0">
                                        <tbody>
                                            <tr>
                                                <th class="border-top-0 text-center" width="4%">#</th>
                                                <th class="border-top-0" width="15%">Audit Finding ID</th>
                                                <th class="border-top-0" width="28%">Corrective Action</th>
                                                <th class="border-top-0" width="25%">Responsible Person</th>
                                                <th class="border-top-0" width="16%">Date</th>
                                                <th class="border-top-0 text-center" width="12%">Status</th>
                                            </tr>
                                            <tr
                                                *ngFor="let row of IADashboardStore.OverdueActionPlans| paginate: {currentPage:IADashboardStore.currentPageForOverdue, itemsPerPage:IADashboardStore.itemsPerPageForOverdue,totalItems:IADashboardStore.totalItemsForOverdue};let num=index ">
                                                <td class="text-center">{{(IADashboardStore?.currentPageForOverdue - 1) * IADashboardStore?.itemsPerPageForOverdue + (num + 1)}}</td>
                                                <td>#{{row.reference_code}}</td>
                                                <td>{{row.title}}</td>
                                                <td class="cursor-pointer">

                                                    <div class="d-flex flex-row user-list-sm">
                                                        <img *ngIf="row.responsible_user.image_token"
                                                            [attr.src]="createImagePreview('user-profile-picture',row.responsible_user.image_token)"
                                                            width="30px" height="30px" class="rounded-circle"
                                                            onerror="this.src='/assets/images/user-demo2.png'">
                                                        <img *ngIf="!row.responsible_user.image_token"
                                                            [attr.src]="getDefaultImage('user-logo')" width="30px"
                                                            height="30px" class="rounded-circle"
                                                            onerror="this.src='/assets/images/user-demo2.png'">
                                                        <div>
                                                            <h6
                                                                title="{{row.responsible_user.first_name+row.responsible_user.last_name }}">
                                                                {{row?.responsible_user.first_name?.length > 20 ?
                                                                row.responsible_user.first_name?.substring(0,10)+' ...'
                                                                : row.responsible_user.first_name
                                                                }}&nbsp;{{row.responsible_user.last_name?.length > 20 ?
                                                                row.responsible_user.last_name?.substring(0,10)+' ...' :
                                                                row.responsible_user.last_name}}
                                                            </h6>
                                                            <span _ngcontent-nws-c590=""
                                                                wfd-id="801">{{row.responsible_user.designation.title}}</span>

                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="cursor-pointer">
                                                    {{row.target_date | date:
                                                    OrganizationGeneralSettingsStore.organizationSettings?.date_format}}
                                                </td>
                                                <td class="text-center">
                                                    <div [ngClass]="'dot-div '+ row.corrective_action_status.label">
                                                        {{row.corrective_action_status.title}}</div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div *ngIf="IADashboardStore.totalItemsForOverdue>IADashboardStore.itemsPerPageForOverdue"
                                        class="col-sm-12">
                                        <ul class="pagination justify-content-center mt-3">
                                            <div class="list">
                                                <pagination-controls (pageChange)="getOverdueActionPlan($event)"
                                                    class="my-pagination">
                                                </pagination-controls>
                                            </div>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</main>