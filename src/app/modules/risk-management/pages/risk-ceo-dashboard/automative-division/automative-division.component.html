
<nav class="edit-bar" data-toggle="affix" scrollPoint #navigationBar *mobxAutorun>
   <app-breadcrumb-menu></app-breadcrumb-menu>
   <div class="module-name-block module-name-block-space float-left">
      <a class="dropdown module-title">{{CeoRiskDashboardStore.selected_division_title}}</a>
    </div>
    <app-sub-menu></app-sub-menu>
 </nav>
<main class="mt-3 acl-page db-small-space-boxes">
   <div class="container-fluid">
     <div class="widget" *ngIf="CeoRiskDashboardStore.dashboardLoaded">

        <!-- <div class="ceo-db-top" data-toggle="affix">
           <div class="box-cnt-one tab-type-btn-small breadcrumb-db-top clearfix">
              <h6 class="mb-0">{{CeoRiskDashboardStore.selected_division_title}}</h6>
              <div style="float: right;">
               <span class="mr-1" *ngIf="RightSidebarLayoutStore.isFilterSelected('is_functional', 1) && !RightSidebarLayoutStore.isFilterSelected('is_corporate', 1)
               || !RightSidebarLayoutStore.isFilterSelected('is_functional', 1) && !RightSidebarLayoutStore.isFilterSelected('is_corporate', 1)" 
               style="font-size: 13px;color: #0088ff;">{{ 'is_functional' | translate}}<a [routerLink]="['/risk-management/ceo-dashboard']" class="breadcrumb-db-back-page ml-3"><i
                  class="fas fa-arrow-left"></i>{{ 'back_to_dashboard' | translate}}</a></span>

               <span class="mr-1" *ngIf="RightSidebarLayoutStore.isFilterSelected('is_corporate', 1)" 
               style="font-size: 13px;color: #0088ff;">{{ 'is_corporate' | translate}}<a [routerLink]="['/risk-management/ceo-dashboard']" class="breadcrumb-db-back-page ml-3"><i
                  class="fas fa-arrow-left"></i>{{ 'back_to_dashboard' | translate}}</a></span>
            </div>
           </div>
           
        </div> -->

        

        

        <div class="row sm-row">
           <div class="col-xl-5 col-lg-12 col-sm-12 sm-col">
              <div class="bg-white btm-space-10 ceo-db-first-box-one db-shadow">
                 <div class="row align-items-center">
                    <div class="col-md-4 border-right">
                       <div class="text-center pointer" 
                       (click)="redirectToRiskPage('all',CeoRiskDashboardStore?.riskCount?.total_risk)">
                       <h3 class="big-text-four">{{CeoRiskDashboardStore?.riskCount?.total_risk}}</h3>
                          <h5 class="mb-0">{{ 'risk' | translate}}</h5>
                       </div>
                    </div>
                    <div class="col-md-8 text-center">
                       <div class="clearfix round-type-status-main-bg">
                          <div class="round-type-status-main">
                             <div class="open-close-status-db d-flex align-items-center status-open">
                                <div class="round-type-status-value bg-white">
                                   <h6 class="mb-0">{{CeoRiskDashboardStore?.riskCount?.open_percentage}}%</h6>
                                </div>
                                <div [ngClass]="CeoRiskDashboardStore?.riskCount?.open!=0?'round-type-status-bg bg-white rounded-circle pointer':'round-type-status-bg bg-white rounded-circle'" 
                                (click)="redirectToRiskPage('open',CeoRiskDashboardStore?.riskCount?.open)">
                                   <div class="round-type-status rounded-circle">
                                      <h6 class="mb-0">{{CeoRiskDashboardStore?.riskCount?.open}}</h6>
                                      <h5>{{ 'open' | translate}}</h5>
                                   </div>
                                </div>
                             </div>
                          </div>
                          <div class="round-type-status-main">
                             <div class="open-close-status-db open-close-status-db-right d-flex align-items-center status-closed">
                                <div [ngClass]="CeoRiskDashboardStore?.riskCount?.close!=0?'round-type-status-bg bg-white rounded-circle pointer':'round-type-status-bg bg-white rounded-circle'" 
                                (click)="redirectToRiskPage('closed',CeoRiskDashboardStore?.riskCount?.close)">
                                   <div class="round-type-status rounded-circle">
                                      <h6 class="mb-0">{{CeoRiskDashboardStore?.riskCount?.close}}</h6>
                                      <h5>{{ 'closed' | translate }}</h5>
                                   </div>
                                </div>
                                <div class="round-type-status-value bg-white">
                                   <h6 class="mb-0">{{CeoRiskDashboardStore?.riskCount?.close_percentage}}%</h6>
                                </div>
                             </div>
                          </div>
                       </div>
                    </div>   
                 </div> 
              </div>
           </div>
           <div class="col-xl-7 col-lg-12 col-sm-12 sm-col">
              <div class="clearfix">
                 <div [ngClass]="extreme_count!=0?'bg-white btm-space-10 ceo-db-small-box-one db-shadow pointer':'bg-white btm-space-10 ceo-db-small-box-one db-shadow'"
                  (click)="redirectRiskRateList(extreme_title,extreme_count)">
                    <div class="left-line-type-text">
                       <!-- <span class="big-line-bdr-left bg-red"></span>
                       <h5>{{extreme_title}}</h5>
                       <h6>{{extreme_count}}</h6> -->
                       <h3 class="big-text-one mb-0">{{extreme_count}}</h3>
                       <p class="dot-div-new mb-0 dot-red">{{extreme_title}}</p>
                    </div>
                 </div>
                 <div [ngClass]="significant_count!=0?'bg-white btm-space-10 ceo-db-small-box-one db-shadow pointer':'bg-white btm-space-10 ceo-db-small-box-one db-shadow'"
                  (click)="redirectRiskRateList(significant_title,significant_count)">
                    <div class="left-line-type-text">
                       <!-- <span class="big-line-bdr-left bg-orange"></span>
                       <h5>{{significant_title}}</h5>
                       <h6>{{significant_count}}</h6> -->
                       <h3 class="big-text-one mb-0">{{significant_count}}</h3>
                       <p class="dot-div-new mb-0 dot-orange">{{significant_title}}</p>
                    </div>
                 </div>
                 <div [ngClass]="high_count!=0?'bg-white btm-space-10 ceo-db-small-box-one db-shadow pointer':'bg-white btm-space-10 ceo-db-small-box-one db-shadow'"
                  (click)="redirectRiskRateList(high_title,high_count)">
                    <div class="left-line-type-text">
                       <!-- <span class="big-line-bdr-left bg-yellow"></span>
                       <h5>{{high_title}}</h5>
                       <h6>{{high_count}}</h6> -->
                       <h3 class="big-text-one mb-0">{{high_count}}</h3>
                       <p class="dot-div-new mb-0 dot-yellow">{{high_title}}</p>
                    </div>
                 </div>
                 <div [ngClass]="moderate_count!=0?'bg-white btm-space-10 ceo-db-small-box-one db-shadow pointer':'bg-white btm-space-10 ceo-db-small-box-one db-shadow'"
                  (click)="redirectRiskRateList(moderate_title,moderate_count)">
                    <div class="left-line-type-text">
                       <!-- <span class="big-line-bdr-left bg-light-green"></span>
                       <h5>{{moderate_title}}</h5>
                       <h6>{{moderate_count}}</h6> -->
                       <h3 class="big-text-one mb-0">{{moderate_count}}</h3>
                       <p class="dot-div-new mb-0 dot-light-green">{{moderate_title}}</p>
                    </div>
                 </div>
                 <div [ngClass]="low_count!=0?'bg-white btm-space-10 ceo-db-small-box-one db-shadow ceo-db-full-width-box pointer':'bg-white btm-space-10 ceo-db-small-box-one db-shadow ceo-db-full-width-box'"
                 (click)="redirectRiskRateList(low_title,low_count)">
                    <div class="left-line-type-text">
                       <!-- <span class="big-line-bdr-left bg-green"></span>
                       <h5>{{low_title}}</h5>
                       <h6>{{low_count}}</h6> -->
                       <h3 class="big-text-one mb-0">{{low_count}}</h3>
                       <p class="dot-div-new mb-0 dot-green">{{low_title}}</p>
                    </div>
                 </div>
              </div>
           </div>
        </div>

        <div class="row sm-row">
         <div class="col-lg-7 col-sm-12 sm-col">
            <div class="bg-white widg-padding-cmn btm-space-10 db-shadow">
               <h5 class="cmn-head-style m-0">{{ 'top_open_risks' | translate}}</h5>
               <hr>

               <div class="slider-db-top-ten-sec ia-db-slider-height">
                   <!-- <div id="owl-demo-2" class="owl-carousel owl-theme"> -->
                       <!-- <div class="item"> -->
                        <owl-carousel-o [options]="clientOptions" *ngIf="CeoRiskDashboardStore?.riskList?.length!=0"> 
                                 
                           <ng-container>
                         <ng-template carouselSlide>
                           <div class="bg-white btm-space-10 widg-padding-cmn-small cmn-bdr db-box-link-sec mr-1"
                           *ngFor="let risk of CeoRiskDashboardStore?.riskList;let num=index" [routerLink]="['/risk-management/risks/'+risk.id]">
                               <div class="d-flex align-items-center">
                                   <h3 class="mb-0 big-text-two text-black font-weight-600">{{num+1}}</h3>
                                   <div class="w-100 ml-3">
                                       <p class="mb-0 text-black font-weight-600 elips">{{risk.title}}</p>
                                   </div>
                                   <div class="ml-2" style="width: 100px;">
                                       <p [attr.class]="'dot-div-new mb-0 dot-'+risk.label">{{risk.risk_score}}</p>
                                       <p class="mb-0 text-black">{{risk.risk_rating}}</p>
                                   </div>
                               </div>
                           </div>
                        </ng-template>
                     </ng-container>
                     <ng-container *ngIf="CeoRiskDashboardStore?.secondRiskList?.length!=0">
                        <ng-template carouselSlide>  

                       <!-- </div>
                       <div class="item"> -->
                           <div class="bg-white btm-space-10 widg-padding-cmn-small cmn-bdr db-box-link-sec mr-1"
                           *ngFor="let risk of CeoRiskDashboardStore?.secondRiskList;let num=index" [routerLink]="['/risk-management/risks/'+risk.id]">
                               <div class="d-flex align-items-center">
                                   <h3 class="mb-0 big-text-two text-black font-weight-600">{{num+6}}</h3>
                                   <div class="w-100 ml-3">
                                       <p class="mb-0 text-black font-weight-600 elips">{{risk.title}}</p>
                                   </div>
                                   <div class="ml-2" style="width: 100px;">
                                    <p [attr.class]="'dot-div-new mb-0 dot-'+risk.label">{{risk.risk_score}}</p>
                                    <p class="mb-0 text-black">{{risk.risk_rating}}</p>
                                </div>
                               </div>
                           </div>
                        </ng-template>
                     </ng-container>
                   
             </owl-carousel-o>
             <ng-container>
                <!-- <div class="db-md-screen-center" style="min-height: 440px;"> -->
                  <app-no-data-list *ngIf="CeoRiskDashboardStore.riskList.length==0"  [border]="false"  [source]="emptyMessage">
                  </app-no-data-list>
                <!-- </div> -->
               
            </ng-container>
                       <!-- </div> -->
                   <!-- </div> -->
               </div>

           </div>


            
         </div>
           <!-- <div class="col-lg-7 col-sm-12 sm-col">
              <div class="bg-white widg-padding-cmn btm-space-10 ceo-db-aut-three db-shadow">
                 <h5 class="cmn-head-style m-0">{{ 'top_open_risks' | translate}}</h5>
                 <hr>

                 <div class="">
                    <div >
                        <div class="item" style="height: 270px;">
                           <owl-carousel-o [options]="clientOptions" *ngIf="CeoRiskDashboardStore?.riskList?.length!=0">
                              <ng-container>
                                  <ng-template carouselSlide >
                                      <div class="top-ten-risk-db-main" >
                                          <div class="top-ten-risk-db top-ten-risk-db-small pointer" *ngFor="let risk of CeoRiskDashboardStore?.riskList;let num=index" [routerLink]="['/risk-management/risks/'+risk.id]">
                                              <div class="d-flex align-items-center pointer">
                                                  <h4>{{num+1}}</h4>
                                                  <div class="middle-text-sec-risk-db w-100">
                                                      <p>{{risk?.title}}</p>
                                                  </div>
                                                  <div class="top-ten-right-left-line-type-text" style="width: 150px;">
                                                      <div class="left-line-type-text-main d-inline-block">
                                                          <div class="left-line-type-text">
                                                              <span class="big-line-bdr-left" [ngStyle]="{'background':risk.color_code}"></span>
                                                              <h5>{{risk.risk_rating}}</h5>
                                                              <h6>{{risk.risk_score}}</h6>
                                                          </div>
                                                      </div>
                                                  </div>
                                              </div>
                                          </div>
                                      </div>
                                  </ng-template>
                              </ng-container>
                              <ng-container *ngIf="CeoRiskDashboardStore?.secondRiskList?.length!=0">
                                 <ng-template carouselSlide >
                                     <div class="top-ten-risk-db-main" >
                                         <div class="top-ten-risk-db top-ten-risk-db-small pointer" *ngFor="let risk of CeoRiskDashboardStore?.secondRiskList;let num=index" [routerLink]="['/risk-management/risks/'+risk.id]">
                                             <div class="d-flex align-items-center pointer">
                                                 <h4>{{num+6}}</h4>
                                                 <div class="middle-text-sec-risk-db w-100">
                                                     <p>{{risk?.title}}</p>
                                                 </div>
                                                 <div class="top-ten-right-left-line-type-text" style="width: 150px;">
                                                     <div class="left-line-type-text-main d-inline-block">
                                                         <div class="left-line-type-text">
                                                             <span class="big-line-bdr-left" [ngStyle]="{'background':risk.color_code}"></span>
                                                             <h5>{{risk.risk_rating}}</h5>
                                                             <h6>{{risk.risk_score}}</h6>
                                                         </div>
                                                     </div>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                 </ng-template>
                             </ng-container>
                          </owl-carousel-o>
                          <ng-container>
                           <app-no-data *ngIf="CeoRiskDashboardStore.riskList.length==0">
                           </app-no-data>
                        </ng-container>
                        </div>
                     </div>
                  </div>




              </div>
           </div> -->
           <div class="col-lg-5 col-sm-12 sm-col">
              <div class="bg-white widg-padding-cmn btm-space-10 ceo-db-aut-four db-shadow">
                 <h5 class="cmn-head-style m-0">{{ 'department_wise_risk' | translate}} </h5>
                 <hr>

                 <div [ngClass]="CeoRiskDashboardStore.riskCountByDepartments.length==0 ? 'min-height-550 db-md-screen-center'  :'ceo-dashbord-department-height db-md-screen-center'">
                  <div class="chart-new-round-pic text-right" *ngIf="CeoRiskDashboardStore.riskCountByDepartments.length!=0">
                      <div id="chartdiv" style="width: 100%; height: 270px"></div>
                  </div>
                  <div class="chart-new-round-pic text-right" style="width: 100%; height: 270px" *ngIf="CeoRiskDashboardStore.riskCountByDepartments.length==0">
                     <app-no-chart-data [source]="'pie'">
                     </app-no-chart-data>
                 </div>
              </div>

              </div>
           </div>
        </div>

       

        


        <div class="row sm-row">
           <div class="col-sm-12 sm-col">
              <div class="bg-white widg-padding-cmn btm-space-10 db-shadow">
                 <div class="row widget-heading line-tab">
                     <div class="col-lg-6 col-md-12">
                         <h5 class="cmn-head-style m-0"> {{ 'risk_heat_map' | translate}} </h5>
                     </div>
                     <div class="col-lg-6 col-md-12">

                         <ul class="nav nav-tabs float-right">
                             <li class="nav-item"> <a class="nav-link active show" (click)="getRiskHeatMapByCategories()" data-toggle="tab">{{ 'by_category' | translate}}</a> </li>
                             <li class="nav-item"> <a class="nav-link" (click)="getRiskHeatMapBySources()" data-toggle="tab">{{ 'by_source' | translate  }}</a> </li>
                             <li class="nav-item"> <a class="nav-link" (click)="getRiskHeatMapByStatus()" data-toggle="tab" >{{ 'by_status' | translate  }}</a> </li>
                         </ul>
                     </div>
                 </div>

                 <div class="tab-content tab-content-body pt-3">
                  <div class="tab-pane active show" id="risk-heat-map-one">
                     <div class="no-fixed-table risk-heatmap-category risk-heatmap-category-title app-automative-division bg-white p-3 mb-4 table-scroll-small-device">
                        <table *ngIf="CeoRiskDashboardStore.categoryLoaded">
                           <tr *ngFor="let cat of CeoRiskDashboardStore.heatMapByCategoryDetails;let num=index">
                              <th>{{cat.risk_category_title}}</th>
                              <td [ngClass]="'color-box-risk bg-'+score.color" *ngFor="let score of cat.risk_score;let colm=index">
                                 <span [ngClass]="activeRow == num && activeColumn==colm?'count-risk active':'count-risk'" *ngIf="score.count>0"
                                    (click)="getRiskHeatMap(1,'inherent_risk_score='+score.score+'&is_inherent=true&risk_category_ids='+cat.risk_category_id,num,colm,true)">{{score.count}}</span>
                              </td>
                           </tr>
                           <tr>
                              <th></th>
                              <td class="number-risk" *ngFor="let cat of CeoRiskDashboardStore.heatMapByCategoryDetails[0]?.risk_score">
                                 {{cat.score}}</td>
                           </tr>
                        </table>
                        <table *ngIf="CeoRiskDashboardStore.sourceLoaded">
                           <tr *ngFor="let dept of CeoRiskDashboardStore.heatMapByCategoryDetails;let num=index">
                             <th>{{dept.risk_source_title}}</th>
                             <td [ngClass]="'color-box-risk bg-'+count.color" *ngFor="let count of dept.risk_score;let colm=index"><span
                               [ngClass]="activeRow == num && activeColumn==colm?'count-risk active':'count-risk'" *ngIf="count.count>0"
                               (click)="getRiskHeatMap(1,'inherent_risk_score='+count.score+'&is_inherent=true&risk_source_ids='+dept.risk_source_id,num,colm,true)">{{count.count}}</span></td>
                           </tr>
                           <tr>
                             <th></th>
                             <td class="number-risk" *ngFor="let dept of CeoRiskDashboardStore.heatMapByCategoryDetails[0]?.risk_score">
                               {{dept.score}}</td>
                           </tr>
                         </table>
                         <table *ngIf="CeoRiskDashboardStore.statusLoaded">
                           <tr *ngFor="let dept of CeoRiskDashboardStore.heatMapByCategoryDetails;let num=index">
                             <th>{{dept.risk_status_title}}</th>
                             <td [ngClass]="'color-box-risk bg-'+count.color" *ngFor="let count of dept.risk_score;let colm=index"><span
                               [ngClass]="activeRow == num && activeColumn==colm?'count-risk active':'count-risk'" *ngIf="count.count>0"
                               (click)="getRiskHeatMap(1,'inherent_risk_score='+count.score+'&is_inherent=true&risk_status_ids='+dept.risk_status_id,num,colm,true)">{{count.count}}</span></td>
                           </tr>
                           <tr>
                             <th></th>
                             <td class="number-risk" *ngFor="let dept of CeoRiskDashboardStore.heatMapByCategoryDetails[0]?.risk_score">
                               {{dept.score}}</td>
                           </tr>
                         </table>
                         <ng-container *mobxAutorun>
                           <app-no-data-list [border]=false [source]="mapEmptyList" 
                           *ngIf="(CeoRiskDashboardStore.statusLoaded || CeoRiskDashboardStore.sourceLoaded || CeoRiskDashboardStore.categoryLoaded) && CeoRiskDashboardStore.heatMapByCategoryDetails?.length==0">
                        
                           </app-no-data-list>
                        
                        </ng-container>
                     </div>
                  </div>
              </div>

              <div class="no-fixed-table">
               <div class="fix-table" *ngIf="RisksStore.loaded && RisksStore.riskDetails.length>0">

                  <table class="table table-bordered ordinary-table audit-page-table mb-4 table-scroll">
                     <thead>
                        <tr>
                           <th class="border-top-0" width="2%">#</th>
                           <th class="border-top-0 pointer" width="6%" (click)="setRiskSort('reference_code')">
                              {{'ref_id' | translate}}
                              <img *ngIf="RisksStore.orderItem == 'reference_code'"
                                 [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                                 class="sort-down-pics">
                           </th>
                           <th class="border-top-0 pointer" width="28%" (click)="setRiskSort('risks.title')">{{'risk' |
                              translate}}
                              <img *ngIf="RisksStore.orderItem == 'risks.title'"
                                 [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                                 class="sort-down-pics">
                           </th>
                           <th class="border-top-0 pointer" width="7%" (click)="setRiskSort('risks.departments')">
                              {{'department' | translate}}
                              <img *ngIf="RisksStore.orderItem == 'risks.departments'"
                                 [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                                 class="sort-down-pics">
                           </th>
                           <th class="border-top-0 pointer" width="10%"
                              (click)="setRiskSort('risks.risk_category_title')">{{'risk_category' | translate}}
                              <img *ngIf="RisksStore.orderItem == 'risks.risk_category_title'"
                                 [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                                 class="sort-down-pics">
                           </th>
                           <th class="border-top-0 pointer" width="6%" (click)="setRiskSort('risks.risk_types')">
                              {{'risk_types' | translate}}
                              <img *ngIf="RisksStore.orderItem == 'risks.risk_types'"
                                 [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                                 class="sort-down-pics">
                           </th>
                           <th class="border-top-0 pointer" width="6%"
                           >{{'corporate_functional' | translate}}
                          
                       </th>

                           <th class="border-top-0" width="4%" (click)="setRiskSort('risks.risk_status_title')">
                              {{'status' | translate}}
                              <img *ngIf="RisksStore.orderItem == 'risks.risk_status_title'"
                                 [attr.src]="RisksStore.orderBy == 'asc'?'assets/images/sort-down.png':'assets/images/sort-up.png'"
                                 class="sort-down-pics">
                           </th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr class="pointer edit-and-delete-main"
                           *ngFor="let risk of RisksStore.riskDetails| paginate: {currentPage:RisksStore?.currentPage, itemsPerPage:RisksStore?.itemsPerPage,totalItems:RisksStore?.totalItems};let num = index">
                           <td>{{(RisksStore?.currentPage - 1) * RisksStore?.itemsPerPage + (num + 1)}}</td>
                           <td>#{{risk.reference_code}}</td>
                           <td>{{risk.title}}</td>
                           <td>{{risk.departments}}</td>
                           <td>{{risk.risk_category_title}}</td>
                           <td>
                              {{risk.risk_types}}</td>
                              <td>
                                 {{risk.is_corporate==1?'Corporate':'Functional'}}</td>
                           <td>
                              <div
                                 [ngClass]="risk.risk_status_id==AppStore.activeStatusId?'dot-div red-dot':'dot-div green-dot'">
                                 {{risk.risk_status_title}}</div>
                           </td>
                        </tr>
                     </tbody>
                  </table>
               </div>
            </div>
           
              </div>
           </div>
           <div class="col-xl-12 col-lg-12 col-sm-12 sm-col">

         </div>
        </div>






  </div>
  <ng-container *mobxAutorun>
      <div *ngIf="!CeoRiskDashboardStore.dashboardLoaded">
         <app-ceo-dashboard-automative-division-loader></app-ceo-dashboard-automative-division-loader>
      </div>
   </ng-container>
   </div>
 </main>