<button type="button" class="close" (click)="cancel()" data-dismiss="modal"><i
        class="lni-close"></i><span>esc</span></button>
<div class="modal-dialog step-popup-modal">
    <div class="modal-content" *mobxAutorun>
        <!-- Modal body -->
        <div class="modal-body form-body">


            <!-- multistep form -->
            <div class="step-form-small">
                <form id="msform">
                    <!-- progressbar -->
                    <div class="small-step-progressbar-main">
                        <ul id="progressbar">
                            <li class="active"></li>
                            <li></li>
                            <li></li>
                            <li></li>
                            <li></li>
                        </ul>
                    </div>
                    <!-- fieldsets -->
                    <fieldset>
                        <h2 class="fs-title">{{'risk_context' | translate}}</h2>

                        <div class="mb-4">
                            <div class="issuue-new-style p-0">
                                <div class="issue-top-sec">
                                    <div class="clearfix">
                                        <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                class="issue-smoal-head-text bold">#{{BcmRiskAssessmentStore.bcmRiskDetails?.reference_code?BcmRiskAssessmentStore.bcmRiskDetails?.reference_code:'xxxx'}}</span>
                                            <span
                                                class="issue-smoal-head-text bold">{{BcmRiskAssessmentStore.bcmRiskDetails?.title?BcmRiskAssessmentStore.bcmRiskDetails?.title:AppStore.noContentText}}</span>
                                            <span *ngFor="let types of BcmRiskAssessmentStore.bcmRiskDetails?.risk_types"
                                                class="risk-type-bx in-ex-sec">
                                                <i><img [attr.src]="types.is_internal == 1 ? 'assets/images/internal.svg' : 'assets/images/external.svg'"
                                                        style="width: 15px;"></i>&nbsp;{{types.language[0].pivot.title}}&nbsp;
                                            </span>
                                        </h5>
                                    </div>
                                    <!-- <div class="pt-1"
                                        [innerHTML]="BcmRiskAssessmentStore.bcmRiskDetails?.risk_observation | safeHtml">
                                    </div> -->

                                </div>
                            </div>

                            <!-- <div class="mb-2 mt-2"
                                *ngIf="OrganizationGeneralSettingsStore?.organizationSettings?.is_ms_type">
                                <label class="outline-tag"
                                    *ngFor="let type of BcmRiskAssessmentStore.bcmRiskDetails?.ms_type_organizations">{{type.ms_type.title}}
                                    <span>V.{{type.ms_type_version.title}}</span>
                                </label>
                            </div> -->

                            <div class="row">
                                <div class="col-md-12">
                                    <h6>{{rm_risk_description|translate}}</h6>
                                    <p style="white-space:pre-line">
                                        {{BcmRiskAssessmentStore.bcmRiskDetails?.description?BcmRiskAssessmentStore.bcmRiskDetails?.description:AppStore.noContentText}}
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <!-- <div class="col-md-4">
                                    <h6>{{'impacts'|translate}}</h6>
                                    <ul class="arrowlist pl-0 mt-2"
                                        *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_impacts?.length>0">

                                        <li class="clearfix"
                                            *ngFor="let impact of BcmRiskAssessmentStore.bcmRiskDetails?.risk_impacts">
                                            <a>{{impact.title}}</a>
                                        </li>

                                    </ul>
                                    <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_impacts?.length==0">
                                        {{AppStore.noContentText}}</p>

                                </div> -->
                                <!-- <div class="col-md-4">
                                    <h6>{{risk_causes|translate}}</h6>
                                    <ul class="arrowlist pl-0 mt-2"
                                        *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_causes?.length>0">

                                        <li class="clearfix"
                                            *ngFor="let cause of BcmRiskAssessmentStore.bcmRiskDetails?.risk_causes">
                                            <a>{{cause.title}}</a>
                                        </li>

                                    </ul>
                                    <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_causes?.length==0">
                                        {{AppStore.noContentText}}</p>

                                </div> -->
                                <!-- <div class="col-md-4">
                                    <h6>{{'risk_source'|translate}}</h6>
                                    <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.risk_sources?.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.risk_sources):AppStore.noContentText}}
                                    </p>
                                </div> -->
                            </div>
                            <div class="row">
                                <!-- <div class="col-md-4">
                                    <h6>{{'risk_category' | translate}}</h6>
                                    <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.risk_category?.title?BcmRiskAssessmentStore.bcmRiskDetails?.risk_category?.title:AppStore.noContentText}}
                                    </p>
                                </div> -->
                                <div class="col-md-4">
                                    <h6>{{'risk_types' | translate}}</h6>
                                    <p *ngFor="let types of BcmRiskAssessmentStore.bcmRiskDetails?.risk_types"
                                        class="risk-type-bx risk-type-bx-drop">
                                        <i><img [attr.src]="types.is_internal == 1 ? 'assets/images/internal.svg' : 'assets/images/external.svg'"
                                                style="width: 15px;"></i>&nbsp;{{types.language[0]?.pivot?.title}}&nbsp;
                                    </p>
                                    <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_types?.length==0">
                                        {{AppStore.noContentText}}</p>
                                </div>
                                <!-- <div class="col-md-4">
                                    <h6>{{'risk_areas' | translate}}</h6>
                                    <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.risk_areas.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.risk_areas):AppStore.noContentText}}
                                    </p>
                                </div> -->

                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <h6>{{'responsible_users' | translate}}</h6>
                                    <div class="row">
                                        <div class="col-sm-2 animation-pulse"
                                            *ngFor="let user of BcmRiskAssessmentStore.bcmRiskDetails?.responsible_users;let i=index">



                                            <app-user-popup-box [source]="getPopupDetails(user)"
                                                [activateButtons]="false" [showName]=false>
                                            </app-user-popup-box>
                                        </div>
                                    </div>
                                    <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.responsible_users.length==0">
                                        {{AppStore.noContentText}}
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="label-and-user-pic">
                                        <h6>{{'risk_owner' | translate}}</h6>

                                        <div class="row" *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner">
                                            <div class="col-sm-12 animation-pulse">
                                                <app-user-popup-box [activateButtons]="false"
                                                    [source]="getOwnerPopupDetails(BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner)">
                                                </app-user-popup-box>
                                            </div>
                                        </div>
                                    </div>

                                    <p *ngIf="!BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner">
                                        {{AppStore.noContentText}}
                                    </p>


                                </div>
                            </div>
                        </div>
                        <input type="button" name="next" class="next action-button btn-active" value="Next" />
                        <input type="button" name="cancel" (click)="cancel()" class="cancel action-button mr-2"
                            value="Cancel" />
                    </fieldset>
                    <fieldset>
                        <h2 class="fs-title">{{'impact' | translate}}</h2>

                        <div class="mb-5">
                            <div class="issuue-new-style p-0">
                                <div class="issue-top-sec">
                                    <div class="clearfix">
                                        <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                class="issue-smoal-head-text bold">#{{BcmRiskAssessmentStore.bcmRiskDetails?.reference_code?BcmRiskAssessmentStore.bcmRiskDetails?.reference_code:'xxxx'}}</span>
                                            <span
                                                class="issue-smoal-head-text bold">{{BcmRiskAssessmentStore.bcmRiskDetails?.title?BcmRiskAssessmentStore.bcmRiskDetails?.title:AppStore.noContentText}}</span>
                                            <span *ngFor="let types of BcmRiskAssessmentStore.bcmRiskDetails?.risk_types"
                                                class="risk-type-bx in-ex-sec">
                                                <i><img [attr.src]="types.is_internal == 1 ? 'assets/images/internal.svg' : 'assets/images/external.svg'"
                                                        style="width: 15px;"></i>&nbsp;{{types.language[0].pivot.title}}&nbsp;
                                            </span>
                                        </h5>
                                    </div>
                                    <div class="text-editor-content bullet-point-list pt-1"
                                        *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.description"
                                        [innerHTML]="BcmRiskAssessmentStore.bcmRiskDetails?.description | safeHtml"></div>
                                </div>
                            </div>
                            <div class="mb-2 mt-2"> <label
                                    [ngClass]="activeImpact?.id == impact.id?'outline-tag pointer active':'outline-tag pointer'"
                                    *ngFor="let impact of ImpactStore.impactDetails"
                                    (click)="setActiveImpact(impact)">{{impact.risk_matrix_impact_title}}
                                    ({{impact.score}})</label>
                            </div>

                            <h6>{{'description' | translate}}</h6>
                            <p
                                [innerHTML]="activeImpact?.risk_matrix_impact_description?activeImpact?.risk_matrix_impact_description:activeImpact?.language[0].pivot.description?activeImpact?.language[0].pivot.description:AppStore.noContentText">
                            </p>
                            <h6>{{'impact_guidelines' | translate}}</h6>
                            <p *ngFor="let categories of filterdOptions[0]?.risk_categories">
                                {{categories?.risk_category}}-{{categories?.description}}</p>
                            <div class="form-group">
                                <h6>{{'justification' | translate}}</h6>
                                <textarea rows="3" id="impactComment" class="form-control"
                                    [(ngModel)]="impactJustification" placeholder="Enter your justification here"
                                    name="impactJustification"></textarea>
                            </div>
                        </div>
                        <input type="button" name="next" [disabled]="activeImpact==null"
                            class="next action-button btn-active" value="Next" />
                        <input type="button" name="previous" class="previous action-button mr-2" value="Previous" />
                        <input type="button" name="cancel" (click)="cancel()" class="cancel action-button mr-2"
                            value="Cancel" />
                    </fieldset>
                    <fieldset>
                        <h2 class="fs-title">{{'assessment_likelihood' | translate}}</h2>

                        <div class="mb-5">
                            <div class="issuue-new-style p-0">
                                <div class="issue-top-sec">
                                    <div class="clearfix">
                                        <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                class="issue-smoal-head-text bold">#{{BcmRiskAssessmentStore.bcmRiskDetails?.reference_code?BcmRiskAssessmentStore.bcmRiskDetails?.reference_code:'xxxx'}}</span>
                                            <span
                                                class="issue-smoal-head-text bold">{{BcmRiskAssessmentStore.bcmRiskDetails?.title?BcmRiskAssessmentStore.bcmRiskDetails?.title:AppStore.noContentText}}</span>
                                            <span *ngFor="let types of BcmRiskAssessmentStore.bcmRiskDetails?.risk_types"
                                                class="risk-type-bx in-ex-sec">
                                                <i><img [attr.src]="types.is_internal == 1 ? 'assets/images/internal.svg' : 'assets/images/external.svg'"
                                                        style="width: 15px;"></i>&nbsp;{{types.language[0].pivot.title}}&nbsp;
                                            </span>
                                        </h5>
                                    </div>
                                    <div class="text-editor-content bullet-point-list pt-1"
                                        *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.description"
                                        [innerHTML]="BcmRiskAssessmentStore.bcmRiskDetails?.description | safeHtml"></div>



                                </div>
                            </div>
                            <div class="mb-3 mt-2"> <label
                                    [ngClass]="activeLikelihood?.id == likelihood.id?'outline-tag active pointer':'outline-tag pointer'"
                                    *ngFor="let likelihood of LikelihoodStore.likelihoodDetails"
                                    (click)="setActiveLikelihood(likelihood)">{{likelihood.risk_matrix_likelihood_title}}
                                    ({{likelihood.score}})</label>
                            </div>

                            <h6>{{'timeframe' | translate}} </h6>
                            <p>{{activeLikelihood?.risk_matrix_likelihood_timeframe?activeLikelihood?.risk_matrix_likelihood_timeframe:activeLikelihood?.language[0].pivot.timeframe}}
                            </p>

                            <h6>{{'probability' | translate}}</h6>
                            <p> {{activeLikelihood?.probability}}</p>

                            <div class="form-group">
                                <h6>{{'justification' | translate}}</h6>
                                <textarea class="form-control" rows="3" id="comment"
                                    [(ngModel)]="likelihoodJustification" placeholder="Enter your justification here"
                                    name="likelihoodJustification"></textarea>
                            </div>
                        </div>


                        <input type="button" name="next" [disabled]="activeLikelihood==null"
                            class="next action-button btn-active" value="Next" />
                        <input type="button" name="previous" class="previous action-button mr-2" value="Previous" />
                        <input type="button" name="cancel" (click)="cancel()" class="cancel action-button mr-2"
                            value="Cancel" />
                    </fieldset>
                    <fieldset>
                        <h2 class="fs-title">{{'risk_rating' | translate}}</h2>

                        <div class="mb-5">

                            <div class="bg-main cmn-bdr widg-padding-cmn-small mb-4 pb-2">
                                <div class="row">
                                    <div class="col-lg-4 col-sm-6" *ngIf="activeLikelihood">
                                        <h4 class="head-three relative pr-4">
                                            {{activeLikelihood?.risk_matrix_likelihood_title?activeLikelihood?.risk_matrix_likelihood_title:activeLikelihood?.language[0]?.pivot?.title}}
                                            ({{activeLikelihood?.score}}) <a
                                                class="close-text-box">{{BcmRiskAssessmentStore.calculationMethod?.is_addition?'+':BcmRiskAssessmentStore.calculationMethod?.is_multiplication?'x':BcmRiskAssessmentStore.calculationMethod?.is_substraction?'-':'/'}}</a>
                                        </h4>
                                        <h5>{{'likelihood' | translate}}</h5>
                                        <div class="small-text-p">
                                            <p>
                                                {{activeLikelihood?.risk_matrix_likelihood_timeframe?activeLikelihood?.risk_matrix_likelihood_timeframe:activeLikelihood?.language[0]?.pivot?.timeframe?activeLikelihood?.language[0].pivot.timeframe:''}}
                                                {{activeLikelihood?.probability}}</p>
                                        </div>

                                        <h5 style="font-size: 14px;" class="mt-2"
                                            *ngIf="likelihoodJustification && likelihoodJustification!=''">
                                            {{'justification'|translate}}
                                        </h5>
                                        <div class="small-text-p"
                                            *ngIf="likelihoodJustification && likelihoodJustification!=''">
                                            <p style="white-space: pre-line;">{{likelihoodJustification}}</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 col-sm-6" *ngIf="activeImpact">
                                        <h4 class="head-three relative pr-4">
                                            {{activeImpact?.risk_matrix_impact_title?activeImpact?.risk_matrix_impact_title:activeImpact?.language[0]?.pivot?.title}}
                                            ({{activeImpact?.score}}) </h4>
                                        <h5> {{'impact'|translate}}</h5>
                                        <p class="small-text-p"
                                            [innerHTML]="activeImpact?.risk_matrix_impact_description?activeImpact?.risk_matrix_impact_description:activeImpact?.language[0]?.pivot?.description?activeImpact?.language[0].pivot.description:''">

                                        </p>
                                        <h5 style="font-size: 14px;" class="mt-2"
                                            *ngIf="impactJustification && impactJustification!=''">
                                            {{'justification'|translate}}
                                        </h5>
                                        <div class="small-text-p"
                                            *ngIf="impactJustification && impactJustification!=''">
                                            <p style="white-space: pre-line;">{{impactJustification}}</p>
                                        </div>

                                    </div>
                                    <div class="col-lg-4 col-sm-12" *ngIf="activeImpact && activeLikelihood">
                                        <div class="small-rate-box">
                                            <div
                                                [ngClass]="'risk-rating-box mb-3 risk-rating-box-small risk-rating-box-color bg-'+getRiskClass(false)">
                                                <h3 class="text-white">
                                                    {{getRiskClass(true)}}
                                                    ({{BcmRiskAssessmentStore.calculationMethod?.is_addition?activeImpact?.score+activeLikelihood?.score:BcmRiskAssessmentStore.calculationMethod?.is_multiplication?activeImpact?.score*activeLikelihood?.score:BcmRiskAssessmentStore.calculationMethod?.is_substraction?activeImpact?.score>activeLikelihood?.score?activeImpact?.score-activeLikelihood?.score:activeLikelihood?.score-activeImpact?.score:activeLikelihood?.score>activeImpact?.score?activeLikelihood?.score/activeImpact?.score:activeImpact?.score/activeLikelihood?.score}})
                                                </h3>
                                                <p class="text-white mb-0">{{'risk_rating'| translate}}
                                                    ({{'risk_score'| translate}})</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="risk-score-box">
                                <h6 class="bold">{{'risk_score' | translate}} = ({{'likelihood' | translate}}
                                    {{BcmRiskAssessmentStore.calculationMethod?.is_addition?'+':BcmRiskAssessmentStore.calculationMethod?.is_multiplication?'x':BcmRiskAssessmentStore.calculationMethod?.is_substraction?'-':'/'}}
                                    {{'impact' | translate}})</h6>
                                <h5 *ngFor="let rating of RiskRatingMasterStore.allItems"
                                    [ngClass]="'font-normal risk-color-'+getScoreClass(rating)">
                                    <div *ngIf="rating.risk_rating_values">
                                        <span
                                            [ngClass]="'risk-score-indication bg-'+rating.label"></span>{{rating.title}}
                                        ({{getFormatedValue(',',rating.risk_rating_values)}})

                                    </div>
                                </h5>
                            </div>

                            <div class="risk-score-box mt-4">
                                <h6 class="bold">{{'risk_treatment' | translate}}</h6>
                                <h5 *ngFor="let rating of RiskRatingMasterStore.allItems"
                                    [ngClass]="'font-normal risk-color-'+getScoreClass(rating)"><span
                                        *ngIf="rating.risk_rating_values"
                                        [ngClass]="'risk-score-indication bg-'+rating.label"></span>{{rating.risk_rating_values?rating.risk_treatment:''}}
                                </h5>
                            </div>
                        </div>
                        <input type="button" name="next" class="next action-button btn-active" value="Next" />
                        <input type="button" name="previous" class="previous action-button mr-2" value="Previous" />
                        <input type="button" name="cancel" (click)="cancel()" class="cancel action-button mr-2"
                            value="Cancel" />
                    </fieldset>
                    <!-- <fieldset
                        *ngIf="RiskManagementSettingStore.loaded && RiskManagementSettingStore.riskManagementSettings.is_control_efficiency">
                        <h2 class="fs-title">{{'control_efficiency' | translate}}</h2>

                        <div class="mb-5" *ngIf="!(BcmRiskAssessmentStore.bcmRiskDetails?.is_analysis_performed)">
                            <div *ngFor="let process of BcmRiskAssessmentStore.bcmRiskDetails?.processes;let p=index">
                                <div class="d-flex" *ngIf="process.controls && process.controls?.length>0">
                                    <h6 class="bold cmn-head-style w-100"
                                        [attr.title]="process.title?.length>50?process.title:''">
                                        {{process.reference_code}} -
                                        {{process.title?.length>50?process.title.substring(0,50)+'...' :
                                        process.title}}</h6><span style="width:100px;">Score: <span
                                            class="text-light-blue bold"
                                            style="font-size: 18px;">{{getScorePercentage(process)>0?getScorePercentage(process):0}}%</span></span>
                                </div>
                                <div *ngIf="process.controls?.length>0">
                                    <div class="control-efficiency-box cmn-bdr p-3 mb-3"
                                        *ngFor="let control of process.controls;let c=index">
                                        <div class="d-flex align-items-center">
                                            <div class="w-100">
                                                <div class="Preview-block pt-0">
                                                    <div class="Preview-checkbox clearfix">
                                                        <label class="container2 remember-txt float-left">
                                                            <input type="checkbox" [checked]="selectedControl(p,c)"
                                                                (change)="setSelectedControl(p,c,$event)">
                                                            <span class="checkmark"></span> {{control.title}}</label>
                                                    </div>
                                                </div>
                                                <div class="mt-2"> <label
                                                        [ngClass]="control?.activeControlEfficiency?.id==measure.id?'outline-tag pointer active':'outline-tag pointer'"
                                                        (click)="setActiveControlEfficiency(measure,p,c)"
                                                        *ngFor="let measure of ControlEfficiencyMeasuresMasterStore.allItems">{{measure.control_efficiency_measure_title}}</label>

                                                </div>

                                            </div>
                                            <small
                                                class="btn btn-small btn-active">{{control?.activeControlEfficiency?.score?control?.activeControlEfficiency?.score:0}}%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex" *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.controls?.length>0">
                                <h6 class="bold cmn-head-style w-100">{{'other_controls' | translate}}</h6><span
                                    style="width:100px;">{{'score'|translate}}: <span class="text-light-blue bold"
                                        style="font-size: 18px;">{{getScorePercentage(BcmRiskAssessmentStore.bcmRiskDetails?.controls,true)>0?getScorePercentage(BcmRiskAssessmentStore.bcmRiskDetails?.controls,true):0}}%</span></span>
                            </div>

                            <div class="control-efficiency-box cmn-bdr p-3 mb-3"
                                *ngFor="let control of BcmRiskAssessmentStore.bcmRiskDetails?.controls;let c=index">
                                <div class="d-flex align-items-center">
                                    <div class="w-100">
                                        <p class="icon-with-text-new" style="color: #33475b;"><span><i
                                                    class="fas fa-question-circle"></i></span>{{control.title}}
                                        </p>

                                        <div class="mt-2"> <label
                                                [ngClass]="control?.activeControlEfficiency?.id==measure.id?'outline-tag pointer active':'outline-tag pointer'"
                                                (click)="setActiveControlEfficiency(measure,null,c,true)"
                                                *ngFor="let measure of ControlEfficiencyMeasuresMasterStore.allItems">{{measure.control_efficiency_measure_title}}</label>

                                        </div>

                                    </div>
                                    <small
                                        class="btn btn-small btn-active">{{control?.activeControlEfficiency?.score?control?.activeControlEfficiency?.score:0}}%</small>
                                </div>
                            </div>
                        </div>

                        <div class="mb-5" *ngIf="BcmRiskAssessmentStore?.individualRiskDetails?.is_analysis_performed">
                            <div
                                *ngFor="let process of RiskAssessmentStore?.riskAssessmentDetails?.risk_processes;let p=index">
                                <div class="d-flex" *ngIf="process.controls && process.controls?.length>0">
                                    <h6 class="bold cmn-head-style w-100"
                                        [attr.title]="process.process.title?.length>50?process.process.title:''">
                                        {{process.process.reference_code}} -
                                        {{process.process.title?.length>50?process.process.title.substring(0,50)+'...'
                                        :
                                        process.process.title}}</h6><span style="width:100px;">Score: <span
                                            class="text-light-blue bold"
                                            style="font-size: 18px;">{{getScorePercentage(process)>0?getScorePercentage(process):0}}%</span></span>
                                </div>
                                <div *ngIf="process.controls?.length>0">
                                    <div class="control-efficiency-box cmn-bdr p-3 mb-3"
                                        *ngFor="let control of process.controls;let cn=index">
                                        <div class="d-flex align-items-center">
                                            <div class="w-100">
                                                <p class="icon-with-text-new"><span><i
                                                            class="fas fa-question-circle"></i></span>{{control.control.title}}
                                                </p>

                                                <div class="mt-2"> <label
                                                        [ngClass]="control.efficiency?.id==measure.id?'outline-tag pointer active':'outline-tag pointer'"
                                                        (click)="setActiveControlEfficiency(measure,p,cn)"
                                                        *ngFor="let measure of ControlEfficiencyMeasuresMasterStore.allItems">{{measure.control_efficiency_measure_title}}</label>

                                                </div>

                                            </div>
                                            <small
                                                class="btn btn-small btn-active">{{control?.efficiency?.score?control?.efficiency?.score:0}}%</small>
                                        </div>
                                    </div>
                                </div>


                            </div>
                            <div class="d-flex"
                                *ngIf="RiskAssessmentStore?.riskAssessmentDetails?.risk_controls && RiskAssessmentStore?.riskAssessmentDetails?.risk_controls?.length>0">
                                <h6 class="bold cmn-head-style w-100">{{'other_controls' | translate}}</h6><span
                                    style="width:100px;">{{'score'|translate}}: <span class="text-light-blue bold"
                                        style="font-size: 18px;">{{getScorePercentage(RiskAssessmentStore?.riskAssessmentDetails?.risk_controls,true)>0?getScorePercentage(RiskAssessmentStore?.riskAssessmentDetails?.risk_controls,true):0}}%</span></span>
                            </div>
                            <div>
                                <div class="control-efficiency-box cmn-bdr p-3 mb-3"
                                    *ngFor="let control of RiskAssessmentStore?.riskAssessmentDetails?.risk_controls;let cn=index">
                                    <div class="d-flex align-items-center">
                                        <div class="w-100">
                                            <p class="icon-with-text-new"><span><i
                                                        class="fas fa-question-circle"></i></span>{{control.title}}
                                            </p>

                                            <div class="mt-2"> <label
                                                    [ngClass]="control.pivot.old_control_efficiency_measure_id==measure.id?'outline-tag pointer active':'outline-tag pointer'"
                                                    (click)="setActiveControlEfficiency(measure,null,cn,true)"
                                                    *ngFor="let measure of ControlEfficiencyMeasuresMasterStore.allItems">{{measure.control_efficiency_measure_title}}</label>
                                            </div>
                                        </div>
                                        <small
                                            class="btn btn-small btn-active">{{control.pivot?.old_control_efficiency_measure_score?control.pivot?.old_control_efficiency_measure_score:0}}%</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ng-container
                            *ngIf="((RiskAssessmentStore?.loaded && BcmRiskAssessmentStore?.individualRiskDetails?.is_analysis_performed &&
                         ((RiskAssessmentStore?.riskAssessmentDetails?.risk_processes?.length==0  || 
                         controlLength(RiskAssessmentStore.riskAssessmentDetails?.risk_processes)==0 )&&RiskAssessmentStore?.riskAssessmentDetails?.risk_controls?.length==0)) || (BcmRiskAssessmentStore.individual_risk_loaded && !(BcmRiskAssessmentStore?.individualRiskDetails?.is_analysis_performed) &&
                          ((BcmRiskAssessmentStore.bcmRiskDetails?.processes?.length==0 || controlLength(BcmRiskAssessmentStore.bcmRiskDetails?.processes)==0)&& BcmRiskAssessmentStore.bcmRiskDetails?.controls?.length==0)))">
                            <div class="mb-5">
                                <app-report-no-data [source]="processEmptyList" [border]=false>
                                </app-report-no-data>
                            </div>
                        </ng-container>
                        <input type="button" name="next" [disabled]="activeControlEfficiency==null"
                            class="next action-button btn-active" value="Next" />
                        <input type="button" name="previous" class="previous action-button mr-2" value="Previous" />
                        <input type="button" name="cancel" (click)="cancel()" class="cancel action-button mr-2"
                            value="Cancel" />
                    </fieldset> -->
                    <fieldset>
                        <h2 class="fs-title">{{'preview_save' | translate}}</h2>
                        <div class="mb-5">
                            <div class="row">
                                <div class="col-lg-9 col-sm-12 padding-right-0">
                                    <div class="issuue-new-style p-0">
                                        <div class="issue-top-sec">
                                            <div class="clearfix">
                                                <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                        class="issue-smoal-head-text bold">#{{BcmRiskAssessmentStore.bcmRiskDetails?.reference_code?BcmRiskAssessmentStore.bcmRiskDetails?.reference_code:AppStore.noContentText}}</span>
                                                    <span
                                                        class="issue-smoal-head-text bold">{{BcmRiskAssessmentStore.bcmRiskDetails?.title?BcmRiskAssessmentStore.bcmRiskDetails?.title:AppStore.noContentText}}</span>
                                                    <span
                                                        *ngFor="let types of BcmRiskAssessmentStore.bcmRiskDetails?.risk_types"
                                                        class="risk-type-bx in-ex-sec">
                                                        <i><img [attr.src]="types.is_internal == 1 ? 'assets/images/internal.svg' : 'assets/images/external.svg'"
                                                                style="width: 15px;"></i>&nbsp;{{types.language[0].pivot.title}}&nbsp;
                                                    </span>
                                                </h5>
                                            </div>
                                            <!-- <p
                                                [innerHTML]="BcmRiskAssessmentStore.bcmRiskDetails?.risk_observation | safeHtml">
                                            </p> -->

                                        </div>
                                    </div>

                                    <!-- <div class="mb-2 mt-2"
                                        *ngIf="OrganizationGeneralSettingsStore?.organizationSettings?.is_ms_type">
                                        <label class="outline-tag"
                                            *ngFor="let type of BcmRiskAssessmentStore.bcmRiskDetails?.ms_type_organizations">{{type.ms_type.title}}
                                            <span>V.{{type.ms_type_version.title}}</span>
                                        </label>
                                    </div> -->

                                    <div class="row">
                                        <div class="col-md-12">
                                            <!-- <h6>{{rm_risk_description|translate}}</h6> -->
                                            <p style="white-space:pre-line">
                                                {{BcmRiskAssessmentStore.bcmRiskDetails?.description?BcmRiskAssessmentStore.bcmRiskDetails?.description:AppStore.noContentText}}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <!-- <div class="col-md-4">
                                            <h6>{{'impacts'|translate}}</h6>
                                            <ul class="arrowlist pl-0 mt-2"
                                                *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_impacts?.length>0">

                                                <li class="clearfix"
                                                    *ngFor="let impact of BcmRiskAssessmentStore.bcmRiskDetails?.risk_impacts">
                                                    <a>{{impact.title}}</a>
                                                </li>

                                            </ul>
                                            <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_impacts?.length==0">
                                                {{AppStore.noContentText}}</p>

                                        </div> -->
                                        <!-- <div class="col-md-4">
                                            <h6>{{risk_causes|translate}}</h6>
                                            <ul class="arrowlist pl-0 mt-2"
                                                *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_causes?.length>0">

                                                <li class="clearfix"
                                                    *ngFor="let cause of BcmRiskAssessmentStore.bcmRiskDetails?.risk_causes">
                                                    <a>{{cause.title}}</a>
                                                </li>

                                            </ul>
                                            <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_causes?.length==0">
                                                {{AppStore.noContentText}}</p>

                                        </div> -->
                                        <!-- <div class="col-md-4">
                                            <h6>{{'risk_source'|translate}}</h6>
                                            <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.risk_sources?.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.risk_sources):AppStore.noContentText}}
                                            </p>
                                        </div> -->
                                    </div>
                                    <div class="row">
                                        <!-- <div class="col-md-4">
                                            <h6>{{'risk_category' | translate}}</h6>
                                            <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.risk_category?.title?BcmRiskAssessmentStore.bcmRiskDetails?.risk_category?.title:AppStore.noContentText}}
                                            </p>
                                        </div> -->
                                        <div class="col-md-4">
                                            <h6>{{'risk_types' | translate}}</h6>
                                            <p *ngFor="let types of BcmRiskAssessmentStore.bcmRiskDetails?.risk_types"
                                                class="risk-type-bx risk-type-bx-drop">
                                                <i><img [attr.src]="types.is_internal == 1 ? 'assets/images/internal.svg' : 'assets/images/external.svg'"
                                                        style="width: 15px;"></i>&nbsp;{{types.language[0].pivot.title}}&nbsp;
                                            </p>
                                            <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_types?.length==0">
                                                {{AppStore.noContentText}}</p>
                                        </div>
                                        <!-- <div class="col-md-4">
                                            <h6>{{'risk_areas' | translate}}</h6>
                                            <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.risk_areas.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.risk_areas):AppStore.noContentText}}
                                            </p>
                                        </div> -->
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">

                                            <h6>{{'responsible_users' | translate}}</h6>
                                            <div class="row">
                                                <div class="col-sm-2 animation-pulse"
                                                    *ngFor="let user of BcmRiskAssessmentStore.bcmRiskDetails?.responsible_users;let i=index">
                                                    <app-user-popup-box [source]="getPopupDetails(user)"
                                                        [activateButtons]="false" [showName]=false>
                                                    </app-user-popup-box>
                                                </div>
                                            </div>
                                            <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.responsible_users.length==0">
                                                {{AppStore.noContentText}}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="label-and-user-pic">
                                                <h6>{{'risk_owner' | translate}}</h6>
                                                <div class="row" *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner">
                                                    <div class="col-sm-12 animation-pulse">
                                                        <app-user-popup-box [activateButtons]="false"
                                                            [source]="getOwnerPopupDetails(BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner)">
                                                        </app-user-popup-box>
                                                    </div>
                                                </div>
                                            </div>
                                            <p *ngIf="!BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner">
                                                {{AppStore.noContentText}}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-sm-12">
                                    <div class="risk-rating-box bg-white p-3 mb-3">
                                        <h6 class="text-left">{{'risk_analysis' | translate}}</h6>
                                        <hr class="mt-0 mb-3">
                                        <div
                                            [ngClass]="'risk-rating-box risk-rating-box-small w-100 risk-rating-box-color bg-'+getRiskClass(false)">
                                            <h3 class="text-white">
                                                {{getRiskClass(true)}}
                                                ({{BcmRiskAssessmentStore.calculationMethod?.is_addition?activeImpact?.score+activeLikelihood?.score:BcmRiskAssessmentStore.calculationMethod?.is_multiplication?activeImpact?.score*activeLikelihood?.score:BcmRiskAssessmentStore.calculationMethod?.is_substraction?activeImpact?.score>activeLikelihood?.score?activeImpact?.score-activeLikelihood?.score:activeLikelihood?.score-activeImpact?.score:activeLikelihood?.score>activeImpact?.score?activeLikelihood?.score/activeImpact?.score:activeImpact?.score/activeLikelihood?.score}})
                                            </h3>
                                        </div>
                                        <div class="text-center mt-3">
                                            <p class="cmn-bdr d-inline-block mb-0 p-2 mr-2 mb-2">{{'likelihood' |
                                                translate}} :
                                                {{activeLikelihood?.risk_matrix_likelihood_title?activeLikelihood?.risk_matrix_likelihood_title:activeLikelihood?.language[0]?.pivot?.title}}
                                                <span>({{activeLikelihood?.score}})</span>
                                            </p>
                                            <p class="cmn-bdr d-inline-block mb-0 p-2 mr-2 mb-2">{{'impact' |
                                                translate}} :
                                                {{activeImpact?.risk_matrix_impact_title?activeImpact?.risk_matrix_impact_title:activeImpact?.language[0]?.pivot?.title}}
                                                <span>({{activeImpact?.score}})</span>
                                            </p>
                                        </div>



                                    </div>
                                </div>

                            </div>
                            <div class="row"
                                *ngIf="(!(BcmRiskAssessmentStore.bcmRiskDetails?.is_analysis_performed==1) && BcmRiskAssessmentStore.bcmRiskDetails?.processes.length==0 && BcmRiskAssessmentStore.bcmRiskDetails?.controls.length==0) || (BcmRiskAssessmentStore.bcmRiskDetails?.is_analysis_performed)">
                                <div class="col-md-12">
                                    <p>
                                        {{AppStore.noContentText}}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <input type="submit" name="submit" class="submit action-button btn-active"
                            (click)="savePerformAssessment()"
                            [value]="AppStore.loading?getButtonText('loading'):getButtonText('save')" />
                        <input type="button" name="previous" class="previous action-button mr-2"
                            [value]="AppStore.loading?getButtonText('loading'):getButtonText('previous')" />
                        <input type="button" name="cancel" (click)="cancel()" class="cancel action-button mr-2"
                            [value]="AppStore.loading?getButtonText('loading'):getButtonText('cancel')" />
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-style-1 fade" id="delete-popup" #cancelPopup>
    <app-delete-popup *ngIf="cancelObject.type" [source]="cancelObject"></app-delete-popup>
</div>