<!-- risk-update-popup Start -->
<!-- <div class="modal modal-style-1 fade popup-full-width" id="risk-update-popup" data-keyboard="false"
    data-backdrop="static" *mobxAutorun> -->
    <button type="button" class="close" data-dismiss="modal" (click)="closeUpdateModal()"><i
        class="lni-close"></i><span>{{'esc' | translate}}</span></button>
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
          <div class="modal-header">
              <h4 class="modal-title">{{'update_risk_treatment_progress'|translate}}</h4>
          </div>
          <div class="modal-body form-body">
              <p class="head-details">{{'treatment_update_form_description'|translate}}</p>
  
              <form *ngIf="updateForm" [formGroup]="updateForm" id="updateForm">
  
                  <div class="row">
                      <div class="col-sm-12" *ngIf="BcmRiskAssessmentStore.detailsLoaded">
                          <div class="form-group">
                              <div class="cmn-bdr border-radius p-3">
                                  <div class="issue-top-sec">
                                      <div class="clearfix">
                                          <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                  class="issue-smoal-head-text">#{{BcmRiskAssessmentStore.bcmRiskDetails?.reference_code}}</span>
                                              {{BcmRiskAssessmentStore.bcmRiskDetails?.title}}</h5>
                                      </div>
                                      <!--style="white-space: pre-line;" {{BcmRiskAssessmentStore.bcmRiskDetails?.description ? BcmRiskAssessmentStore.bcmRiskDetails?.description : AppStore.noContentText}} -->
                                      <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.description"
                                          [innerHTML]="BcmRiskAssessmentStore.bcmRiskDetails?.description | safeHtml"></p>
                                      <p *ngIf="!BcmRiskAssessmentStore.bcmRiskDetails?.description">
                                          {{AppStore.noContentText}}</p>
  
  
                                  </div>
  
                                  <div class="row">
                                      <div class="col-xl-3 col-lg-4 col-sm-6"
                                          [ngStyle]="{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_subsidiary ? 'none':'block'}">
                                          <h6>{{'organizations'|translate}}</h6>
                                          <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.organizations.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.organizations):AppStore.noContentText}}
                                          </p>
                                          <!-- <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.organizations ? BcmRiskAssessmentStore.bcmRiskDetails?.organizations.title : AppStore.noContentText}}</p> -->
                                      </div>
                                      <div class="col-xl-3 col-lg-4 col-sm-6"
                                          [ngStyle]="{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_division ? 'none':'block'}">
                                          <h6>{{'divisions'|translate}}</h6>
                                          <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.divisions.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.divisions):AppStore.noContentText}}
                                          </p>
                                          <!-- <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.divisions ? BcmRiskAssessmentStore.bcmRiskDetails?.divisions.title : AppStore.noContentText}}</p> -->
                                      </div>
                                      <div class="col-xl-3 col-lg-4 col-sm-6"
                                          [ngStyle]="{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_department ? 'none':'block'}">
                                          <h6>{{'departments'|translate}}</h6>
                                          <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.departments.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.departments):AppStore.noContentText}}
                                          </p>
                                          <!-- <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.departments ? BcmRiskAssessmentStore.bcmRiskDetails?.departments.title : AppStore.noContentText}}</p> -->
                                      </div>
                                      <div class="col-xl-3 col-lg-4 col-sm-6"
                                          [ngStyle]="{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_section ? 'none':'block'}">
                                          <h6>{{'sections'|translate}}</h6>
                                          <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.sections.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.sections):AppStore.noContentText}}
                                          </p>
                                          <!-- <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.sections ? BcmRiskAssessmentStore.bcmRiskDetails?.sections.title : AppStore.noContentText}}</p> -->
                                      </div>
                                      <div class="col-xl-3 col-lg-4 col-sm-6"
                                          [ngStyle]="{display: !OrganizationLevelSettingsStore.organizationLevelSettings?.is_sub_section ? 'none':'block'}">
                                          <h6>{{'sub_sections'|translate}}</h6>
                                          <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.sub_sections.length>0?getArrayFormatedString('title',BcmRiskAssessmentStore.bcmRiskDetails?.sub_sections):AppStore.noContentText}}
                                          </p>
                                          <!-- <p>{{BcmRiskAssessmentStore.bcmRiskDetails?.sub_sections ? BcmRiskAssessmentStore.bcmRiskDetails?.sub_sections.title : AppStore.noContentText}}</p> -->
                                      </div>
                                      <!-- <div class="col-xl-3 col-lg-4 col-sm-6"
                                          *ngIf="BcmRiskAssessmentStore?.contextChartLoaded">
                                          <h6>{{'risk_rating'|translate}}</h6>
                                          <p>{{BcmRiskAssessmentStore.contextChartDetails?.risk_analysis?.risk_rating?.language[0]?.pivot?.title}}
                                          </p>
                                      </div>
                                      <div class="col-xl-3 col-lg-4 col-sm-6">
                                          <h6>{{'frequency_of_report'|translate}}</h6>
                                          <p>{{RisksStore?.individualRiskDetails.risk_review_frequency?RisksStore?.individualRiskDetails.risk_review_frequency.language[0]?.pivot?.title:AppStore.noContentText}}
                                          </p>
                                      </div> -->
                                      <div class="col-sm-12">
                                          <div class="label-and-user-pic mb-0">
                                              <h6>{{'risk_owner'|translate}}</h6>
                                              <app-user-popup-box id="jd"
                                                  *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner"
                                                  [source]="getRiskPopupDetails(BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner)">
                                              </app-user-popup-box>
                                              <div *ngIf="!BcmRiskAssessmentStore.bcmRiskDetails?.risk_owner">
                                                  {{AppStore.noContentText}}</div>
                                          </div>
                                      </div>
                                  </div>
                                  <hr>
                                  <div class="issue-top-sec">
                                      <div class="clearfix">
                                          <h5 class="d-inline-block cmn-head-style label-tag-style"><span
                                                  class="issue-smoal-head-text">#{{BcmRiskTreatmentStore.riskTreatmentDetails?.reference_code}}</span>
                                              {{BcmRiskTreatmentStore.riskTreatmentDetails?.title}}</h5>
                                      </div>
                                      <!--style="white-space: pre-line;" {{BcmRiskAssessmentStore.bcmRiskDetails?.description ? BcmRiskAssessmentStore.bcmRiskDetails?.description : AppStore.noContentText}} -->
                                      <!-- <p *ngIf="BcmRiskAssessmentStore.bcmRiskDetails?.description"
                                      [innerHTML]="BcmRiskAssessmentStore.bcmRiskDetails?.description"></p>
                                  <p *ngIf="!BcmRiskAssessmentStore.bcmRiskDetails?.description">
                                      {{AppStore.noContentText}}</p> -->
  
  
  
                                      <label>{{'risk_treatment_action_plan'|translate}}</label>
                                      <p>{{BcmRiskTreatmentStore.riskTreatmentDetails?.description?BcmRiskTreatmentStore.riskTreatmentDetails?.description:AppStore.noContentText}}
                                      </p>
                                  </div>
                                  <div class="row">
                                      <div class="col-xl-3 col-lg-4 col-sm-6">
                                          <h6>{{'start_date'|translate}}</h6>
                                          <p>{{BcmRiskTreatmentStore?.riskTreatmentDetails?.start_date}}
                                          </p>
                                      </div>
                                      <div class="col-xl-3 col-lg-4 col-sm-6">
                                          <h6>{{'target_date'|translate}}</h6>
                                          <p>{{BcmRiskTreatmentStore?.riskTreatmentDetails?.target_date}}
                                          </p>
                                      </div>
                                      <div class="col-xl-6 col-lg-12 col-sm-12">
                                          <div class="label-and-user-pic mb-0">
                                              <!-- <div class="label-and-user-pic user-big-pic"> -->
                                              <h6>{{'risk_treatment_owner'|translate}}</h6>
                                              <app-user-popup-box id="jd"
                                                  *ngIf="BcmRiskTreatmentStore.riskTreatmentDetails?.responsible_user"
                                                  [source]="getPopupDetails(BcmRiskTreatmentStore.riskTreatmentDetails?.responsible_user)">
                                              </app-user-popup-box>
                                              <!-- </div> -->
                                              <div
                                                  *ngIf="!BcmRiskTreatmentStore.riskTreatmentDetails?.responsible_user">
                                                  {{AppStore.noContentText}}</div>
                                          </div>
                                      </div>
  
  
  
  
                                  </div>
  
  
  
                              </div>
                          </div>
  
                      </div>
                      <div class="col-sm-12">
  
                          <div class="audit-form-table w-100 table-align-top not-fixed-table"
                              *ngIf="BcmRiskTreatmentStore.treatmentUpdateDataLoaded && BcmRiskTreatmentStore.historyData.length>0">
                              <table
                                  class="table table-bordered ordinary-table audit-page-table mb-3 table-scroll">
                                  <thead>
                                      <tr>
                                          <th class="border-top-0" style="width: 4%;">#</th>
                                          <th class="border-top-0" style="width: 30%;">{{'actions'|translate}}</th>
  
                                          <!-- <th class="border-top-0" style="width: 8%;">Responsibility</th> -->
                                          <th class="border-top-0" style="width: 8%;">%{{'completed'|translate}}</th>
                                          <!-- <th class="border-top-0" style="width: 13%;">Proposed Start Date</th> -->
                                          <th class="border-top-0" style="width: 12%;">{{'actual_start_date'|translate}}</th>
                                          <!-- <th class="border-top-0" style="width: 8%;">Baseline Due Date</th> -->
                                          <th class="border-top-0" style="width: 12%;">{{'revised_due_date'|translate}}</th>
                                          <th class="border-top-0" style="width: 16%;" colspan="2">{{'status'|translate}}</th>
  
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr
                                          *ngFor="let history of BcmRiskTreatmentStore.historyData| paginate: {id:'historyUpdate',currentPage:BcmRiskTreatmentStore?.historyCurrentPage, itemsPerPage:BcmRiskTreatmentStore?.historyItemsPerPage,totalItems:BcmRiskTreatmentStore?.historyTotalItems};let num = index">
                                          <td>{{num+1}}</td>
                                          <td>{{history.comment?history.comment:AppStore.noContentText}}</td>
                                          <!-- <td></td> -->
                                          <td>{{history.percentage?history.percentage:AppStore.noContentText}}
                                          </td>
                                          <td>{{history.actual_start_date?history.actual_start_date:AppStore.noContentText}}
                                          </td>
                                          <!-- <td></td> -->
                                          <td>{{history.revised_target_date?history.revised_target_date:AppStore.noContentText}}
                                          </td>
                                          <!-- <td></td> -->
  
                                          <td><span
                                                  [ngClass]="'dot-div '+history.label+'-dot'"></span>{{history.risk_treatment_status_title}}
                                          </td>
                                          <!-- <td></td> -->
  
                                      </tr>
  
                                  </tbody>
                              </table>
                              <ul class="pagination justify-content-center mt-3"
                                  *ngIf="BcmRiskTreatmentStore?.historyTotalItems>BcmRiskTreatmentStore?.historyItemsPerPage">
                                  <pagination-controls (pageChange)="historyPageChange($event)"
                                      class="my-pagination" id="historyUpdate"></pagination-controls>
                              </ul>
  
                          </div>
                      </div>
                  </div>
  
  
  
  
                  <div class="row">
  
                      <div class="col-sm-4">
                          <div class="form-group">
                              <label for="name">{{'status' | translate}}<sup>*</sup></label>
                              <!-- <div class="plain-select">
                              
                              <select class="form-control" name="test" formControlName="risk_treatment_status_id">
                   <option *ngFor="let status of RiskTreatmentStatusStore.allItems" [value]="status.id">{{status.risk_treatment_status_language_title}}</option>
                
                 </select>
                          </div> -->
                              <div class="clearfix">
                                  <div class="multiple-plain-ngselect">
  
                                      <ng-select [multiple]="false" [placeholder]="'select_status' | translate"
                                          searchable="false" formControlName="risk_treatment_status_id"
                                          (search)="searchStatus($event)" (clear)="getStatus()"
                                          (open)="getStatus()" (change)="checkForStatus($event)">
                                          <ng-option [value]="status.id" *ngFor="let status of statuses">
                                              {{status.risk_treatment_status_language_title}}
                                          </ng-option>
                                      </ng-select>
                                      <!-- setValuesToShow('subsidiary',type) -->
                                      <!-- <ng-select [placeholder]="'subsidiaries'|translate" [multiple]="false"
                                              searchable="true" (search)="searchCountry($event)"
                                              formControlName="country_id" (clear)="getCountry()"
                                              (open)="getCountry()">
                                              <ng-option [value]="type.id"
                                                  *ngFor="let type of SubsidiaryStore.subsidiaryList">
                                                  {{type.title}}
                                              </ng-option>
                                          </ng-select> -->
                                  </div>
                                  <p class="form-error pt-1"
                                      *ngIf="formErrors&&formErrors.risk_treatment_status_id">
                                      {{formErrors.risk_treatment_status_id[0]}}</p>
  
                              </div>
                          </div>
                      </div>
                      <div class="col-sm-4">
                          <div class="form-group">
                              <label for="name">{{'completion_percentage' | translate}}<sup>*</sup></label>
                              <div class="plain-select">
                                  <select class="form-control" name="test" formControlName="percentage">
                                      <option
                                          [disabled]="(updateForm.value.risk_treatment_status_id==1 || updateForm.value.risk_treatment_status_id==3 || (updateForm.value.risk_treatment_status_id==2 && (i==0 || i==100)))?true:false"
                                          *ngFor="let i of percentage" (change)="checkForPercentage(i)"
                                          [value]="i">{{i}}</option>
                                  </select>
                                  <p class="form-error pt-1" *ngIf="formErrors&&formErrors.percentage">
                                      {{formErrors.percentage[0]}}</p>
  
                              </div>
                          </div>
                      </div>
                      <div class="col-sm-4"
                      *ngIf="RiskManagementSettingStore.loaded && RiskManagementSettingStore.riskManagementSettings.is_budget">
                      <div class="form-group">
                          <label for="name">{{'amount_used' | translate}}
                              ({{OrganizationGeneralSettingsStore?.organizationSettings?.currency}})</label>
                          <div class="plain-select input-add-report">
                              <input type="text" formControlName="amount_used" class="form-control"
                                  [placeholder]="'enter_amount_used'|translate"/>
                          </div>
                          <p class="form-error pt-1"
                              *ngIf="updateForm?.get('amount_used').invalid && updateForm.value.amount_used">
                              {{'permit_number_decimals_only'| translate}}</p>
                          <p class="form-error pt-1" *ngIf="formErrors&&formErrors.amount_used">
                              {{formErrors.amount_used[0]}}</p>
                         
                      </div>
                  </div>
                      <div class="col-sm-12" *ngIf="OrganizationModulesStore.checkIndividualSubModule(900,33101)">
                          <div class="form-group">
                              <label for="name">{{'actions'|translate}}</label>
                              <textarea class="form-control " rows="3" id="comment" formControlName="comment"
                                  placeholder="Enter actions of the treatment"></textarea>
                              <p class="form-error pt-1" *ngIf="formErrors&&formErrors.comment">
                                  {{formErrors.comment[0]}}</p>
                          </div>
  
                      </div>
  
                      <div class="col-sm-6">
                          <div class="form-group">
                              <label for="name">{{'actual_start_date'|translate}}</label>
                              <div class="input-group date-picker input-clear-btn-main">
                                  <input formControlName="actual_start_date" class="form-control bg-white"
                                      placeholder="yyyy-mm-dd" id="start_date" [readonly]="true"
                                      [maxDate]="{year: updateForm.value.revised_target_date?.year?this.updateForm.value.revised_target_date?.year:null, month: updateForm.value.revised_target_date?.month?this.updateForm.value.revised_target_date?.month:null, day: updateForm.value.revised_target_date?.day?this.updateForm.value.revised_target_date?.day-1:null}"
                                      ngbDatepicker #startInput="ngbDatepicker"><span
                                      *ngIf="updateForm.value.actual_start_date" aria-hidden="true"
                                      (click)="clear('start_date')" style="border:none;"
                                      class="input-clear-btn">×</span>
  
                                  <div class="input-group-append">
                                      <button class="btn btn-outline-secondary calendar"
                                          (click)="startInput.toggle()" type="button"><i
                                              class="fas fa-calendar-alt"></i></button>
                                  </div>
                                  <!-- <input formControlName="start_date" class="form-control cal3" placeholder="Enter Field Name"> -->
                              </div>
                              <p class="form-error pt-1" *ngIf="formErrors&&formErrors.actual_start_date">
                                  {{formErrors.actual_start_date[0]}}</p>
                          </div>
                      </div>
                      <div class="col-sm-6">
                          <div class="form-group">
                              <label for="name">{{'revised_due_date'|translate}}</label>
                              <div class="input-group date-picker input-clear-btn-main">
                                  <!-- <input formControlName="target_date" class="form-control cal4"
                                  placeholder="Enter Field Name"> -->
                                  <input formControlName="revised_target_date" class="form-control bg-white"
                                      placeholder="yyyy-mm-dd" id="target_date" ngbDatepicker [readonly]="true"
                                      [minDate]="{year: this.updateForm.value.actual_start_date?.year, month: this.updateForm.value.actual_start_date?.month, day: this.updateForm.value.actual_start_date?.day+1}"
                                      #endInput="ngbDatepicker"><span aria-hidden="true"
                                      *ngIf="updateForm.value.revised_target_date" (click)="clear('target_date')"
                                      style="border:none;" class="input-clear-btn">×</span>
                                  <div class="input-group-append">
                                      <button class="btn btn-outline-secondary calendar"
                                          (click)="endInput.toggle()" type="button"><i
                                              class="fas fa-calendar-alt"></i></button>
                                  </div>
                              </div>
                              <p class="form-error pt-1" *ngIf="formErrors&&formErrors.revised_target_date">
                                  {{formErrors.revised_target_date[0]}}</p>
                          </div>
                      </div>
  
                  </div>
  
                  <label class="label-style mb-0">{{'evidences'|translate}}</label>
                  <div class="scroll-documents" #uploadArea>
                    <div class="thumb-pics-bg thumb-pics-col-5 clearfix thumb-pics-fix-text" style="padding-top: 0;">
                        <div class="thumb-pics">
                            <div class="form-group form-group-upload">
                                <div class="darag-dropifile-upload">
                                    <div class="d-flex justify-content-center align-items-center text-center">
                                        <div>
                                            <img src="/assets/images/drag-pic.png" alt="image" class="drag-pic-files">
                                            <div class="drag-file-name"> Select or Upload Your File Here
                                            </div>
                                            <div class="upload-btn-wrapper">
                                                <button (click)="openFileUploadModal()" type="button"
                                                    class="btn">{{'browse_files' | translate}}</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="thumb-pics" *ngFor="let docs of fileUploadPopupStore.displayFiles ;let i = index">
                            <div class="upload-pics edit-option" data-toggle="modal">
                                <div *ngIf="docs.id && !docs.preview" class="browse-form-pic"
                                    [ngStyle]="{'background': 'url('+createImageUrl('document-version',docs?.token)+') no-repeat'}">
                                </div>
                                <div *ngIf="docs.preview" class="browse-form-pic"
                                    [ngStyle]="{'background': 'url(' + docs?.preview + ') no-repeat 0 0 / cover'}">
                                </div>
                                <div class="browse-form-name clearfix">
                                    <div class="float-left">
                                        <h6>{{docs.title?docs.title:docs.name?docs.name:docs.version_title?docs.version_title:"NA"}}.{{docs.ext}}
                                        </h6>
                                        <span *ngIf="docs.is_kh_document" class="mr-2 cmn-clr"><i
                                                class="fas fa-book"></i></span>
                                        <span *ngIf="!docs.is_kh_document" class="mr-2 cmn-clr"><i
                                                class="fas fa-laptop"></i></span>
                                        <span>{{docs.size/1048576 | number:'0.2-2'}}MB</span>
                                    </div>
                                    <div class="browse-logo">
                                        <img *ngIf="checkExtension(docs.ext,'image') != -1" class="folder-picher"
                                            src="/assets/images/jpg-icone.png">
                                        <img *ngIf="checkExtension(docs.ext,'doc') != -1" class="folder-picher"
                                            src="/assets/images/word-icone.png">
                                        <img *ngIf="checkExtension(docs.ext,'pdf') != -1" class="folder-picher"
                                            src="/assets/images/pdf-icone.png">
                                        <img *ngIf="checkExtension(docs.ext,'excel') != -1" class="folder-picher"
                                            src="/assets/images/excel-icone.png">
                                        <img *ngIf="checkExtension(docs.ext,'video') != -1" class="folder-picher"
                                            src="/assets/images/md-video.png">
                                        <img *ngIf="checkExtension(docs.ext,'audio') != -1" class="folder-picher"
                                            src="/assets/images/md-audio.png">
                                        <img *ngIf="checkExtension(docs.ext,'ppt') != -1" class="folder-picher"
                                            src="/assets/images/md-ppt.png">
                                    </div>
                                </div>
                                <div class="edit-option-show">
                                    <a (click) = "removeDocument(docs)"><i class="fas fa-trash"></i></a>
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>
                  <p style="color: red;" *ngIf="formErrors&&formErrors.documents">
                      {{formErrors.documents[0]}}</p>
  
  
                  <div class="row">
                      <div class="col-sm-12">
                          <div class="d-block justify-content-left border-0 mt-3">
                              <button type="button" data-toggle="modal" (click)="updateTreatment()"
                                  class="btn ordinary-btn mr-3 btn-active">{{AppStore.loading?getButtonText('loading'):getButtonText('save')}}</button>
                              <button type="button" data-toggle="modal" (click)="updateTreatment(true)"
                                  class="btn ordinary-btn mr-3">{{AppStore.loading?getButtonText('loading'):getButtonText('save_close')}}</button>
                              <button type="button" data-toggle="modal" (click)="closeUpdateModal()"
                                  class="btn ordinary-btn mr-2">{{AppStore.loading?getButtonText('loading'):getButtonText('cancel')}}</button>
                          </div>
                      </div>
                  </div>
  
              </form>
  
          </div>
  
      </div>
  </div>
    <!-- </div> -->
    <!-- risk-update-popup End -->
    <div class="modal modal-style-1 popup-full-width fade" data-keyboard="false" data-backdrop="static" #fileUploadModal>

        <app-file-upload-popup *ngIf="fileUploadPopupStore.openPopup"></app-file-upload-popup>
    
    </div>